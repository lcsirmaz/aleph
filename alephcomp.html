<!DOCTYPE html>
<html land="en">
<head><title>Aleph Compiler v2.2</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (https://tug.org/tex4ht/)"> 
<meta name="originator" content="TeX4ht (https://tug.org/tex4ht/)"> 
<!-- html --> 
<meta name="src" content="alephcomp.tex"> 
<link rel="stylesheet" type="text/css" href="alephcomp.css"> 
</head><body 
>
   <div class="maketitle">
                                                                  

                                                                  

<h2 class="titleHead">Aleph Compiler v2.4</h2>
<div class="author" ><span 
class="cmr-12">L. Csirmaz</span></div><br />
<div class="date" >Document version 1.2, April 2025</div>
   </div>
<!--l. 150--><p class="indent" >
                                                                  

                                                                  
<!--l. 150--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">1   </span> <a 
 id="x1-10001"></a>Preface</h3>
<!--l. 152--><p class="noindent" >The early 1980&#8217;s saw a proliferation of computer programming languages. Only a
few of them survived and even fewer are in use today. The programming
language <span 
class="cmss10">ALEPH</span>, an acronym for <span 
class="cmss10">A L</span>anguage <span 
class="cmss10">E</span>ncouraging <span 
class="cmss10">P</span>rogram <span 
class="cmss10">H</span>ierarchy,
almost completely disappeared, and this work is an attempt to resurrect
it.
<!--l. 158--><p class="indent" >   As a programming language <span 
class="cmss10">ALEPH </span>has many interesting features even by today&#8217;s
standards. Designed by D. Grune, R. Bosch and L. G. L. T. Meertens in the
Mathematisch Centrum, Amsterdam <span class="cite">[<a 
href="#XA-manual">2</a>]</span>, its purpose was to offer a language which is
&#8220;suitable for any problem that suggests top-down analysis (parsers, search
algorithms, combinatorial problems, artificial intelligence problems, etc).&#8221; <span 
class="cmss10">ALEPH</span>
compilers have been constructed for a wide range of computer architectures
(which had a much larger variety at that time), and these compilers generated
efficient and succinct code, which was an important requirement those days
<span class="cite">[<a 
href="#Xgrune">3</a>]</span>.
<!--l. 168--><p class="indent" >   <span 
class="cmss10">ALEPH </span>is a direct descendant of another extinct language, <span 
class="cmss10">CDL</span>, standing for
<span 
class="cmss10">C</span>ompiler <span 
class="cmss10">D</span>escription <span 
class="cmss10">L</span>anguage. <span 
class="cmss10">CDL</span> was designed by C. H. A. Koster <span class="cite">[<a 
href="#Xkoster1">4</a>,&#x00A0;<a 
href="#Xkoster3">6</a>]</span> as a tool
for writing compilers for a wide variety of programming languages and target
machines. There had been some more recent work on descendants of <span 
class="cmss10">CDL</span> <span class="cite">[<a 
href="#Xcdl3">7</a>]</span>. Both
<span 
class="cmss10">ALEPH </span>and <span 
class="cmss10">CDL</span> belong to the family of the few languages based on affix,
or two-level, or van Wijngaarden, grammars <span class="cite">[<a 
href="#Xkoster2">5</a>,&#x00A0;<a 
href="#Xwijn">8</a>]</span>. Affix grammars were
developed to provide a formal definition of what an <span 
class="cmss10">ALGOL68</span> program is <span class="cite">[<a 
href="#Xa68">9</a>]</span>. The
appealing intuitive meaning of an affix grammar definition combined with the
theoretical simplicity and completeness led soon to practical applications.
A common feature of those programming languages is that grammatical
symbols are interpreted as procedures returning either true or false depending
on whether a token sequence derivable from the grammatical symbol has
been recognized or not. <span 
class="cmti-10">Affixes </span>of the grammatical symbols carry additional
contextual information, and behave as (both input and output) parameters of
the procedure. Affix values typically come from another, very restricted
language.
<!--l. 187--><p class="indent" >   <span 
class="cmss10">CDL</span>, and its successor, <span 
class="cmss10">CDL2</span> was a popular and widely used compiler writing
tool. It is worth noting that the first generation <span 
class="cmss10">PROLOG</span> compilers were written
exclusively in these languages. <span 
class="cmss10">CDL</span> provides a global logical framework and organizes
the data flow among the rules without specifying neither the primitives nor
the affix values. While keeping the main design ideas and syntax closely
resembling that of the original <span 
class="cmss10">CDL</span>, <span 
class="cmss10">ALEPH </span>closed this open endedness
by specifying the available data types and fixing the data manipulating
primitives.
<!--l. 196--><p class="indent" >   The unusual <span 
class="cmti-10">call-then-store </span>procedure execution mechanism of <span 
class="cmss10">ALEPH </span>is
inherited from <span 
class="cmss10">CDL</span>. Output parameters (affixes) are local for the called
procedure during execution, and are copied back to their destination only after a
successful return. Other features unique to <span 
class="cmss10">ALEPH </span>are modeling the virtual
memory as a huge sequence of computer words where stacks and tables
occupy consecutive positions whose exact location is outside the control of the
programmer; handling character strings as black boxes without direct access to its
constituents; and datafiles which allow automatic transfer of stack and table
pointers from one program to another. By design, no uninitialized memory
location exists in <span 
class="cmss10">ALEPH</span>, which automatically avoids many hard to discover
bugs.
<!--l. 208--><p class="indent" >   The original version of <span 
class="cmss10">ALEPH</span>, as defined in the Aleph Manual <span class="cite">[<a 
href="#XA-manual">2</a>]</span>, treats the
compiled program as a single stand-alone text&#8212;complying to the practice of the time
when the language was designed. The present version adds modules by exploiting and
expanding the <span 
class="cmss-10">pragmat</span> construct resembling the <span 
class="cmss10">CDL2</span> approach. There are
several other extensions, changes and restrictions compared to the original
specification, hopefully all of them in the spirit of the original design of the
language.
<!--l. 218--><p class="indent" >   In this implementation both the compiler and the linker are written in <span 
class="cmss10">ALEPH</span> with two target languages:
standard <span 
class="cmss10">C</span> and javascript. The <span 
class="cmss10">ALEPH </span>source and the <span 
class="cmss10">C</span>
programs are available at
<div class="center" 
>
<!--l. 222--><p class="noindent" >   <a 
href="https://github.com/lcsirmaz/aleph" class="url" ><span 
class="cmtt10">https://github.com/lcsirmaz/aleph</span></a></div>
<!--l. 227--><p class="noindent" >
Budapest, Hungary<br>
Prague, Czech Republic
                                                                  
<!--l. 234--><p class="indent" >
                                                                  

                                                                  
<!--l. 234--><p class="noindent" >
   <h3 class="likesectionHead"><a 
 id="x1-20001"></a>Contents</h3>
   <div class="tableofcontents">
   <span class="sectionToc" >1 <a 
href="#x1-10001" id="QQ2-1-1">Preface</a></span>
<br />   <span class="sectionToc" >2 <a 
href="#x1-30002" id="QQ2-1-3">A bird&#8217;s eye overview of Aleph</a></span>
<br />   &#x00A0;<span class="subsectionToc" >2.1 <a 
href="#x1-40002.1" id="QQ2-1-4">Data types</a></span>
<br />   &#x00A0;<span class="subsectionToc" >2.2 <a 
href="#x1-50002.2" id="QQ2-1-5">Rules and calling a rule</a></span>
<br />   &#x00A0;<span class="subsectionToc" >2.3 <a 
href="#x1-60002.3" id="QQ2-1-6">Externals</a></span>
<br />   <span class="sectionToc" >3 <a 
href="#x1-70003" id="QQ2-1-7">Prototypes, modules and libraries</a></span>
<br />   &#x00A0;<span class="subsectionToc" >3.1 <a 
href="#x1-80003.1" id="QQ2-1-8">Prototypes</a></span>
<br />   &#x00A0;<span class="subsectionToc" >3.2 <a 
href="#x1-90003.2" id="QQ2-1-9">Modules</a></span>
<br />   &#x00A0;<span class="subsectionToc" >3.3 <a 
href="#x1-100003.3" id="QQ2-1-10">User libraries</a></span>
<br />   <span class="sectionToc" >4 <a 
href="#x1-110004" id="QQ2-1-11">Enhancements and changes</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.1 <a 
href="#x1-120004.1" id="QQ2-1-12">Program text representation</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.2 <a 
href="#x1-130004.2" id="QQ2-1-13">Hexadecimal constants</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.3 <a 
href="#x1-140004.3" id="QQ2-1-14">Relations</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.4 <a 
href="#x1-150004.4" id="QQ2-1-15">Lists in scalar context</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.5 <a 
href="#x1-160004.5" id="QQ2-1-16">Dummy affix</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.6 <a 
href="#x1-170004.6" id="QQ2-1-17">String as actual affix</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.7 <a 
href="#x1-180004.7" id="QQ2-1-18">Manifest constants</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.8 <a 
href="#x1-190004.8" id="QQ2-1-19">Extension syntax</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.9 <a 
href="#x1-200004.9" id="QQ2-1-20">Variable number of affixes</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.10 <a 
href="#x1-210004.10" id="QQ2-1-21">Classification</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.11 <a 
href="#x1-220004.11" id="QQ2-1-22">Expressions</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.12 <a 
href="#x1-230004.12" id="QQ2-1-23">Root rule</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.13 <a 
href="#x1-240004.13" id="QQ2-1-24">Actual and virtual limits</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.14 <a 
href="#x1-250004.14" id="QQ2-1-25">List declarers</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.15 <a 
href="#x1-260004.15" id="QQ2-1-26">Size estimate</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.16 <a 
href="#x1-270004.16" id="QQ2-1-27">List selectors</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.17 <a 
href="#x1-280004.17" id="QQ2-1-28">Matching formal and actual lists</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.18 <a 
href="#x1-290004.18" id="QQ2-1-29">Filling</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.19 <a 
href="#x1-300004.19" id="QQ2-1-30">Exit rule type</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.20 <a 
href="#x1-310004.20" id="QQ2-1-31">File area, file string</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.21 <a 
href="#x1-320004.21" id="QQ2-1-32">Static stack and static variable</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.22 <a 
href="#x1-330004.22" id="QQ2-1-33">Prototype</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.23 <a 
href="#x1-340004.23" id="QQ2-1-34">Pragmats</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.24 <a 
href="#x1-350004.24" id="QQ2-1-35">Conditional pragmats</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.25 <a 
href="#x1-360004.25" id="QQ2-1-36">Library mode</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.26 <a 
href="#x1-370004.26" id="QQ2-1-37">Macro substitution</a></span>
<br />   &#x00A0;<span class="subsectionToc" >4.27 <a 
href="#x1-380004.27" id="QQ2-1-38">Debugging tools</a></span>
<br />   <span class="sectionToc" >5 <a 
href="#x1-390005" id="QQ2-1-39">Modular Aleph</a></span>
<br />   &#x00A0;<span class="subsectionToc" >5.1 <a 
href="#x1-400005.1" id="QQ2-1-40">The module hierarchy</a></span>
<br />   &#x00A0;<span class="subsectionToc" >5.2 <a 
href="#x1-410005.2" id="QQ2-1-41">Finding tag definitions</a></span>
<br />   &#x00A0;<span class="subsectionToc" >5.3 <a 
href="#x1-420005.3" id="QQ2-1-42">Requiring and including source files</a></span>
<br />   &#x00A0;<span class="subsectionToc" >5.4 <a 
href="#x1-430005.4" id="QQ2-1-43">Using the namespace</a></span>
<br />   &#x00A0;<span class="subsectionToc" >5.5 <a 
href="#x1-440005.5" id="QQ2-1-44">Redefining a module resource</a></span>
                                                                  

                                                                  
<br />   &#x00A0;<span class="subsectionToc" >5.6 <a 
href="#x1-450005.6" id="QQ2-1-45">Redefining library items</a></span>
<br />   <span class="sectionToc" >6 <a 
href="#x1-460006" id="QQ2-1-46">Standard library</a></span>
<br />   &#x00A0;<span class="subsectionToc" >6.1 <a 
href="#x1-470006.1" id="QQ2-1-47">Stacks</a></span>
<br />   &#x00A0;<span class="subsectionToc" >6.2 <a 
href="#x1-480006.2" id="QQ2-1-48">Strings</a></span>
<br />   &#x00A0;<span class="subsectionToc" >6.3 <a 
href="#x1-490006.3" id="QQ2-1-49">File operations</a></span>
<br />   &#x00A0;<span class="subsectionToc" >6.4 <a 
href="#x1-500006.4" id="QQ2-1-50">Character output</a></span>
<br />   &#x00A0;<span class="subsectionToc" >6.5 <a 
href="#x1-510006.5" id="QQ2-1-51">Miscellaneous</a></span>
<br />   <span class="sectionToc" >7 <a 
href="#x1-520007" id="QQ2-1-52">Intermediate code: Alice</a></span>
<br />   &#x00A0;<span class="subsectionToc" >7.1 <a 
href="#x1-530007.1" id="QQ2-1-53">Alice item section</a></span>
<br />   &#x00A0;<span class="subsectionToc" >7.2 <a 
href="#x1-540007.2" id="QQ2-1-54">Alice data section</a></span>
<br />   &#x00A0;<span class="subsectionToc" >7.3 <a 
href="#x1-550007.3" id="QQ2-1-55">Alice rule section</a></span>
<br />   <span class="sectionToc" >8 <a 
href="#x1-590008" id="QQ2-1-59">Target code</a></span>
<br />   &#x00A0;<span class="subsectionToc" >8.1 <a 
href="#x1-600008.1" id="QQ2-1-60">Tables, stacks</a></span>
<br />   &#x00A0;<span class="subsectionToc" >8.2 <a 
href="#x1-610008.2" id="QQ2-1-61">Data file</a></span>
<br />   &#x00A0;<span class="subsectionToc" >8.3 <a 
href="#x1-620008.3" id="QQ2-1-62">Character file</a></span>
<br />   &#x00A0;<span class="subsectionToc" >8.4 <a 
href="#x1-630008.4" id="QQ2-1-63">Strings</a></span>
<br />   &#x00A0;<span class="subsectionToc" >8.5 <a 
href="#x1-640008.5" id="QQ2-1-64">Rules in <span 
class="cmss10">C</span></a></span>
<br />   &#x00A0;<span class="subsectionToc" >8.6 <a 
href="#x1-650008.6" id="QQ2-1-65">Externals</a></span>
<br />   &#x00A0;<span class="subsectionToc" >8.7 <a 
href="#x1-690008.7" id="QQ2-1-69">Assignment</a></span>
   </div>
                                                                  

                                                                  
                                                                  

                                                                  
<!--l. 238--><p class="indent" >
                                                                  

                                                                  
<!--l. 238--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">2   </span> <a 
 id="x1-30002"></a>A bird&#8217;s eye overview of Aleph</h3>
<!--l. 240--><p class="noindent" >The <span 
class="cmss10">ALEPH </span>manual <span class="cite">[<a 
href="#XA-manual">2</a>]</span> is an excellent introduction to the language and its usage. It
is written for novice programmers who have no or little experience. This section
contains a concise description focusing on the main differences between <span 
class="cmss10">ALEPH </span>and
modern programming languages.
<!--l. 245--><p class="indent" >   By design, an <span 
class="cmss10">ALEPH </span>program can be considered to be a top-down <span 
class="cmss10">LL(1)</span>
parser<span class="cite">[<a 
href="#Xaho-ullman">1</a>]</span>. <span 
class="cmss10">ALEPH </span>procedures are called <span 
class="cmti-10">rules</span>, and return either <span 
class="cmti-10">success </span>or <span 
class="cmti-10">failure</span>,
implying whether a derived instance of the rule has been recognized (and processed)
or not. To enhance the expressive power of context-free parsers, <span 
class="cmss10">ALEPH</span>
rules can be equipped with <span 
class="cmti-10">affixes</span>. Affixes carry auxiliary, context sensitive
information. The syntax of <span 
class="cmss10">ALEPH </span>follows the tradition of affix grammars <span class="cite">[<a 
href="#Xwijn">8</a>]</span>
by using the <span 
class="ec-lmtt-10">+</span> sign to separate the procedure (rule) name and parameters
(affixes).
<!--l. 256--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">2.1   </span> <a 
 id="x1-40002.1"></a>Data types</h4>
<!--l. 258--><p class="noindent" >The basic data type of <span 
class="cmss10">ALEPH </span>is the <span 
class="cmti-10">word</span>, which is the storage unit in the target
machine. A word can be considered either as a bit sequence interpreted as a signed
integer value, or as a pointer which determines a location in the virtual memory. The
virtual memory is a sequence of words indexed by words, and is populated partially
by <span 
class="cmss-10">table</span>s and <span 
class="cmss-10">stack</span>s, jointly named <span 
class="cmti-10">list</span>s. Tables and stacks occupy disjoint (and
far away) segments of the virtual memory. A stack can grow and shrink at
its upper end, and shrink at its lower end, while the position and size of
tables are fixed and never change. Pointers can only point to a table or stack
element (and not to a variable), and a pointer value determines uniquely
the list it points into. Elements of a <span 
class="cmss-10">stack</span> can be modified (but not their
virtual addresses), while elements of a <span 
class="cmss-10">table</span> are &#8220;read only&#8221; and do not
change.
<!--l. 272--><p class="indent" >   Consecutive locations in a <span 
class="cmss-10">table</span> or in a <span 
class="cmss-10">stack</span> can be grouped together either to a
fixed size <span 
class="cmti-10">block </span>or to a <span 
class="cmti-10">string</span>. Such a group is pointed to by its last (topmost or
rightmost, having the largest address) element. Elements in a block are identified
relative to its address by <span 
class="cmti-10">selectors</span>. A <span 
class="cmss-10">stack</span> is extended by specifying the elements of a
new block using its selectors; the block is added to the top of the stack
extending its actual range.
<!--l. 280--><p class="indent" >   Strings are also stored at consecutive locations of a list, and behave like black
boxes and can be manipulated by predefined routines only, see <a
href="#x1-60002.3">Section 2.3<!--tex4ht:ref: subsec:bird-ext --></a>. This way
<span 
class="cmss10">ALEPH </span>does not determine how characters in a string are stored, allowing
compressed storage of a large character set. Strings can be unpacked to a list of
characters, and a list of characters can be packed into a string which is pushed to the
top of a stack.
<!--l. 287--><p class="indent" >   There are no uninitialized global or local values in an <span 
class="cmss10">ALEPH </span>program. Variables
and lists are initialized when they are declared; and a stack can be extended only by
supplying all values for the extension.
                                                                  

                                                                  
<!--l. 291--><p class="indent" >   Finally, for communicating with the outside world, <span 
class="cmss10">ALEPH </span>distinguishes character
and data files. Files can be opened and closed, character files can send and receive
characters. In a data file each entry is marked as either a word or as a pointer to one
of the lists associated with the file. While reading, pointer values are automatically
adjusted, which allows an automatic transfer of pointers from one <span 
class="cmss10">ALEPH </span>program to
another.
<!--l. 298--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">2.2   </span> <a 
 id="x1-50002.2"></a>Rules and calling a rule</h4>
<!--l. 300--><p class="noindent" >In <span 
class="cmss10">ALEPH </span>parlance procedures are <span 
class="cmss-10">rule</span>s, and its parameters are <span 
class="cmss-10">affix</span>es. When
writing a call affixes are added to the called rule identifier using <span 
class="ec-lmtt-10">+</span> signs as
in
  <!--l. 303--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#x00A0;rule</span><span 
class="ec-lmtt-10">&#x00A0;+</span><span 
class="ec-lmtt-10">&#x00A0;affix1</span><span 
class="ec-lmtt-10">&#x00A0;+</span><span 
class="ec-lmtt-10">&#x00A0;stack</span><span 
class="ec-lmtt-10">&#x00A0;+</span><span 
class="ec-lmtt-10">&#x00A0;file</span><span 
class="ec-lmtt-10">&#x00A0;+</span><span 
class="ec-lmtt-10">&#x00A0;-42.</span></div>
<!--l. 306--><p class="noindent" >Each actual affix is either a word (a constant, a variable, or an indexed
list element), a list (stack or table), or a file. No compound affixes (e.g.,
expressions) are allowed. A rule either returns a logical value or returns
nothing, while it can have several &#8220;out&#8221; affixes for returning computed values.
The required affix types are specified in the head of the rule declaration
as
  <!--l. 313--><p class="noindent" ><div class="obeylines-v">
<span
class="ec-lmtt-10">&#x00A0;rule</span><span 
class="ec-lmtt-10">&#x00A0;+</span><span 
class="ec-lmtt-10">&#x00A0;&#x003E;affix1&#x003E;</span><span 
class="ec-lmtt-10">&#x00A0;+</span><span 
class="ec-lmtt-10">&#x00A0;[]stack[]+</span><span 
class="ec-lmtt-10">&#x00A0;""file</span><span 
class="ec-lmtt-10">&#x00A0;+</span><span 
class="ec-lmtt-10">&#x00A0;&#x003E;affix2</span></div>
<!--l. 316--><p class="noindent" >The first affix <span 
class="ec-lmtt-10">affix1</span> both receives and returns a word value; the second
affix is a stack, the third one is a file, finally <span 
class="ec-lmtt-10">affix2</span> receives a word value
but does not return anything (and the rule body can use <span 
class="ec-lmtt-10">affix2</span> as a local
variable).
<!--l. 322--><p class="indent" >   The control flow in the rule body is quite
simple. The rule body is a sequence of
alternatives probed in the order of their presence. An alternative is a sequence of
members guarded by its first member. If this first member succeeds, the alternative is
chosen and the remaining members are executed; otherwise the next alternative is
probed. Jumps are allowed only as an abbreviation for tail recursion. There are no
repetitive statements at all, iteration must be handled by recursion. Next
to rule calls a member can be a <span 
class="cmss-10">compound member</span> or an <span 
class="cmss-10">extension</span>. The
compound member is an (implicit) rule definition enclosed in parentheses,
while an extension adds a block of specified number of values to the top of a
<span 
class="cmss-10">stack</span>.
<!--l. 333--><p class="indent" >   Due to its simplicity, the control flow inside a rule is tractable. Liveliness and
reachability properties can be checked statically during compilation. In particular,
the <span 
class="cmss10">ALEPH </span>compiler checks statically that in a rule
   <ul class="itemize0">
   <li class="itemize">
   <!--l. 338--><p class="noindent" >all members are reachable;
   </li>
   <li class="itemize">
                                                                  

                                                                  
   <!--l. 339--><p class="noindent" >the flow can always reach a return point;
   </li>
   <li class="itemize">
   <!--l. 340--><p class="noindent" >when a local variable or parameter is used it has an assigned value (it is not
   &#8220;uninitialized&#8221;);
   </li>
   <li class="itemize">
   <!--l. 342--><p class="noindent" >an out parameter has been assigned a value along all paths ending in a
   return point;
   </li>
   <li class="itemize">
   <!--l. 344--><p class="noindent" >if a local variable (or parameter) has been assigned a value, it is actually
   used.</li></ul>
<!--l. 348--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">2.3   </span> <a 
 id="x1-60002.3"></a>Externals</h4>
<!--l. 350--><p class="noindent" >Basic data manipulation, such as addition, comparison of words (as integers), and
similar operations are done by standard external rules. As an example, <span 
class="ec-lmtt-10">incr+x</span>
increases the value of its argument by one; <span 
class="ec-lmtt-10">equal+x+y</span> tests for equality, returning
<span 
class="cmti-10">success </span>if <span 
class="ec-lmtt-10">x</span> and <span 
class="ec-lmtt-10">y</span> are equal, and <span 
class="cmti-10">failure </span>otherwise. Some externals have
equivalent syntactic variants, such as the assignment (called <span 
class="cmss-10">transport</span> in <span 
class="cmss10">ALEPH</span>)
<span 
class="ec-lmtt-10">make+src+dest</span>, which can also be written as <span 
class="ec-lmtt-10">src-&#x003E;dest</span>, or <span 
class="ec-lmtt-10">equal+x+y</span>, which can
also be written as <span 
class="ec-lmtt-10">x=y</span>.
<!--l. 359--><p class="indent" >   All file operations are also done by externals. Standard external are used for
stack operations (such as shrinking), and for manipulating strings. Externals can be
redefined; this feature allows to mimic overloading the basic operators, for an
example see <a 
href="#x1-450005.6">Section 5.6<!--tex4ht:ref: subsec:redef-library --></a>.
                                                                  

                                                                  
<!--l. 366--><p class="indent" >
                                                                  

                                                                  
<!--l. 366--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">3   </span> <a 
 id="x1-70003"></a>Prototypes, modules and libraries</h3>
<!--l. 368--><p class="noindent" >The <span 
class="cmss10">ALEPH </span>Manual <span class="cite">[<a 
href="#XA-manual">2</a>]</span>, the official definition of the language, has several revisions.
All of them were published by the Mathematisch Centrum, Amsterdam, between
1974 and 1982. Implementations of a computer language frequently add new features,
while restrict or leave out others. This happened with <span 
class="cmss10">ALEPH </span>as well; changes in the
<span 
class="cmss10">ALEPH </span>manual reflect the evolution as new applications and new compilers
appreared. The present implementation, and usage, of the <span 
class="cmss10">ALEPH </span>language is no
exception. Making modular programming possible&#8212;as opposed to monolith programs
prevalent at the time of the inception of <span 
class="cmss10">ALEPH</span>&#8212;required new features. Other
extensions and restrictions came naturally; some of them date back to the time of the
first <span 
class="cmss10">ALEPH </span>compilers. All changes made in this implementation hopefully
respect the original design ideas and philosophy as described in <span class="cite">[<a 
href="#Xgrune">3</a>]</span>. For
a more detailed description of the changes and new features see
<a 
href="#x1-110004">Section 4<!--tex4ht:ref: sec:changes --></a>.
<!--l. 383--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">3.1   </span> <a 
 id="x1-80003.1"></a>Prototypes</h4>
<!--l. 385--><p class="noindent" >The original <span 
class="cmss10">ALEPH </span>specification has no prototypes, but prototypes are indispensable
when the program is split into smaller modules to be compiled independently.
Each module should have complete information on all constructs (rules,
variables, lists, etc.) it imports, and should provide that information on constructs it
exports. Prototypes, the stripped down declaration heads, are just the right
constructs for this purpose.
<!--l. 392--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">3.2   </span> <a 
 id="x1-90003.2"></a>Modules</h4>
<!--l. 394--><p class="noindent" >An <span 
class="cmss10">ALEPH </span>module provides certain resources to the main program and to other
modules, and is compiled independently. An <span 
class="cmss10">ALEPH </span>program or module can <span 
class="cmti-10">require</span>
resources provided by other modules, and a module can <span 
class="cmti-10">provide </span>resources defined
within it. Accordingly, an <span 
class="cmss10">ALEPH </span>module is split into a <span 
class="cmti-10">public </span>and a <span 
class="cmti-10">private </span>part.
The public part specifies the provided items using prototypes, while the private part
contains the realization of those resources. When the module is required,
only the public part is processed. When the module is compiled, both the
public and private parts are read, and the compiler checks that all
items this module promises to export are indeed provided by its private
part.
<!--l. 406--><p class="indent" >   The public part of a module may contain genuine declarations next to the list of
export prototypes, and may require additional modules. Declarations in the public
part are compiled into every invoking program locally.
<!--l. 410--><p class="indent" >   If an <span 
class="cmss10">ALEPH </span>module <span 
class="ec-lmtt-10">A</span> requests another module <span 
class="ec-lmtt-10">B</span>, then the terminology &#8220;<span 
class="ec-lmtt-10">B</span> is
directly visible from <span 
class="ec-lmtt-10">A</span>&#8221;, or &#8220;<span 
class="ec-lmtt-10">B</span> is immediately above <span 
class="ec-lmtt-10">A</span>&#8221; is used. The module <span 
class="ec-lmtt-10">B</span> is <span 
class="cmti-10">above</span>
<span 
class="ec-lmtt-10">A</span> if there is such a visibility chain from <span 
class="ec-lmtt-10">A</span> to <span 
class="ec-lmtt-10">B</span>. Resources provided by a module are
                                                                  

                                                                  
available to every other module which are below it, except for those resources which
are redefined by some intermediate module. The original resource can still be
reached using <span 
class="cmti-10">qualifiers</span>. In general, the same resource can be provided by
several visible modules, in which case the module with the smallest rank (that
is, the smallest number of hops in immediate visibility) is chosen as the
provider.
<!--l. 422--><p class="indent" >   Requested modules are processed only once, thus no special measures should be
taken when the visibility is circular. This is the case, for example, when module <span 
class="ec-lmtt-10">A</span>
requires <span 
class="ec-lmtt-10">B</span>, and module <span 
class="ec-lmtt-10">B</span> requires <span 
class="ec-lmtt-10">A</span>. For a more detailed description on <span 
class="cmss10">ALEPH</span>
modules see <a 
href="#x1-390005">Section 5<!--tex4ht:ref: section:module --></a>.
<!--l. 428--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">3.3   </span> <a 
 id="x1-100003.3"></a>User libraries</h4>
<!--l. 430--><p class="noindent" >An <span 
class="cmss10">ALEPH </span>module can be designated as a <span 
class="cmti-10">user library</span>. Resources provided by such a
library module are automatically available to all non-library modules, but only as a
last resort if no other definition was found.
<!--l. 435--><p class="indent" >   In general, resources provided by a plain module <span 
class="ec-lmtt-10">A</span> are not automatically avaiable
for other modules, only if <span 
class="ec-lmtt-10">A</span> is required (possibly through a request chain) explicitly.
In contrast, designating <span 
class="ec-lmtt-10">A</span> as a user library, any module can use resources provided by
<span 
class="ec-lmtt-10">A</span> without requesting it. A user library can request other modules; these requests
determine another visibility structure which is independent of, and is above, the
visibility structure of the plain modules. Resources provided by the collection
of user libraries are those provided by all modules in the library visibility
structure.
<!--l. 445--><p class="indent" >   There is another library layer above the user libraries starting with a single
<span 
class="cmti-10">standard </span><span 
class="cmss10">ALEPH </span><span 
class="cmti-10">library </span>module. This extra layer provides the implementation of
basic <span 
class="cmss10">ALEPH </span>primitives as required by the Manual <span class="cite">[<a 
href="#XA-manual">2</a>]</span>. Consequently, a user library
module can use (and redefine transparently if it chooses so) all the primitives defined
in the standard library without any further arrangements.
                                                                  

                                                                  
<!--l. 456--><p class="indent" >
                                                                  

                                                                  
<!--l. 456--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">4   </span> <a 
 id="x1-110004"></a>Enhancements and changes</h3>
<!--l. 461--><p class="noindent" >This extensive section describes the main changes between the implemented language
and the language specified in the <span 
class="cmss10">ALEPH </span>manual <span class="cite">[<a 
href="#XA-manual">2</a>]</span>. The description assumes a basic
level familiarity with the <span 
class="cmss10">ALEPH </span>language.
<!--l. 467--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.1   </span> <a 
 id="x1-120004.1"></a>Program text representation</h4>
<!--l. 469--><p class="noindent" ><span 
class="cmss10">ALEPH </span>is an Algol-like language <span class="cite">[<a 
href="#Xa68">9</a>]</span> in which keywords are distinguished by a
different typeface. Practical coding, however, uses a single (monospace) typeface.
There are several approaches to distinguish keywords from the surrounding text but
none of them is perfect. This implementation requires keywords to be enclosed
between apostrophe characters such as in this example:
  <!--l. 475--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">variable</span><span 
class="ec-lmtt-10">&#8217;x=0.</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">root</span><span 
class="ec-lmtt-10">&#8217;print</span><span 
class="ec-lmtt-10">&#x00A0;int+STDOUT+x.</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">end</span><span 
class="ec-lmtt-10">&#8217;</span></div>
<!--l. 480--><p class="noindent" >Other possibilities are: using capital letters for keywords (as in several <span 
class="cmss10">PASCAL</span>
implementations); restricting keywords (as in <span 
class="cmss10">C </span>and related languages); using an
initial escape character and whitespace at the end (e.g., leaving out the closing
apostrophe); and so on. This choice reflects the influence of <span 
class="cmss10">ALGOL68 </span><span class="cite">[<a 
href="#Xa68">9</a>]</span> on <span 
class="cmss10">ALEPH</span>
and on its relatives.
<!--l. 487--><p class="indent" >   Characters in <span 
class="cmss10">ALEPH </span>are not restricted to single byte characters as
<span 
class="cmss10">ALEPH </span>strings cannot be manipulated directly. This implementation allows any
unicode character as a string character. According to the <span 
class="cmss10">ALEPH </span>Manual <span 
class="ec-lmtt-10">newline</span>
and <span 
class="ec-lmtt-10">newpage</span> are not characters. This implementation relaxes this restriction. A
newline character (with code <span 
class="ec-lmtt-10">10</span>) can be part of a string, but not of a <span 
class="cmss-10">string</span>
<span 
class="cmss-10">denotation</span> (a string appearing in the program text). In the program text all
strings should be closed in the same line they start. Two separate consecutive
strings separated by white spaces (even if they are on different lines) are
concatenated, thus strings can be continued on the next line, but cannot contain
newline characters. There is no escape character either, and presenting a
quotation mark in the string it should be doubled forming a <span 
class="cmss-10">quote image</span>.
Thus
<!--l. 503--><p class="noindent" >  <span 
class="ec-lmtt-10 smallsize">"a" "b"</span>        is a concatenation and has two characters: <span 
class="ec-lmtt-10">/a/</span> and <span 
class="ec-lmtt-10">/b/</span>;
<!--l. 506--><p class="noindent" >  <span 
class="ec-lmtt-10 smallsize">"a""b"</span>         has three characters: <span 
class="ec-lmtt-10">/a/</span>, <span 
class="ec-lmtt-10">/"/</span> and <span 
class="ec-lmtt-10">/b/</span>.
<!--l. 509--><p class="noindent" >A character written between slash characters represents its unicode value, in
particular the code for the slash character is written as <span 
class="ec-lmtt-10">///</span>.
<!--l. 514--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.2   </span> <a 
 id="x1-130004.2"></a>Hexadecimal constants</h4>
<!--l. 516--><p class="noindent" >Wherever an <span 
class="cmss-10">integer denotation</span> is accepted, a hexadecimal constant is recognized and
accepted as well. An example is <span 
class="ec-lmtt-10">0x1234abcd</span>. The minus sign can also appear before
                                                                  

                                                                  
a hexadecimal constant, such as <span 
class="ec-lmtt-10">-0xffff</span>. While no white space is allowed inside a
decimal or hexadecimal constant, there can be spaces between the minus sign and the
following number.
<!--l. 524--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.3   </span> <a 
 id="x1-140004.3"></a>Relations</h4>
<!--l. 526--><p class="noindent" >The external rule <span 
class="ec-lmtt-10">equal+x+y</span> tests for equality of <span 
class="ec-lmtt-10">x</span> and <span 
class="ec-lmtt-10">y</span>. The same test can be
written equivalently as the <span 
class="cmss-10">relation</span> <span 
class="ec-lmtt-10">x=y</span>. Similar shorthands are added for other
comparison operators:
<div class="obeylines-v" style="color:black">
<!--l. 532--><p class="noindent" >  <span 
class="ec-lmtt-10 smallsize">x!=y</span>           <span 
class="ec-lmtt-10">x</span> and <span 
class="ec-lmtt-10">y</span> differ;
<!--l. 534--><p class="noindent" >  <span 
class="ec-lmtt-10 smallsize">x&#x003C;=y</span>           <span 
class="ec-lmtt-10">x</span> is less than or equal to <span 
class="ec-lmtt-10">y</span>;
<!--l. 536--><p class="noindent" >  <span 
class="ec-lmtt-10 smallsize">x&#x003C;y</span>            <span 
class="ec-lmtt-10">x</span> is smaller than <span 
class="ec-lmtt-10">y</span>;
<!--l. 538--><p class="noindent" >  <span 
class="ec-lmtt-10 smallsize">x&#x003E;y</span>            <span 
class="ec-lmtt-10">x</span> is greater than <span 
class="ec-lmtt-10">y</span>;
<!--l. 540--><p class="noindent" >  <span 
class="ec-lmtt-10 smallsize">x&#x003E;=y</span>           <span 
class="ec-lmtt-10">x</span> is greater than or equal to <span 
class="ec-lmtt-10">y</span>.</div>
<!--l. 544--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.4   </span> <a 
 id="x1-150004.4"></a>Lists in scalar context</h4>
<!--l. 546--><p class="noindent" >In an actual affix position where a single word is required, a list <span 
class="ec-lmtt-10">L</span> (a <span 
class="cmss-10">table</span> or <span 
class="cmss-10">stack</span>)
can also appear with the meaning that the value it represents is that of its topmost
(rightmost) element, namely, <span 
class="ec-lmtt-10">L[&#x003E;&#x003E;L]</span>. The same abbreviation can be used with
selectors. Thus the rule call
  <!--l. 551--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">add</span><span 
class="ec-lmtt-10">&#x00A0;+</span><span 
class="ec-lmtt-10">&#x00A0;a*L</span><span 
class="ec-lmtt-10">&#x00A0;+</span><span 
class="ec-lmtt-10">&#x00A0;b*L</span><span 
class="ec-lmtt-10">&#x00A0;+</span><span 
class="ec-lmtt-10">&#x00A0;c*L</span></div>
<!--l. 554--><p class="noindent" >is equivalent to
  <!--l. 556--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">add</span><span 
class="ec-lmtt-10">&#x00A0;+</span><span 
class="ec-lmtt-10">&#x00A0;a*L[&#x003E;&#x003E;L]</span><span 
class="ec-lmtt-10">&#x00A0;+</span><span 
class="ec-lmtt-10">&#x00A0;b*L[&#x003E;&#x003E;L]</span><span 
class="ec-lmtt-10">&#x00A0;+</span><span 
class="ec-lmtt-10">&#x00A0;c*L[&#x003E;&#x003E;L].</span></div>
<!--l. 559--><p class="noindent" >Using this extension a stack looks&#8212;and behaves&#8212;like a variable, which makes
writing and comprehending stack operations easier. This extension comes handy
when the content of a newly added block on the top of a stack is to be manipulated.
The drawback is that it prevents the compiler reporting a parameter type mismatch
when a list is used for a plain value by mistake. This extension causes, quite
unexpectedly, extra complications during macro substitution, see <a 
href="#x1-370004.26">Section 4.26<!--tex4ht:ref: sec:macro --></a> for
details.
<!--l. 572--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.5   </span> <a 
 id="x1-160004.5"></a>Dummy affix</h4>
<!--l. 574--><p class="noindent" >When the value of an out formal affix is not needed (the value is thrown away),
rather than forcing the programmer to invent some dummy variable, the <span 
class="cmss-10">dummy</span>
<span 
class="cmss-10">symbol</span> can be used with the meaning that the returned value will not be used. This
implementation encourages the character <span 
class="ec-lmtt-10">#</span> for this purpose, while the official
representation <span 
class="ec-lmtt-10">?</span> is also accepted.
                                                                  

                                                                  
<!--l. 582--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.6   </span> <a 
 id="x1-170004.6"></a>String as actual affix</h4>
<!--l. 584--><p class="noindent" >A <span 
class="cmss-10">string denotation</span> can be used as an <span 
class="cmss-10">actual affix</span>. This extension simplifies writing
program texts as the actual string can appear where it is used. Without this feature
strings are to be put into a table with a pointer constant pointing to them,
and then the string is identified by the table name and the string pointer
together:
  <!--l. 589--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">table</span><span 
class="ec-lmtt-10">&#8217;MESSAGE=("unknown</span><span 
class="ec-lmtt-10">&#x00A0;identifier":unknown</span><span 
class="ec-lmtt-10">&#x00A0;tag).</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">action</span><span 
class="ec-lmtt-10">&#8217;tag</span><span 
class="ec-lmtt-10">&#x00A0;error:</span><span 
class="ec-lmtt-10">&#x00A0;error+MESSAGE+unknown</span><span 
class="ec-lmtt-10">&#x00A0;tag.</span>
</div>
<!--l. 593--><p class="noindent" >With this extension the string can appear directly as an actual affix:
  <!--l. 595--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">action</span><span 
class="ec-lmtt-10">&#8217;tag</span><span 
class="ec-lmtt-10">&#x00A0;error:</span><span 
class="ec-lmtt-10">&#x00A0;error+"unknown</span><span 
class="ec-lmtt-10">&#x00A0;identifier".</span>
</div>
<!--l. 598--><p class="noindent" >The string denotation translates into two affixes: first, a special internal table (which
is not available in any other way), and second, a pointer which points to the string in
that table.
<!--l. 605--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.7   </span> <a 
 id="x1-180004.7"></a>Manifest constants</h4>
<!--l. 607--><p class="noindent" >Manifest constants start and end with an underscore, and are replaced either by an
integer or by a string while scanning the source text. In particular, they are
replaced before macro substitution, thus <span 
class="ec-lmtt-10">_line_</span> and <span 
class="ec-lmtt-10">_rule_</span> in a macro text
reflect the source line of the macro definition and the macro name, and
not those of the invoking rule. Similarly, <span 
class="ec-lmtt-10">_title_</span> and <span 
class="ec-lmtt-10">_module_</span> expands to
the empty string if they appear before the corresponding <span 
class="ec-lmtt-10">title</span> or <span 
class="ec-lmtt-10">module</span>
pragmat.
<!--l. 618--><p class="noindent" >  <span 
class="ec-lmtt-10 smallsize">_line_</span>
      integer, the source line number this constant appears in
<!--l. 621--><p class="noindent" >  <span 
class="ec-lmtt-10 smallsize">_file_</span>
      string, name of the source file
<!--l. 623--><p class="noindent" >  <span 
class="ec-lmtt-10 smallsize">_module_</span>
    string, module name as set by the <span 
class="ec-lmtt-10">module=MMM</span> pragmat
<!--l. 625--><p class="noindent" >  <span 
class="ec-lmtt-10 smallsize">_title_</span>
     string, the title as set by the <span 
class="ec-lmtt-10">title="XXX"</span> pragmat
<!--l. 627--><p class="noindent" >  <span 
class="ec-lmtt-10 smallsize">_rule_</span>
      string, the rule name if used inside a rule definition.
<!--l. 631--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.8   </span> <a 
 id="x1-190004.8"></a>Extension syntax</h4>
<!--l. 633--><p class="noindent" >An <span 
class="cmss-10">extension</span> adds a new block to the top of a (formal or global) stack. An extension
is specified as a sequence of assignments where the destinations are selectors of the
block to be added. This list is enclosed between <span 
class="ec-lmtt-10">*</span> symbols and followed by
the list tag. If the <span 
class="cmss-10">stack</span> <span 
class="ec-lmtt-10">st</span> has three selectors <span 
class="ec-lmtt-10">sel</span>, <span 
class="ec-lmtt-10">ect</span>, and <span 
class="ec-lmtt-10">ors</span>, then the
<span 
class="cmss-10">extension</span>
  <!--l. 639--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;*</span><span 
class="ec-lmtt-10">&#x00A0;pnt-&#x003E;sel,</span><span 
class="ec-lmtt-10">&#x00A0;0-&#x003E;ect-&#x003E;ors</span><span 
class="ec-lmtt-10">&#x00A0;*</span><span 
class="ec-lmtt-10">&#x00A0;st</span>
</div>
<!--l. 642--><p class="noindent" >extends <span 
class="ec-lmtt-10">st</span> with a block of three elements. To make the extensions visually more
appealing, parentheses can be inserted as follows:
                                                                  

                                                                  
  <!--l. 645--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;(*</span><span 
class="ec-lmtt-10">&#x00A0;pnt-&#x003E;sel,</span><span 
class="ec-lmtt-10">&#x00A0;0-&#x003E;ect-&#x003E;ors</span><span 
class="ec-lmtt-10">&#x00A0;*)</span><span 
class="ec-lmtt-10">&#x00A0;st</span>
</div>
<!--l. 648--><p class="noindent" >Accepting both extension forms destroys the <span 
class="cmss10">LL(1)</span> property of the <span 
class="cmss10">ALEPH </span>syntax. It
is so as a <span 
class="ec-lmtt-10">(*</span> sequence can be either the start of an <span 
class="cmss-10">extension</span>, or that of a <span 
class="cmss-10">compound</span>
<span 
class="cmss-10">block</span> which has an <span 
class="cmss-10">extension</span> as its first <span 
class="cmss-10">member</span>. This compiler solves this problem by
doing a reasonable amount of look-ahead. Nevertheless, the compiler issues a
warning when it finds an old style extension and ecourages the alternate
syntax.
<!--l. 658--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.9   </span> <a 
 id="x1-200004.9"></a>Variable number of affixes</h4>
<!--l. 660--><p class="noindent" >Allowing and handling a variable number of rule affixes is one of the main novelties of
this implementation. Variable number of affixes raises several problems, and poses a
potential obstacle for control flow tractability. The used approach meets the following
two main requirements: it provides a flexible and usable variable argument
mechanism, while keeping all tractability properties of an <span 
class="cmss10">ALEPH </span>program. This is
achieved by restricting how the &#8220;invisible&#8221; affixes in a variable affix block can be
accessed.
<!--l. 669--><p class="indent" >   A <span 
class="cmss-10">formal affix sequence</span>, which defines the number and types of affixes the <span 
class="cmss-10">rule</span>
accepts, may contain the <span 
class="cmss-10">anchor symbol</span> <span 
class="ec-lmtt-10">@</span> indicating the position from which point
affixes to the right end of the list can be repeated indefinitely in a call to this rule.
The declaration of <span 
class="ec-lmtt-10">sum</span> in the snippet
  <!--l. 675--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">function</span><span 
class="ec-lmtt-10">&#8217;sum+a&#x003E;+@+&#x003E;b+&#x003E;c:</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;0-&#x003E;a,(nxt:add+a+b+a,add+a+c+a,</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;(shift</span><span 
class="ec-lmtt-10">&#x00A0;affix</span><span 
class="ec-lmtt-10">&#x00A0;block+@,:nxt;+)).</span>
</div>
<!--l. 681--><p class="noindent" >has the single out affix <span 
class="ec-lmtt-10">a</span>, and two input affixes <span 
class="ec-lmtt-10">b</span> and <span 
class="ec-lmtt-10">c</span>, the latter two forming the
<span 
class="cmss-10">repeat block</span>. Invoking this rule requires three, five, seven, and so on actual affixes.
The first three of the actual affixes are matched against the formal affixes <span 
class="ec-lmtt-10">a</span>, <span 
class="ec-lmtt-10">b</span>, and <span 
class="ec-lmtt-10">c</span>
in this order. The rule body starts by setting <span 
class="ec-lmtt-10">a</span> to zero. The two <span 
class="ec-lmtt-10">add</span> rules after the
label <span 
class="ec-lmtt-10">nxt</span> add <span 
class="ec-lmtt-10">b</span> and <span 
class="ec-lmtt-10">c</span> to <span 
class="ec-lmtt-10">a</span>. The built-in routine <span 
class="ec-lmtt-10">shift affix block</span> shifts out the
visible affix block at <span 
class="ec-lmtt-10">b</span> and <span 
class="ec-lmtt-10">c</span> and moves the next block into this place, assuming that
there is still a pending, unseen block. If there is none, the rule <span 
class="ec-lmtt-10">shift affix block</span>
fails, and <span 
class="ec-lmtt-10">sum</span> ends indicated by the next <span 
class="cmss-10">alternative</span> <span 
class="ec-lmtt-10">+</span>. Otherwise a jump is made to
the label <span 
class="ec-lmtt-10">nxt</span>, where the next group of two input affixes are added to <span 
class="ec-lmtt-10">a</span>. In
summary, <span 
class="ec-lmtt-10">sum</span> adds up all of its input arguments and returns their sum in
<span 
class="ec-lmtt-10">a</span>.
<!--l. 697--><p class="indent" >   The main point which guarantees the tractability of the data flow is that
shifted out blocks are lost to this rule, and there is no way to reach the affixes
there.
<!--l. 701--><p class="indent" >   In a rule call the anchor symbol <span 
class="ec-lmtt-10">@</span> can appear only as the last actual affix with the
meaning that the present (visible) and all subsequent (pending) affix blocks of
the actual calling rule are passed as arguments. The rule <span 
class="ec-lmtt-10">neg</span> defined
as
                                                                  

                                                                  
  <!--l. 705--><p class="noindent" ><div class="obeylines-v">
 <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">function</span><span 
class="ec-lmtt-10">&#8217;neg+a&#x003E;+@+&#x003E;b+&#x003E;c-z:</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;add+b+c+a,(shift</span><span 
class="ec-lmtt-10">&#x00A0;affix</span><span 
class="ec-lmtt-10">&#x00A0;block+@,sum+z+@,subtr+a+z+a;+).</span>
</div>
<!--l. 709--><p class="noindent" >adds up the first two of its input affixes <span 
class="ec-lmtt-10">b</span> and <span 
class="ec-lmtt-10">c</span>; if there are no more affixes, then
this sum is the result. Otherwise, it calls <span 
class="ec-lmtt-10">sum</span> to add up the value of the rest
affixes, and then subtract the result from the sum of the first two. Thus the
calls
  <!--l. 714--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#x00A0;neg+x+3+4,</span><span 
class="ec-lmtt-10">&#x00A0;neg+y+3+4+0+1,</span><span 
class="ec-lmtt-10">&#x00A0;neg+z+3+4+0+1+x+y</span>
</div>
<!--l. 717--><p class="noindent" >put 7 to <span 
class="ec-lmtt-10">x</span>, 6 to <span 
class="ec-lmtt-10">y</span>, and -7 to <span 
class="ec-lmtt-10">z</span>.
<!--l. 720--><p class="indent" >   The built-in routine <span 
class="ec-lmtt-10">get affix blockno+n&#x003E;+@</span> returns the number of pending
affix blocks in <span 
class="ec-lmtt-10">n</span>. This number is always positive and it is <span 
class="ec-lmtt-10">1</span> if and only if <span 
class="ec-lmtt-10">shift affix block+@</span> would fail.
<!--l. 724--><p class="indent" >   The main application of variable number of arguments is formatted printing. In
the <span 
class="cmss10">ALEPH </span>compiler this feature has been used mainly to format error messages, but
it also turned out to be useful in code generation. Rudimentary formatted printing
can start with the format string passed by two affixes: the table and the string
pointer. Format characters starting with <span 
class="ec-lmtt-10">%</span> require a corresponding affix. When
encountering a format char, the affix list is shifted and the next argument, together
with the format char, is passed to the rule <span 
class="ec-lmtt-10">handle format char</span>, as is done in the
program snippet
  <!--l. 732--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">action</span><span 
class="ec-lmtt-10">&#8217;format</span><span 
class="ec-lmtt-10">&#x00A0;print+T[]+@+&#x003E;arg-fmt-n-ch:</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;arg-&#x003E;fmt,0-&#x003E;n,</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;fmt</span><span 
class="ec-lmtt-10">&#x00A0;is</span><span 
class="ec-lmtt-10">&#x00A0;the</span><span 
class="ec-lmtt-10">&#x00A0;string</span><span 
class="ec-lmtt-10">&#x00A0;pointer</span><span 
class="ec-lmtt-10">&#x00A0;$</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;(nxt:string</span><span 
class="ec-lmtt-10">&#x00A0;elem+T+fmt+n+ch,incr+n,</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;((ch=/%/,string</span><span 
class="ec-lmtt-10">&#x00A0;elem+T+fmt+n+ch,incr+n,</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;shift</span><span 
class="ec-lmtt-10">&#x00A0;affix</span><span 
class="ec-lmtt-10">&#x00A0;block+@),</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;handle</span><span 
class="ec-lmtt-10">&#x00A0;format</span><span 
class="ec-lmtt-10">&#x00A0;char+ch+arg,:nxt;</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;printchar+ch,:nxt);</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;+).</span></div>
<!--l. 742--><p class="noindent" >Another application could be pushing and popping an unspecified number of
elements to and from a stack. We remark that the rule <span 
class="ec-lmtt-10">pop</span> below works correctly
only when the actual stack <span 
class="ec-lmtt-10">st</span> has calibre (block size) exactly one, as <span 
class="ec-lmtt-10">unstack+st</span>
discards a complete block and not a single element from the stack, see <a 
href="#x1-280004.17">Section 4.17<!--tex4ht:ref: subsec:list-block --></a>.
The assignment <span 
class="ec-lmtt-10">st-&#x003E;x</span> stores the topmost element of the stack <span 
class="ec-lmtt-10">st</span> in <span 
class="ec-lmtt-10">x</span> as discussed in
<a 
href="#x1-150004.4">Section 4.4<!--tex4ht:ref: subsec:list-in-scalar --></a>.
  <!--l. 750--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">action</span><span 
class="ec-lmtt-10">&#8217;push+[]st[]+@+&#x003E;x:</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;(*</span><span 
class="ec-lmtt-10">&#x00A0;x-&#x003E;st</span><span 
class="ec-lmtt-10">&#x00A0;*)</span><span 
class="ec-lmtt-10">&#x00A0;st,(shift</span><span 
class="ec-lmtt-10">&#x00A0;affix</span><span 
class="ec-lmtt-10">&#x00A0;block+@,:push;+).</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">action</span><span 
class="ec-lmtt-10">&#8217;pop+[]st[]+@+x&#x003E;:</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;st-&#x003E;x,unstack+st,(shift</span><span 
class="ec-lmtt-10">&#x00A0;affix</span><span 
class="ec-lmtt-10">&#x00A0;block+@,:pop;+).</span>
</div>
<!--l. 757--><p class="indent" >   Passing all affixes in the variable block can be used, e.g., to suppress low-level
warning messages with a code similar to the one below:
  <!--l. 759--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">action</span><span 
class="ec-lmtt-10">&#8217;warning+&#x003E;level+T[]+&#x003E;ptr+@+&#x003E;msg:</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;level&#x003C;min</span><span 
class="ec-lmtt-10">&#x00A0;level;</span>
                                                                  

                                                                  
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;format</span><span 
class="ec-lmtt-10">&#x00A0;print+T+ptr+@.</span>
</div>
<!--l. 767--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.10   </span> <a 
 id="x1-210004.10"></a>Classification</h4>
<!--l. 769--><p class="noindent" >A classification chooses exactly one of the possible alternatives based on the value of
a <span 
class="cmss-10">source</span> included in the <span 
class="cmss-10">classifier box</span>. An example is
  <!--l. 771--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">(=</span><span 
class="ec-lmtt-10">&#x00A0;last*L[n]</span><span 
class="ec-lmtt-10">&#x00A0;=</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;[0;1],</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;action</span><span 
class="ec-lmtt-10">&#x00A0;1;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;either</span><span 
class="ec-lmtt-10">&#x00A0;zero</span><span 
class="ec-lmtt-10">&#x00A0;or</span><span 
class="ec-lmtt-10">&#x00A0;one</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;[-10:10],action</span><span 
class="ec-lmtt-10">&#x00A0;2;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;range</span><span 
class="ec-lmtt-10">&#x00A0;from</span><span 
class="ec-lmtt-10">&#x00A0;-10</span><span 
class="ec-lmtt-10">&#x00A0;to</span><span 
class="ec-lmtt-10">&#x00A0;10</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;[L;1000],action</span><span 
class="ec-lmtt-10">&#x00A0;3;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;either</span><span 
class="ec-lmtt-10">&#x00A0;in</span><span 
class="ec-lmtt-10">&#x00A0;L</span><span 
class="ec-lmtt-10">&#x00A0;or</span><span 
class="ec-lmtt-10">&#x00A0;equal</span><span 
class="ec-lmtt-10">&#x00A0;to</span><span 
class="ec-lmtt-10">&#x00A0;1000</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;[:],</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;action</span><span 
class="ec-lmtt-10">&#x00A0;4)</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;everything</span><span 
class="ec-lmtt-10">&#x00A0;else</span>
</div>
<!--l. 778--><p class="noindent" >The <span 
class="cmss-10">area</span> written between square brackets determines whether the alternative
following it is chosen or not. An <span 
class="cmss-10">area</span> may contain integer denotations (decimal or
hexadecimal), constant tags (including constant pointers) and global (not formal)
lists; no expressions are allowed. A global list stands for its complete virtual address
range. All values within the area are determined during compilation. It is an error if
some of the alternatives cannot be reached (this would happen if the first two <span 
class="cmss-10">area</span>s in
the above example were swapped); and the compiler gives a warning if it could
happen that none of the alternatives are chosen. When running the program and
none of the alternatives succeeds then the program aborts with an error message.
The last &#8220;otherwise&#8221; case can omit the <span 
class="cmss-10">area</span> <span 
class="ec-lmtt-10">[:]</span> matching every possible
value.
<!--l. 794--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.11   </span> <a 
 id="x1-220004.11"></a>Expressions</h4>
<!--l. 796--><p class="noindent" >In <span 
class="cmss10">ALEPH </span> all <span 
class="cmss-10">expression</span>s are evaluated during compilation. Originally <span 
class="cmss-10">expression</span>s
could be used at several places, this implementation restricts them to <span 
class="cmss-10">constant</span> and
<span 
class="cmss-10">variable declaration</span>s only.
<!--l. 800--><p class="indent" >   An <span 
class="cmss-10">expression</span> evaluates to a constant value. It may contain constant tags
declared later (or even in another module), but cannot depend on itself.
Thus
  <!--l. 803--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">constant</span><span 
class="ec-lmtt-10">&#8217;a=b+2.</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">constant</span><span 
class="ec-lmtt-10">&#8217;b=/a/.</span></div>
<!--l. 807--><p class="noindent" >is accepted where <span 
class="ec-lmtt-10">/a/</span> is the value of character &#8216;<span 
class="ec-lmtt-10">a</span>&#8217; in the used coding, while
  <!--l. 810--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">constant</span><span 
class="ec-lmtt-10">&#8217;p=q+1,q=1-p.</span>
</div>
<!--l. 813--><p class="noindent" >gives an error message as the value of <span 
class="ec-lmtt-10">p</span> depends on itself. In addition to the usual
arithmetic operators <span 
class="ec-lmtt-10">+</span>, <span 
class="ec-lmtt-10">-</span>, <span 
class="ec-lmtt-10">*</span>, and <span 
class="ec-lmtt-10">/</span> the following Boolean operators can also be
used:
                                                                  

                                                                  
   <ul class="itemize0">
   <li class="itemize">
   <!--l. 819--><p class="noindent" ><span 
class="ec-lmtt-10 smallsize">~x</span> for the (binary) complement of <span 
class="ec-lmtt-10">x</span>,
   </li>
   <li class="itemize">
   <!--l. 820--><p class="noindent" ><span 
class="ec-lmtt-10 smallsize">x&amp;y,x|y </span> for the bitwise <span 
class="cmss-10">and</span> and bitwise <span 
class="cmss-10">or</span>,
   </li>
   <li class="itemize">
   <!--l. 822--><p class="noindent" ><span 
class="ec-lmtt-10 smallsize">x^y</span> for the bitwise xor (modulo 2 addition) operator.</li></ul>
<!--l. 824--><p class="noindent" >Boolean operators have lower priorities than the arithmetic ones.
<!--l. 826--><p class="indent" >   In an <span 
class="cmss-10">expression</span> integer denotations (both decimal and hexadecimal), character
denotations (a character between <span 
class="ec-lmtt-10">/</span> symbols), constant tags, pointer constants
(defined in fillings), virtual bounds, and block size (calibre) can be used. List size
estimates and repeat numbers (see <a 
href="#x1-290004.18">Section 4.18<!--tex4ht:ref: subsec:filling --></a>) are evaluated before the
virtual bounds are determined, thus these values cannot depend on virtual
bounds.
<!--l. 835--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.12   </span> <a 
 id="x1-230004.12"></a>Root rule</h4>
<!--l. 837--><p class="noindent" >The only executable command of an <span 
class="cmss10">ALEPH </span>program is its <span 
class="cmss-10">root</span>. It can have local
affixes and a <span 
class="cmss-10">rule body</span>. The <span 
class="cmss-10">root</span> is executed only once, and there is no need to
designate a separate rule for this purpose. Example:
  <!--l. 841--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">root</span><span 
class="ec-lmtt-10">&#8217;(rep:put</span><span 
class="ec-lmtt-10">&#x00A0;line+STDOUT+V+newline,</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;(next</span><span 
class="ec-lmtt-10">&#x00A0;perm+&#x003C;&#x003C;V+V,:rep;+)).</span>
</div>
<!--l. 845--><p class="noindent" >Roots of modules are executed before the root of the main program (see
<a 
href="#x1-390005">Section 5<!--tex4ht:ref: section:module --></a>), modular roots can perform all necessary initialization for the
module. Modules which do not require initialization should use an empty
<span 
class="cmss-10">root</span>:
  <!--l. 850--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">root</span><span 
class="ec-lmtt-10">&#8217;+.</span></div>
<!--l. 853--><p class="noindent" >To control the order of module initializations, a module root can call
  <!--l. 856--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">wait</span><span 
class="ec-lmtt-10">&#x00A0;for+"xxx"</span></div>
<!--l. 859--><p class="noindent" >to force the root of the indicated module <span 
class="ec-lmtt-10">xxx</span> to terminate before the call returns.
The <span 
class="ec-lmtt-10">wait for</span> rule aborts with an error message if two modules would wait for each
other producing a deadlock. The <span 
class="ec-lmtt-10">wait for</span> rule requires the name of the module (see
<a 
href="#x1-390005">Section 5<!--tex4ht:ref: section:module --></a>) specified as a string, and not the name of the file containing the module
text. If no module was linked with the given name, the <span 
class="ec-lmtt-10">wait for</span> rule returns
immediately. If there are several modules with the same name, all those module roots
are called.
                                                                  

                                                                  
<!--l. 871--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.13   </span> <a 
 id="x1-240004.13"></a>Actual and virtual limits</h4>
<!--l. 873--><p class="noindent" >The complete <span 
class="cmti-10">virtual memory space</span>&#8212;the allowed range of indices&#8212;is distributed
among the tables and stacks with almost no control of the programmer. These
virtual bounds are fixed and hard-coded into the compiled program. Pointers
refer to a list element using its virtual address. The virtual address space of
different lists are disjoint, thus a pointer uniquely identifies the list it points
into.
<!--l. 880--><p class="indent" >   A <span 
class="cmss-10">stack</span> typically does not occupy its virtual space completely. The existing
locations for this stack form a presumably much smaller continuous part of its virtual
space, the <span 
class="cmti-10">actual memory space</span>. Stacks can be extended to the right (upwards) until
the end of their virtual memory parts, or until there is enough physical memory
available. They can shrink from the right when their actual upper limits are
lowered; the released virtual memory can be reclaimed again. Stacks can also
shrink from the left (behaving like queues), but in this case the released
virtual space is lost (for the rest of the program run) and cannot be reclaimed
again.
<!--l. 890--><p class="indent" >   The <span 
class="cmti-10">actual memory space </span>of a <span 
class="cmss-10">stack</span> changes when the stack is extended or
shrunken For a list <span 
class="ec-lmtt-10">L</span> the constructs <span 
class="ec-lmtt-10">&#x003C;&#x003C;L</span> and <span 
class="ec-lmtt-10">&#x003E;&#x003E;L</span> return the actual lower and actual
upper bound of <span 
class="ec-lmtt-10">L</span>, respectively, within the virtual memory space. To obtain the fixed
<span 
class="cmti-10">virtual </span>limits of the same list, use <span 
class="ec-lmtt-10">&#x003C;L</span> and <span 
class="ec-lmtt-10">&#x003E;L</span> (with a single <span 
class="cmss-10">left symbol</span> and <span 
class="cmss-10">right</span>
<span 
class="cmss-10">symbol</span>). In expressions only the fixed virtual limits can be used as only these are
available during compilation. For <span 
class="cmss-10">table</span>s the actual and virtual limits are always
equal. In case of <span 
class="cmss-10">stack</span>s actual limits are always within the virtual limits. Fixed stacks
(i.e. stacks with an exact size estimate or no size estimate) have equal actual and
virtual limits.
<!--l. 903--><p class="indent" >   This implementation restricts the virtual address space to positive values. The
null pointer has value <span 
class="ec-lmtt-10">0</span>, and guaranteed to be distinct from any valid virtual address.
When transmitting data using data files (see <a 
href="#x1-310004.20">Section 4.20<!--tex4ht:ref: subsec:datafiles --></a>) the null pointer is always
accepted and transmitted correctly.
<!--l. 909--><p class="indent" >   When a <span 
class="cmss-10">stack</span> shrinks, either at the top or at the bottom, the actual allocated
actual memory is not touched. Only the complete allocated memory can
be released (freed) which also automatically empties the stack, see
<a 
href="#x1-470006.1">Section 6.1<!--tex4ht:ref: subsec:stdlib-stack --></a>.
<!--l. 916--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.14   </span> <a 
 id="x1-250004.14"></a>List declarers</h4>
<!--l. 918--><p class="noindent" >To distinguish <span 
class="cmss-10">table declaration</span>s from prototypes and fillings (see <a 
href="#x1-330004.22">Section 4.22<!--tex4ht:ref: subsec:prototype --></a> and
<a 
href="#x1-290004.18">Section 4.18<!--tex4ht:ref: subsec:filling --></a>, respectively), the syntax of <span 
class="cmss-10">table</span> and <span 
class="cmss-10">stack declaration</span>s is changed to resemble
that of the <span 
class="cmss-10">formal affix</span>es. In a <span 
class="cmss-10">table declaration</span> the declared <span 
class="cmss-10">tag</span> is followed by <span 
class="ec-lmtt-10">[]</span>. In a
<span 
class="cmss-10">stack declaration</span>, in addition, the optional <span 
class="cmss-10">field list pack</span> is preceded by the <span 
class="cmss-10">size</span>
<span 
class="cmss-10">estimate</span> enclosed between <span 
class="ec-lmtt-10">[</span> and <span 
class="ec-lmtt-10">]</span>, as in
  <!--l. 925--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">table</span><span 
class="ec-lmtt-10">&#8217;(length,width)TBL[],pi[]=(3,1,4,1,5,9,2,6).</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">stack</span><span 
class="ec-lmtt-10">&#8217;[15]BUFFER[].</span>
                                                                  

                                                                  
</div>
<!--l. 932--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.15   </span> <a 
 id="x1-260004.15"></a>Size estimate</h4>
<!--l. 934--><p class="noindent" >The <span 
class="cmss-10">size estimate</span> in a <span 
class="cmss-10">stack declaration</span> specifies how much virtual address space this
stack requires. The estimate can be <span 
class="cmti-10">fixed</span>, <span 
class="cmti-10">relative</span>, or <span 
class="cmti-10">empty</span>. In the first two cases the
limit must be either an integer denotation or a constant tag; no expressions are
allowed.
   <ul class="itemize0">
   <li class="itemize">
   <!--l. 940--><p class="noindent" >Fixed size is written between <span 
class="ec-lmtt-10">=</span> symbols and the value cannot be larger than
   1,000,000 (and, of course, must be positive). The compiler reserves at least
   that much virtual space for the stack. (The final virtual space can be larger
   if the stack has fillings which total to a larger amount.)
   </li>
   <li class="itemize">
   <!--l. 946--><p class="noindent" >A  relative  estimate  should  yield  an  integer  between  1  and  100.  After
   reserving virtual addresses for <span 
class="cmss-10">table</span>s and fixed size <span 
class="cmss-10">stack</span>s, the remaining
   virtual space is distributed proportionally to the requested relative amount.
   </li>
   <li class="itemize">
   <!--l. 951--><p class="noindent" >If the size estimate is left empty, the stack size (both virtual and actual) is
   determined by the amount of its fillings (see <a 
href="#x1-290004.18">Section 4.18<!--tex4ht:ref: subsec:filling --></a>). Such a stack can
   still shrink, but cannot expand beyond its virtual upper limit.</li></ul>
<!--l. 959--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.16   </span> <a 
 id="x1-270004.16"></a>List selectors</h4>
<!--l. 961--><p class="noindent" >Every <span 
class="cmss-10">table</span> and <span 
class="cmss-10">stack</span> has an associated <span 
class="cmti-10">block structure </span>which determines the block
size, called <span 
class="cmss-10">calibre</span>, of that list, together with the set of its <span 
class="cmss-10">selectors</span>. When no selectors
are specified, the block size is 1 and the selector of that element is the name of the
list &#8211; this is called the <span 
class="cmti-10">standard selector</span>. The standard selector is used implicitly
when the list is indexed without specifying any selector. If the list definition has a
selector list, then this list contains the block selectors in a left to right order. The
<span 
class="cmss-10">formal stack</span> definition
  <!--l. 970--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">[](tag,left,right)tags[]</span>
</div>
<!--l. 973--><p class="noindent" >specifies that the block structure of the formal affix <span 
class="ec-lmtt-10">tags</span> has three elements with
selectors <span 
class="ec-lmtt-10">tag</span>, <span 
class="ec-lmtt-10">left</span>, and <span 
class="ec-lmtt-10">right</span> in this order. Also, the list <span 
class="ec-lmtt-10">tags</span> has no standard
selector, namely a selector with the name of the list. The <span 
class="cmss-10">selector list</span>, if present,
cannot be empty, meaning it must contain at least one selector.
<!--l. 980--><p class="indent" >   The same block element can be identified by different selectors. These additional
selector names are specified after the initial selector separated by an equal sign as
happens in the <span 
class="cmss-10">stack declaration</span>
  <!--l. 983--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">stack</span><span 
class="ec-lmtt-10">&#8217;[1](s1,s2=t1,s3=t2)stack[].</span>
</div>
<!--l. 986--><p class="noindent" >To emphasize which selectors are used together, multiple <span 
class="cmss-10">selector pack</span>s are accepted.
Each pack must have the same number of selectors, the <span 
class="cmss-10">dummy symbol</span> <span 
class="ec-lmtt-10">#</span> can be
used as a placeholder. Thus the previous <span 
class="cmss-10">declaration</span> can also be written
as
  <!--l. 991--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">stack</span><span 
class="ec-lmtt-10">&#8217;[1](s1,s2,s3)(#,t1,t2)stack[].</span>
</div>
<!--l. 994--><p class="noindent" >If a list is defined with selectors, then a matching prototype must also contain a
selector list pack, while a filling may omit it, see <a 
href="#x1-290004.18">Section 4.18<!--tex4ht:ref: subsec:filling --></a>. All selector packs must
define the same block size and the same standard selector, but could define
different selector names which accumulate: any of the specified selectors can be
used.
<!--l. 1003--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.17   </span> <a 
 id="x1-280004.17"></a>Matching formal and actual lists</h4>
<!--l. 1005--><p class="noindent" >The block sizes of the formal and the corresponding actual lists are compared as
follows.
   <ul class="itemize0">
   <li class="itemize">
   <!--l. 1008--><p class="noindent" >The formal list has no selectors.
   <!--l. 1010--><p class="noindent" >There is no restriction on the block size of the actual list. Observe, however, that
   in this case the standard selector of the formal and the actual list might be
   different. Suppose we have the rule declaration
     <!--l. 1013--><p class="noindent" ><div class="obeylines-v">
     <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">action</span><span 
class="ec-lmtt-10">&#8217;set</span><span 
class="ec-lmtt-10">&#x00A0;zero+[]st[]:</span><span 
class="ec-lmtt-10">&#x00A0;0-&#x003E;st.</span></div>
   <!--l. 1016--><p class="noindent" >which sets the topmost element of the <span 
class="cmss-10">stack</span> <span 
class="ec-lmtt-10">st</span> to zero. With the declaration
   <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">stack</span><span 
class="ec-lmtt-10">&#8217;[1](L,b)L[]</span> the assignment <span 
class="ec-lmtt-10">0-&#x003E;L</span> clears the second to last element of <span 
class="ec-lmtt-10">L</span>,
   while <span 
class="ec-lmtt-10">set zero+L</span> clears its last (topmost) element.
   </li>
   <li class="itemize">
   <!--l. 1022--><p class="noindent" >The formal list has a selector pack.
   <!--l. 1025--><p class="noindent" >The actual list must have the same block size and the same standard
   selector, while selector names might be different. If this restriction is
   violated, a warning is issued; if the called rule is a macro, then this is an
   error.</li></ul>
<!--l. 1033--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.18   </span> <a 
 id="x1-290004.18"></a>Filling</h4>
<!--l. 1035--><p class="noindent" >In addition to specifying the size estimate and the optional selectors, a <span 
class="cmss-10">table</span> or <span 
class="cmss-10">stack</span>
<span 
class="cmss-10">declaration</span> may also define the initial content of the list. This content can also be
specified separately using <span 
class="cmti-10">fillings</span>. Fillings can spread across the program (actually,
can spread across several modules). A list description (without size estimate
and the closing <span 
class="ec-lmtt-10">[]</span> pair),
followed by <span 
class="ec-lmtt-10">=</span> and a filling can appear multiple times across the program. Fillings
specified this way are accumulated. Their final order is unspecified, but within a
single filling the order of the added elements is kept intact. The list description in the
filling may contain a selector pack only if the corresponding list is defined with
selectors. If there is a selector pack, both the block size and the standard selector
must be the same as in the definition; the selector names, however, can be
different.
<!--l. 1048--><p class="indent" >   The <span 
class="cmss-10">filling</span> itself is enclosed in parentheses, and is a sequence of integer
denotations, constant tags (including constant pointers), strings, and blocks; no
expressions are allowed. Each item, except for strings, can be followed by the <span 
class="cmss-10">repeat</span>
<span 
class="cmss-10">symbol</span> <span 
class="ec-lmtt-10">*</span> and either an integer or a constant tag specifying how many times this item
should be repeated. Then the optional <span 
class="cmss-10">pointer initialization</span> sequence follows: a colon
and a tag which is defined to have the value of the virtual address of the
lastly defined list item. The pointer initialization can be repeated. In the
example
  <!--l. 1058--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">constant</span><span 
class="ec-lmtt-10">&#8217;tsize=10.</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">stack</span><span 
class="ec-lmtt-10">&#8217;T=(0*tsize:tzero:tz1,1*tsize,"string":tstring).</span>
</div>
<!--l. 1063--><p class="noindent" >the <span 
class="cmss-10">filling</span> adds ten zeroes, ten ones, followed by the internal representation of
the string <span 
class="ec-lmtt-10">"string"</span> to <span 
class="ec-lmtt-10">T</span>. It also declares both <span 
class="ec-lmtt-10">tzero</span> and <span 
class="ec-lmtt-10">tz1</span> to be the
(virtual) address of the lastly added <span 
class="ec-lmtt-10">0</span>, and <span 
class="ec-lmtt-10">tstring</span> to be the (virtual)
address of the last element of the representation of <span 
class="ec-lmtt-10">"string"</span> (which, if no
further filling is added to <span 
class="ec-lmtt-10">T</span>, is the same as <span 
class="ec-lmtt-10">&#x003E;&#x003E;T</span> at the start of the program
run).
<!--l. 1071--><p class="indent" >   In the <span 
class="cmss-10">filling</span> a <span 
class="cmss-10">compound block</span> defines the content of a list block. The <span 
class="cmss-10">compound</span>
<span 
class="cmss-10">block</span> must have exactly as many elements as the block size (<span 
class="cmss-10">calibre</span>) of the list;
violating this requirement results in a warning. A block element must be either an
integer denotation or a constant tag (possibly a pointer constant), but not a string.
In the block this value is followed by an <span 
class="cmss-10">arrow symbol</span> <span 
class="ec-lmtt-10">-&#x003E;</span> and the selector where it will
be stored. The filling in the example
  <!--l. 1079--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">stack</span><span 
class="ec-lmtt-10">&#8217;[1](ch,p)optor[]=</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;(</span><span 
class="ec-lmtt-10">&#x00A0;(/+/-&#x003E;ch,3-&#x003E;p),(3-&#x003E;p,/-/-&#x003E;ch),(5-&#x003E;p,/^/-&#x003E;ch)</span><span 
class="ec-lmtt-10">&#x00A0;).</span>
</div>
<!--l. 1083--><p class="noindent" >adds three blocks of size two each to the stack <span 
class="ec-lmtt-10">optor</span>. One of the selectors can be
replaced by the <span 
class="cmss-10">repeat symbol</span> <span 
class="ec-lmtt-10">*</span> to mean that the value is copied to all selectors not
mentioned explicitly in this block.
<!--l. 1088--><p class="indent" >   The original block syntax is also accepted: the <span 
class="cmss-10">compound block</span> of the <span 
class="cmss-10">filling</span>
contains, in left to right order, the values (an integer denotation or a constant tag)
which should be added to the list. One of the values can be followed by the <span 
class="cmss-10">repeat</span>
<span 
class="cmss-10">symbol</span> <span 
class="ec-lmtt-10">*</span> with the meaning that this element will be repeated as many times as
necessary to fill the whole list block. Example:
  <!--l. 1095--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">stack</span><span 
class="ec-lmtt-10">&#8217;(a,b,c,d,e,f,g,h)big</span><span 
class="ec-lmtt-10">&#x00A0;block=(</span><span 
class="ec-lmtt-10">&#x00A0;(1,0*,1)*100</span><span 
class="ec-lmtt-10">&#x00A0;).</span>
</div>
<!--l. 1099--><p class="noindent" >adds 100 blocks to the stack <span 
class="ec-lmtt-10">big block</span>, each consisting of a <span 
class="ec-lmtt-10">1</span>, six <span 
class="ec-lmtt-10">0</span>, and another <span 
class="ec-lmtt-10">1</span>.
The block can also be written as <span 
class="ec-lmtt-10">(1,0*6,1)</span>.
                                                                  

                                                                  
<!--l. 1106--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.19   </span> <a 
 id="x1-300004.19"></a>Exit rule type</h4>
<!--l. 1108--><p class="noindent" >Executing the <span 
class="cmss-10">terminator</span> <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">exit</span><span 
class="ec-lmtt-10">&#8217;16</span> causes the program to terminate with exit value
16. The <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">exit</span><span 
class="ec-lmtt-10">&#8217;</span> statement is replaced internally by a call of the external rule <span 
class="ec-lmtt-10">exit</span>, in
this case it becomes <span 
class="ec-lmtt-10">exit+16</span>. Consequently <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">exit</span><span 
class="ec-lmtt-10">&#8217;</span> must be followed by an <span 
class="cmss-10">actual</span>
<span 
class="cmss-10">affix</span>, and not by an <span 
class="cmss-10">expression</span>.
<!--l. 1114--><p class="indent" >   In general, next to the four rule types <span 
class="cmti-10">predicate</span>, <span 
class="cmti-10">question</span>, <span 
class="cmti-10">action</span>, and <span 
class="cmti-10">function</span>
specified by the <span 
class="cmss10">ALEPH </span>Manual <span class="cite">[<a 
href="#XA-manual">2</a>]</span>, a fifth one is added: <span 
class="cmti-10">exit</span>. A rule is of type <span 
class="cmti-10">exit </span>if
it never returns. The external rule <span 
class="ec-lmtt-10">exit</span> is of type <span 
class="cmti-10">exit</span>, as well as the rule <span 
class="ec-lmtt-10">error</span>
defined below which prints some additional message before terminating the
program:
  <!--l. 1121--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">exit</span><span 
class="ec-lmtt-10">&#8217;error+&#x003E;x:</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;x&#x003E;=0,exit+0;</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;fprintf+STDERR+"Exit</span><span 
class="ec-lmtt-10">&#x00A0;level</span><span 
class="ec-lmtt-10">&#x00A0;%d%n"+x,exit+1.</span>
</div>
<!--l. 1127--><p class="noindent" >An <span 
class="cmss-10">exit</span> rule cannot have out or inout affixes as there is no way to use the returned
value. When an <span 
class="cmss-10">exit</span> rule is defined, this condition is checked. When such a rule is
used, it is treated as a <span 
class="cmss-10">terminator</span> which can neither succeed nor fail. An
<span 
class="cmss-10">exit</span> rule has an implicit side effect (aborts the program), thus it cannot be
used in functions and questions. Violating this restriction gives a warning
message.
<!--l. 1137--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.20   </span> <a 
 id="x1-310004.20"></a>File area, file string</h4>
<!--l. 1139--><p class="noindent" ><span 
class="cmss10">ALEPH </span>distinguishes two file types: character and data. Character files accept and
write characters; in this version the used character set consists of Unicode
characters. During character transput there is an automatic conversion from
and to UTF-8 encoding. The <span 
class="cmss10">ALEPH </span>program receives and sends Unicode
characters.
<!--l. 1145--><p class="indent" >   Data files communicate between different <span 
class="cmss10">ALEPH </span>programs. Data files are
written and read one item a time; an item is either an integer (word) or a
pointer. The data file does not store pointer values directly, rather a pair
consisting of an indication of the list the pointer points to and the relative
address of the pointed item in that list. From this information the pointer can
be restored independently of the virtual address distribution. A datafile
declaration specifies all lists whose pointers can be transmitted. By storing the
virtual limits of these lists in the datafile first, each additional item requires a
single extra bit only specifying whether the item is a pointer or not. When
opening an <span 
class="cmss10">ALEPH </span>data file for reading, stored limits are paired with the
lists in the file area so that the appropriate pointer transformation can be
made.
<!--l. 1158--><p class="indent" >   According to the <span 
class="cmss10">ALEPH </span>manual, a <span 
class="cmss-10">file declaration</span> can have an <span 
class="cmss-10">area</span> which
restricts what values are allowed to send to or receive from that file. This
implementation does not allow <span 
class="cmss-10">area</span>s for character files, and the <span 
class="cmss-10">area</span> of a datafile
may contain only lists to which pointers are sent to or received from. The
order of the lists is significant: when reading from a data file the first list
in the area is matched against the first list when the file was written, and so
on.
<!--l. 1166--><p class="indent" >   The <span 
class="cmss-10">string denotation</span> and the direction (the <span 
class="ec-lmtt-10">&#x003E;</span> symbol before and after the string)
in the file declaration is used as follows. Files can be opened by the external
rule
  <!--l. 1169--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">a</span><span 
class="ec-lmtt-10">&#8217;open</span><span 
class="ec-lmtt-10">&#x00A0;file + ""file</span><span 
class="ec-lmtt-10">&#x00A0;+</span><span 
class="ec-lmtt-10">&#x00A0;&#x003E;mode</span><span 
class="ec-lmtt-10">&#x00A0;+</span><span 
class="ec-lmtt-10">&#x00A0;t[] + &#x003E;ptr.</span>
</div>
<!--l. 1172--><p class="noindent" >where <span 
class="ec-lmtt-10">mode</span> is <span 
class="ec-lmtt-10">/r/</span> for reading, <span 
class="ec-lmtt-10">/w/</span> for writing, and <span 
class="ec-lmtt-10">/a/</span> for appending (appending is accepted
for character files only); the last two arguments specify the string containing the file
name (with possible path information) to be opened.
<!--l. 1178--><p class="indent" >   Without explicitly opening the file the first file operation tries to open it. The
<span 
class="cmss-10">string denotation</span> in the file declaration
  <!--l. 1169--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">charfile</span><span 
class="ec-lmtt-10">&#8217;STREAM = &#x003E;"/tmp/out.txt".</span>
</div>
<p class="noindent" >gives the file name (with possible path
information) to be opened, while the <span 
class="cmss-10">direction</span> restricts the access: the file opens automatically
for reading only if there is a <span 
class="ec-lmtt-10">&#x003E;</span> <span 
class="cmti-10">after </span>the string, and for writing if there is
a <span 
class="ec-lmtt-10">&#x003E;</span> <span 
class="cmti-10">before </span>the path string. Note that this reverses the specification in the Manual, but
it is more intuitive: the data may come from (leave) the specified file, or it
can go into that file.
A file cannot be opened for reading and writing
simultaneously.
<!--l. 1186--><p class="indent" >   For a character file the following special filenames identify the standard streams:
<span 
class="ec-lmtt-10">"&#x003C;&#x003C;stdin&#x003E;&#x003E;"</span>, <span 
class="ec-lmtt-10">"&#x003C;&#x003C;stdout&#x003E;&#x003E;"</span>, and <span 
class="ec-lmtt-10">"&#x003C;&#x003C;stderr&#x003E;&#x003E;"</span>. The character files <span 
class="ec-lmtt-10">STDIN</span> and
<span 
class="ec-lmtt-10">STDOUT</span> declared in the standard <span 
class="cmss10">ALEPH </span>library correspond to the first two of these streams.
<!--l. 1194--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.21   </span> <a 
 id="x1-320004.21"></a>Static stack and static variable</h4>
<!--l. 1196--><p class="noindent" ><span 
class="cmss-10">Variable</span>s and <span 
class="cmss-10">stack</span>s can be declared to be <span 
class="cmss-10">static</span> by adding the <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">static</span><span 
class="ec-lmtt-10">&#8217;</span> keyword
before their declaration. Examples:
  <!--l. 1198--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">static</span><span 
class="ec-lmtt-10">&#8217;&#8217;</span><span 
class="ec-lmtk-10">variable</span><span 
class="ec-lmtt-10">&#8217;resources=0.</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">static</span><span 
class="ec-lmtt-10">&#8217;&#8217;</span><span 
class="ec-lmtk-10">stack</span><span 
class="ec-lmtt-10">&#8217;[=20=]values[].</span></div>
<!--l. 1202--><p class="noindent" >Static variables and stacks behave identically to variables and stacks in the module
they are declared. In other modules, however, they are &#8220;read only&#8221;, which means that
other modules cannot change the value of a <span 
class="cmss-10">static variable</span>, and cannot modify,
extend, shrink, or manipulate otherwise a <span 
class="cmss-10">static stack</span>.
<!--l. 1211--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.22   </span> <a 
 id="x1-330004.22"></a>Prototype</h4>
<!--l. 1213--><p class="noindent" >A <span 
class="cmss-10">prototype</span> informs the compiler about a type of an identifier. A <span 
class="cmss-10">table</span> or <span 
class="cmss-10">stack</span>
<span 
class="cmss-10">prototype</span> has no size estimate, square brackets and filling; a <span 
class="cmss-10">constant</span>, <span 
class="cmss-10">variable</span>, <span 
class="cmss-10">file prototype</span> has no
data (or initial value); a <span 
class="cmss-10">rule prototype</span> has no <span 
class="cmss-10">actual rule</span>. Prototypes are similar to
external declarations without the <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">external</span><span 
class="ec-lmtt-10">&#8217;</span> keyword and the string denotation.
Examples:
  <!--l. 1219--><p class="noindent" ><div class="obeylines-v">
 <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">charfile</span><span 
class="ec-lmtt-10">&#8217;STDIN.</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">action</span><span 
class="ec-lmtt-10">&#8217;print</span><span 
class="ec-lmtt-10">&#x00A0;tag+&#x003E;tag,read</span><span 
class="ec-lmtt-10">&#x00A0;tag+tag&#x003E;.</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">constant</span><span 
class="ec-lmtt-10">&#8217;max</span><span 
class="ec-lmtt-10">&#x00A0;tag</span><span 
class="ec-lmtt-10">&#x00A0;pointer.</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">stack</span><span 
class="ec-lmtt-10">&#8217;(#,#)STACK.</span>
</div>
<!--l. 1225--><p class="noindent" >Prototypes are also used to inform the compiler about tags which are defined in other
modules, and about tags which this module exports. See <a 
href="#x1-390005">Section 5<!--tex4ht:ref: section:module --></a>
for more information.
<!--l. 1232--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.23   </span> <a 
 id="x1-340004.23"></a>Pragmats</h4>
<!--l. 1234--><p class="noindent" >Pragmats control different aspects of the compilation. Their semantics changed
significantly compared to the <span 
class="cmss10">ALEPH </span>Manual. This implementation recognizes the
following pragmats:
<!--l. 1241--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">tab width=8</span>          sets tab size for program text printing
<!--l. 1243--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">list=on/off</span>          switch program text printing
<!--l. 1245--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">right margin=120</span>     right margin for program text printing
<!--l. 1247--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">dictionary=on/off</span>    collect tag occurrences
<!--l. 1249--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">warning level=4</span>      set warning level between 0 and 9
<!--l. 1251--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">error="message"</span>      issue an error with the given message
<!--l. 1253--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">warning="message"</span>    issue a warning at level 9
<!--l. 1255--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">bounds=on/off</span>        compile with or without index checking
<!--l. 1257--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">count=on/off</span>         profiling: count how many times a rule is called
<!--l. 1259--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">trace=on/off</span>         trace rule calls
<!--l. 1261--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">macro=rule</span>           <span 
class="ec-lmtt-10">rule</span> should be treated as a macro.
<!--l. 1263--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">std library=off</span>      don&#8217;t process the standard <span 
class="cmss10">ALEPH </span>library
<!--l. 1265--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">define=tag</span>           mark <span 
class="ec-lmtt-10">tag</span> as defined for an <span 
class="ec-lmtt-10">ifdef</span> pragmat
<!--l. 1267--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">library mode=on/off</span>  switch library mode
<!--l. 1269--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">prototype=none</span>       specify how prototypes are handled (see
<a 
href="#x1-390005">Section 5<!--tex4ht:ref: section:module --></a>)
<!--l. 1272--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">title="title"</span>        specify program title
<!--l. 1274--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">module=tag</span>           specify module name and namespace
<!--l. 1276--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">include="file"</span>       add <span 
class="ec-lmtt-10">file</span> to the sources to be read
<!--l. 1278--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">require="file"</span>       require module definitions from <span 
class="ec-lmtt-10">file</span>
<!--l. 1280--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">library="file"</span>       add <span 
class="ec-lmtt-10">file</span> as a user library module
<!--l. 1282--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">front matter="code"</span>  insert <span 
class="ec-lmtt-10">code</span> to the front of the generated code
<!--l. 1285--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">back matter="code"</span>   insert <span 
class="ec-lmtt-10">code</span> to the end of the generated code
<!--l. 1289--><p class="noindent" >There are additional pragmats which cannot be manipulated in the program text.
The most notable one is <span 
class="ec-lmtt-10">compile</span>, which can be either <span 
class="ec-lmtt-10">on</span> or <span 
class="ec-lmtt-10">off</span>. Some
pragmat values can be interrogated by conditional pragmats, see  <a 
href="#x1-350004.24">Section 4.24<!--tex4ht:ref: conditional --></a>.
Command-line arguments starting with a double dash, such as <span 
class="ec-lmtt-10">--XX=YYYY</span> are parsed
as
  <!--l. 1297--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">pragmat</span><span 
class="ec-lmtt-10">&#8217;XX=YYYY.</span>
</div>
                                                                  

                                                                  
<!--l. 1300--><p class="noindent" >except that no conditional pragmats (<a 
href="#x1-350004.24">Section 4.24<!--tex4ht:ref: conditional --></a>) are accepted. There are other
command-line pragmat shorthands starting with a single dash:
<!--l. 1307--><p class="noindent" >  <span 
class="ec-lmtt-10 smallsize">-l</span>                   <span 
class="ec-lmtt-10 smallsize">list=on</span>
<!--l. 1309--><p class="noindent" >  <span 
class="ec-lmtt-10 smallsize">-d</span>                   <span 
class="ec-lmtt-10">dictionary=on</span>
<!--l. 1311--><p class="noindent" >  <span 
class="ec-lmtt-10 smallsize">-W</span>                   <span 
class="ec-lmtt-10">warning level=3</span>
<!--l. 1313--><p class="noindent" >  <span 
class="ec-lmtt-10 smallsize">-Wall</span>                <span 
class="ec-lmtt-10">warning level=0</span>
<!--l. 1315--><p class="noindent" >  <span 
class="ec-lmtt-10 smallsize">-D TAG</span>               <span 
class="ec-lmtt-10">define=TAG</span>
<!--l. 1317--><p class="noindent" >  <span 
class="ec-lmtt-10 smallsize">-m XXXX</span>              <span 
class="ec-lmtt-10">require="XXXX"</span>
<!--l. 1319--><p class="noindent" >  <span 
class="ec-lmtt-10 smallsize">-y XXXX</span>              <span 
class="ec-lmtt-10">library="XXXX"</span>
<!--l. 1321--><p class="noindent" >  <span 
class="ec-lmtt-10 smallsize">-o XXXX</span>              specify the output file
<!--l. 1323--><p class="noindent" >  <span 
class="ec-lmtt-10 smallsize">-I XXXX</span>              search directories
<!--l. 1325--><p class="noindent" >  <span 
class="ec-lmtt-10 smallsize">-L XXXX</span>              standard library directory
<!--l. 1328--><p class="noindent" >The <span 
class="ec-lmtt-10">-o</span> option specifies the name of the generated <span 
class="cmtt-10">.ice </span>file. If missing, the <span 
class="ec-lmtt-10">.ice</span> file
name is derived from the first source file, and generated in the current directory. The
<span 
class="ec-lmtt-10">-m</span> option marks that the following argument should be processed as if it were
required; the <span 
class="ec-lmtt-10">-y</span> option marks the following argument is to be processed
as a user library. The <span 
class="ec-lmtt-10">-I</span> option specifies the list of search directories for
included files, requested modules and user library modules. Finally the <span 
class="ec-lmtt-10">-L</span>
option specifies where the compiler should look for the standard library
files.
<!--l. 1339--><p class="indent" >   The default value of some of the pragmats is the following:
<!--l. 1341--><p class="noindent" >  <span 
class="ec-lmtt-10">tab width=8,</span>
<!--l. 1343--><p class="noindent" >  <span 
class="ec-lmtt-10">list=off,</span>
<!--l. 1345--><p class="noindent" >  <span 
class="ec-lmtt-10">dictionary=off,</span>
<!--l. 1347--><p class="noindent" >  <span 
class="ec-lmtt-10">library mode=off,</span>
<!--l. 1349--><p class="noindent" >  <span 
class="ec-lmtt-10">compile=on,</span>
<!--l. 1351--><p class="noindent" >  <span 
class="ec-lmtt-10">prototype=none.</span>
<!--l. 1354--><p class="indent" >   Pragmats <span 
class="ec-lmtt-10">front matter="code"</span> and <span 
class="ec-lmtt-10">back matter="code"</span> are accepted in
library mode only; the specified string is copied verbatim to the front (to the back,
respectively) of the generated code with the exception that the character sequence <span 
class="ec-lmtt-10">%n</span>
is replaced by a single newline. The pragmat <span 
class="ec-lmtt-10">std library=off</span> inhibits processing
of the standard library, while <span 
class="ec-lmtt-10">library="file"</span> designates that the source
in <span 
class="ec-lmtt-10">file</span> should be treated as a library module (which can request other
modules). The latter two pragmats are not accepted in required or library
files.
<!--l. 1363--><p class="indent" >   The <span 
class="ec-lmtt-10">prototype</span> pragmat has four possible values: <span 
class="ec-lmtt-10">import</span>, <span 
class="ec-lmtt-10">public</span>, <span 
class="ec-lmtt-10">none</span>, and
<span 
class="ec-lmtt-10">reverse</span>. In the first case a <span 
class="cmss-10">prototype</span> indicates that the tag has a declaration outside
this source (and then it cannot be defined, but can have other prototypes). In the
second case a tag appearing in a <span 
class="cmss-10">prototype</span> automatically gets the <span 
class="cmti-10">public </span>flag,
and must be defined in this source (in particular, it cannot be imported,
and this source must be a module). When <span 
class="ec-lmtt-10">prototype=none</span>, prototypes are
used for type checking only, and do not imply any specific behavior. Finally,
<span 
class="ec-lmtt-10">prototype=reverse</span> swaps the current prototype value between <span 
class="ec-lmtt-10">import</span> and <span 
class="ec-lmtt-10">public</span>,
while keeping <span 
class="ec-lmtt-10">none</span> unchanged. For a sample usage of <span 
class="ec-lmtt-10">reverse</span> see 
<a 
href="#x1-440005.5">Section 5.5<!--tex4ht:ref: subsec:redef --></a>.
                                                                  

                                                                  
<!--l. 1378--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.24   </span> <a 
 id="x1-350004.24"></a>Conditional pragmats</h4>
<!--l. 1380--><p class="noindent" >Conditional pragmats can be used to instruct the compiler to ignore certain parts of
the source file. They have the syntax
<!--l. 1385--><p class="indent" ><div class="obeylines-v">
<span class="ec-lmtt-10 medsize">&#8217;pragmat&#8217;if=TAG.</span>
<span class="ec-lmtt-10">&#8217;pragmat&#8217;else=TAG.  </span>
<span class="ec-lmtt-10">&#8217;pragmat&#8217;endif=TAG.</span></div>
<!--l. 1387--><p class="noindent" >or
<!--l. 1389--><p class="indent" ><div class="obeylines-v">
<span class="ec-lmtt-10 medsize">&#8217;pragmat&#8217;ifnot=TAG.</span>
<span class="ec-lmtt-10">&#8217;pragmat&#8217;else=TAG.  </span>
<span class="ec-lmtt-10">&#8217;pragmat&#8217;endif=TAG.</span></div>
<!--l. 1391--><p class="noindent" >or
<!--l. 1393--><p class="indent" ><div class="obeylines-v">
<span class="ec-lmtt-10 medsize">&#8217;pragmat&#8217;ifdef=TAG.</span>
<span class="ec-lmtt-10">&#8217;pragmat&#8217;else=TAG.  </span>
<span class="ec-lmtt-10">&#8217;pragmat&#8217;endif=TAG.</span></div>
<!--l. 1395--><p class="noindent" >or
<!--l. 1397--><p class="indent" ><div class="obeylines-v">
 <span class="ec-lmtt-10 medsize">&#8217;pragmat&#8217;ifndef=TAG.</span>
<span class="ec-lmtt-10">&#8217;pragmat&#8217;else=TAG.  </span>
<span class="ec-lmtt-10">&#8217;pragmat&#8217;endif=TAG.</span></div>
<!--l. 1400--><p class="noindent" >where <span 
class="ec-lmtt-10">TAG</span> in <span 
class="ec-lmtt-10">if</span> and <span 
class="ec-lmtt-10">ifnot</span> pragmats is one of <span 
class="ec-lmtt-10">compile</span>, <span 
class="ec-lmtt-10">list</span>, <span 
class="ec-lmtt-10">dictionary</span>, <span 
class="ec-lmtt-10">module</span>,
<span 
class="ec-lmtt-10">library mode</span>, etc. The program text between the <span 
class="ec-lmtt-10">if</span> and <span 
class="ec-lmtt-10">else</span> pragmats is
processed if <span 
class="ec-lmtt-10">TAG</span> is (or is not) in effect, otherwise it is skipped; and the opposite is
true for the text between <span 
class="ec-lmtt-10">else</span> and <span 
class="ec-lmtt-10">endif</span>. The <span 
class="ec-lmtt-10">else</span> part may be missing.
The <span 
class="ec-lmtt-10">TAG</span> in <span 
class="ec-lmtt-10">ifdef</span> and <span 
class="ec-lmtt-10">ifndef</span> pragmats can be any identifier (tag), and
the compiler checks if this identifier has (has not) been defined until this
point by a declaration, an import prototype, or by a <span 
class="ec-lmtt-10">define</span> pragmat. As an
example,
  <!--l. 1410--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">pragmat</span><span 
class="ec-lmtt-10">&#8217;if=module,include="private",else=module,</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;include="public",endif=module.</span>
</div>
<!--l. 1414--><p class="noindent" >adds the source file <span 
class="ec-lmtt-10">private</span> among those to be processed if a <span 
class="ec-lmtt-10">module</span> pragmat has
been processed previously, otherwise it adds the <span 
class="ec-lmtt-10">public</span> source file.
<!--l. 1419--><p class="indent" >   The <span 
class="ec-lmtt-10">if</span> &#x2026; <span 
class="ec-lmtt-10">endif</span> pragmats must be nested properly, and the skipped text must be
syntactically correct (as it is scanned to find the closing pragmat). The <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">end</span><span 
class="ec-lmtt-10">&#8217;</span> symbol
marking the end of the source file is never ignored: conditional pragmats do not
extend over the end of the current file.
<!--l. 1427--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.25   </span> <a 
 id="x1-360004.25"></a>Library mode</h4>
<!--l. 1429--><p class="noindent" >Pragmats <span 
class="ec-lmtt-10">library mode=on</span> and <span 
class="ec-lmtt-10">library mode=off</span> turn the library mode on and
off, respectively. This mode determines whether library extensions are allowed or
not.
<!--l. 1433--><p class="indent" >   In library mode the <span 
class="ec-lmtt-10">@</span> character is considered to be a letter. This way private tags
can be created which are not available outside the library. Dictionary listing ignores
tags starting with <span 
class="ec-lmtt-10">@</span>. External declarations are allowed in library mode only.
Pragmats <span 
class="ec-lmtt-10">front matter</span> and <span 
class="ec-lmtt-10">back matter</span> can only be issued in library
mode.
                                                                  

                                                                  
<!--l. 1443--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.26   </span> <a 
 id="x1-370004.26"></a>Macro substitution</h4>
<!--l. 1445--><p class="noindent" >To improve efficiency rule calls can be implemented by textual substitution. When
the rule name appears in a <span 
class="ec-lmtt-10">macro</span> pragmat (<a 
href="#x1-340004.23">Section 4.23<!--tex4ht:ref: subsec:pragmats --></a>), calls to this rule in the
current compilation unit are replaced by the rule body (and replacing formal affixes
by the actual ones). Such a substitution, however, can result in a syntactically
incorrect program text, or in a different semantics. The following examples
illustrate these cases and explain the additional restrictions a macro rule must
satisfy.
<!--l. 1456--><p class="indent" >
   <ol  class="enumerate0" >
<li 
  class="enumerate" id="x1-37002x1">
   <!--l. 1459--><p class="noindent" >In a macro, <span 
class="cmss-10">formal in</span> affixes cannot be assigned to. Indeed, suppose the rule <span 
class="ec-lmtt-10">macro</span>
   is defined as
    <!--l. 1461--><p class="noindent" ><div class="obeylines-v">
    <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">function</span><span 
class="ec-lmtt-10">&#8217;macro+&#x003E;x+y&#x003E;:</span><span 
class="ec-lmtt-10">&#x00A0;1-&#x003E;y-&#x003E;x,x-&#x003E;y.</span>
</div>
   <!--l. 1464--><p class="noindent" >After textual substitution the replacement can be syntactically wrong as
   in
   <!--l. 1467--><div class="obeylines-v" > <span 
class="ec-lmtt-10">macro+1+z</span>           <span 
class="cmsy-10">&#x21D2;</span><span 
class="ec-lmtt-10">(1-&#x003E;z-&#x003E;1,1-&#x003E;z)</span></div>
   </li>
<li 
  class="enumerate" id="x1-37004x2">
   <!--l. 1469--><p class="noindent" >There is a problem with the dummy affix <span 
class="ec-lmtt-10">#</span>. Using the same <span 
class="ec-lmtt-10">macro</span> rule as above,
   the following substitution has incorrect syntax:
   <!--l. 1472--><div class="obeylines-v" > <span 
class="ec-lmtt-10">macro+u+#</span>           <span 
class="cmsy-10">&#x21D2;</span><span 
class="ec-lmtt-10">(u-&#x003E;#-&#x003E;u, u-&#x003E;#)</span></div>
   </li>
<li 
  class="enumerate" id="x1-37006x3">
   <!--l. 1474--><p class="noindent" >While a macro rule can have a variable number of affixes, neither <span 
class="ec-lmtt-10">shift</span>
   <span 
class="ec-lmtt-10">affix block</span> nor <span 
class="ec-lmtt-10">get affix blockno</span> can be used in a macro text as
   illustrated by the following example. Rule <span 
class="ec-lmtt-10">is zero</span> below checks whether
   one of its arguments has value zero; rule <span 
class="ec-lmtt-10">math</span> computes the product
   of its arguments if none of them is zero, otherwise it computes their
   sum:
    <!--l. 1480--><p class="noindent" ><div class="obeylines-v">
    <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">question</span><span 
class="ec-lmtt-10">&#8217;is</span><span 
class="ec-lmtt-10">&#x00A0;zero+@+&#x003E;x:</span><span 
class="ec-lmtt-10">&#x00A0;x=0;</span><span 
class="ec-lmtt-10">&#x00A0;shift</span><span 
class="ec-lmtt-10">&#x00A0;affix</span><span 
class="ec-lmtt-10">&#x00A0;block+@,:is</span><span 
class="ec-lmtt-10">&#x00A0;zero.</span>
    <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">function</span><span 
class="ec-lmtt-10">&#8217;math+y&#x003E;+@+&#x003E;x:</span>
    <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;is</span><span 
class="ec-lmtt-10">&#x00A0;zero+@,0-&#x003E;y,(nxt:add+x+y+y,shift</span><span 
class="ec-lmtt-10">&#x00A0;affix</span><span 
class="ec-lmtt-10">&#x00A0;block+@,:nxt;+);</span>
    <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;1-&#x003E;y,(nxt:mult+x+y+y,shift</span><span 
class="ec-lmtt-10">&#x00A0;affix</span><span 
class="ec-lmtt-10">&#x00A0;block+@,:nxt;+).</span>
</div>
   <!--l. 1487--><p class="noindent" >If <span 
class="ec-lmtt-10">is zero</span> were substituted verbatim in rule <span 
class="ec-lmtt-10">math</span>, it would shift out all affixes
   and then the computation in <span 
class="ec-lmtt-10">math</span> would not be carried over. Similarly, suppose
   the rule <span 
class="ec-lmtt-10">macro</span> is defined as
    <!--l. 1491--><p class="noindent" ><div class="obeylines-v">
   <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">function</span><span 
class="ec-lmtt-10">&#8217;macro+a&#x003E;+@+&#x003E;q:</span><span 
class="ec-lmtt-10">&#x00A0;q-&#x003E;b,</span><span 
class="ec-lmtt-10">&#x00A0;get</span><span 
class="ec-lmtt-10">&#x00A0;affix</span><span 
class="ec-lmtt-10">&#x00A0;blocno+a+@.</span>
</div>
   <!--l. 1494--><p class="noindent" >where <span 
class="ec-lmtt-10">b</span> is some global variable. After verbatim substitution the repeat block can
   vanish completely causing a syntax error:
   <!--l. 1498--><p class="noindent" ><div class="obeylines-v"> <span 
class="ec-lmtt-10">macro+b+2+T</span>         <span 
class="cmsy-10">&#x21D2;</span><span 
class="ec-lmtt-10">(2-&#x003E;b,get affix blockno+b+2+T)</span></div>
   </li>
<li 
  class="enumerate" id="x1-37008x4">
   <!--l. 1501--><p class="noindent" >Standard selectors are not carried over.
    <!--l. 1502--><p class="noindent" ><div class="obeylines-v">
    <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">function</span><span 
class="ec-lmtt-10">&#8217;macro+t[]+x&#x003E;:</span><span 
class="ec-lmtt-10">&#x00A0;t[ptr]-&#x003E;x.</span>
</div>
   <!--l. 1506--><p class="noindent" >where <span 
class="ec-lmtt-10">ptr</span> is some global variable. After substitution
   <!--l. 1508--><p class="noindent" ><div class="obeylines-v"> <span 
class="ec-lmtt-10">macro+S+z</span>           <span 
class="cmsy-10">&#x21D2;</span><span 
class="ec-lmtt-10">(S[ptr]-&#x003E;z)</span></div>
   <!--l. 1512--><p class="noindent" >while <span 
class="ec-lmtt-10">S</span> might not have a standard selector.
   </li>
<li 
  class="enumerate" id="x1-37010x5">
   <!--l. 1514--><p class="noindent" >Out affixes get their values only after returning from a call. The rule call
   <span 
class="ec-lmtt-10">swap+x+y+x</span> swaps the value of <span 
class="ec-lmtt-10">x</span> and <span 
class="ec-lmtt-10">y</span> if it is defined as
    <!--l. 1518--><p class="noindent" ><div class="obeylines-v">
    <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">function</span><span 
class="ec-lmtt-10">&#8217;swap+&#x003E;a+b&#x003E;+c&#x003E;:</span><span 
class="ec-lmtt-10">&#x00A0;b-&#x003E;c,a-&#x003E;b.</span>
</div>
   <!--l. 1521--><p class="noindent" >but as a macro it does <span 
class="ec-lmtt-10">(y-&#x003E;x,x-&#x003E;y)</span>, with a completely different result.</li></ol>
<!--l. 1525--><p class="indent" >   Items 1) and 3) are checked during compilation, and error messages are issued if
the conditions are violated. For 2), if the actual affix is the dummy affix <span 
class="ec-lmtt-10">#</span>, the formal
out affix in the macro is replaced by a newly created anonymous local variable (which
may be removed during optimization). For 4) the macro substitution mechanism
remembers the last substituted formal affix and uses the same value for the standard
selector as the rule call would do. For 5) and other side effects, no warning is, or can
be, given, but substitution clearly changes the semantics. So use macros with
care.
<!--l. 1537--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.27   </span> <a 
 id="x1-380004.27"></a>Debugging tools</h4>
<!--l. 1539--><p class="noindent" >Debugging tools are added at the linking stage of the compilation when macro rules
have already been substituted. Consequently these tools have no effect on macro
rules.
<!--l. 1545--><p class="indent" >   <span 
class="cmti-10">Index checking</span>. It is controlled by the <span 
class="ec-lmtt-10">bounds=on/off</span> pragmat. If the pragmat is
<span 
class="ec-lmtt-10">on</span> when a rule is declared, the rule is compiled with index checking. Before touching
an indexed element, the value of the index is checked to be within the actual limits of
the indexed <span 
class="cmss-10">stack</span> or <span 
class="cmss-10">table</span>. If this is not the case, the name of the list and the
rule in which the error occurs are printed to <span 
class="ec-lmtt-10">stderr</span>, and the program is
aborted.
                                                                  

                                                                  
<!--l. 1555--><p class="indent" >   <span 
class="cmti-10">Profiling</span>. The <span 
class="ec-lmtt-10">count=on</span> pragmat adds instructions which count how many times
the rule is called. After a normal program termination the name of profiled
rules and the number of calls are printed to <span 
class="ec-lmtt-10">stderr</span>. The list starts with
the largest calling numbers, and ends with rules which were not called at
all.
<!--l. 1564--><p class="indent" >   <span 
class="cmti-10">Tracing</span>. If the pragmat <span 
class="ec-lmtt-10">trace=on</span> is in effect when a rule is declared, the rule is
compiled with instructions that print out to <span 
class="ec-lmtt-10">stderr</span> the rule name, followed by the
values of its incoming <span 
class="cmss-10">in</span> and <span 
class="cmss-10">inout</span> affixes. This can produce a huge volume
output. In the <span 
class="cmss10">C </span>version tracing information is printed only when the compiled binary is executed
with the <span 
class="ec-lmtt-10">-T</span> switch as the first command-line argument. 
<!-- This switch is swallowed and
not passed to the <span 
class="cmss10">ALEPH </span>program. Without this switch only the lastly executed 30
rulenames (without arguments) are printed when the program terminates (normally
or with an error). -->
<!--l. 1578--><p class="indent" >   <span 
class="cmti-10">Call stack</span>. Tracing provides rule calls in the order they
were executed. Frequently the <span 
class="cmti-10">call stack</span>,
the hierarchy of pending rule calls gives more useful information. When adding the <span 
class="ec-lmtt-10">-g</span>
switch to the linker it produces an <span 
class="cmss10">ALEPH </span>binary which keeps track of this call stack,
and prints it to <span 
class="ec-lmtt-10">stderr</span> when the program terminates either normally, or with an
error. This feature adds some overhead to all rule calls, and increases the size of
the compiled program, but requires no change in the source. The library
routine
  <!--l. 1586--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">action</span><span 
class="ec-lmtt-10">&#8217;backtrack.</span></div>
<!--l. 1589--><p class="noindent" >prints out the actual call stack to <span 
class="ec-lmtt-10">stderr</span> starting with the rule containing this rule
and ending with the program root. In the case the program is <span 
class="cmti-10">not </span>linked with the <span 
class="ec-lmtt-10">-g</span>
switch, <span 
class="ec-lmtt-10">backtrack</span> behaves as a no-op and does nothing.
                                                                  

                                                                  
<!--l. 1596--><p class="indent" >
                                                                  

                                                                  
<!--l. 1596--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">5   </span> <a 
 id="x1-390005"></a>Modular Aleph</h3>
<!--l. 1598--><p class="noindent" >
Modular <span 
class="cmss10">ALEPH </span>follows the usual modular design paradigm. A complete <span 
class="cmss10">ALEPH </span>program is split into smaller, incomplete parts which can be compiled
independently. These parts, called <span 
class="cmti-10">modules</span>, typically provide resources to
be used by other parts, and are written so that they can be reused by other
programs. The overall structure which attempts to solve the numerous arising
problems somewhat resembles the way <span 
class="cmss10">CDL2</span> extended <span 
class="cmss10">CDL</span> to tackle a
similar goal.  

<!--l. 1609--><p class="noindent" >In an <span 
class="cmss10">ALEPH </span>module the first non-comment line is usually a <span 
class="cmss-10">pragmat</span>
specifying both the <span 
class="cmti-10">name </span>and the <span 
class="cmti-10">namespace </span>of the module:
  <!--l. 1605--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">pragmat</span><span 
class="ec-lmtt-10">&#8217;module=XXX.</span>
</div>
<!--l. 1609--><p class="noindent" >The module name <span 
class="ec-lmtt-10">XXX</span> must be a valid <span 
class="cmss10">ALEPH </span>identifier; in the pragmat it is specified without
quotation marks. According to the best practice the name of the file containing the
module source and the module name should resemble each other. It is particularly
important as <span 
class="cmss10">ALEPH </span>modules are invoked by specifying source file names, and not
module names. While not recommended, different modules (that is, modules in
different source files) can share the same module name, and, consequently, the same
namespace.
<!--l. 1618--><p class="indent" >   In the module the initial <span 
class="ec-lmtt-10">module</span> pragmat is followed by the public part, called
the <span 
class="cmti-10">head </span>of the module. The head contains the prototypes of the (public) tags
exported by, and defined in, this module. Next to the public part is the private part,
called <span 
class="cmti-10">body</span>, which defines the exported items together with the optional auxiliary,
unexported items. The body is enclosed between <span 
class="ec-lmtt-10">ifdef=compile</span> and <span 
class="ec-lmtt-10">endif=compile</span>
pragmats.
<!--l. 1625--><p class="indent" >   An <span 
class="cmss10">ALEPH </span>module is invoked, or required, by a <span 
class="ec-lmtt-10">require="FFF"</span> pragmat
specifying the file name (possibly with path information, enclosed within quotation
marks) of the module. When required, only the public part&#8212;the module head&#8212;is
processed from the module text. Prototypes in the head are considered to be external
definitions which define items to be imported from the defining module. In contrast,
when the module is compiled, both the head and the body are processed. During
module compilation the prototypes in the head specify the items to be exported, and
the compiler checks that those items are indeed defined correctly in the module
body.
<!--l. 1635--><p class="indent" >   The following example illustrates this mechanism for a sample module which
exports two items: the rule <span 
class="ec-lmtt-10">do something</span> and the stack <span 
class="ec-lmtt-10">LEXT</span>. The module name is
<span 
class="ec-lmtt-10">sample</span> and it is stored in the file <span 
class="ec-lmtt-10">"fsample"</span>.
  <!--l. 1639--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">pragmat</span><span 
class="ec-lmtt-10">&#8217;module=sample.</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;module</span><span 
class="ec-lmtt-10">&#x00A0;name</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">action</span><span 
class="ec-lmtt-10">&#8217;do</span><span 
class="ec-lmtt-10">&#x00A0;something+&#x003E;in+out&#x003E;.</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;prototype</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">stack</span><span 
class="ec-lmtt-10">&#8217;(adm,left,right)LEXT.</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;prototype</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">pragmat</span><span 
class="ec-lmtt-10">&#8217;if=compile.</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;module</span><span 
class="ec-lmtt-10">&#x00A0;body</span><span 
class="ec-lmtt-10">&#x00A0;starts</span><span 
class="ec-lmtt-10">&#x00A0;here</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;&#8217;</span><span 
class="ec-lmtk-10">stack</span><span 
class="ec-lmtt-10">&#8217;[12](adm,left,right)LEXT[]=((3,4,5):first</span><span 
class="ec-lmtt-10">&#x00A0;item).</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;&#8217;</span><span 
class="ec-lmtk-10">action</span><span 
class="ec-lmtt-10">&#8217;do</span><span 
class="ec-lmtt-10">&#x00A0;something+&#x003E;x+y&#x003E;:</span><span 
class="ec-lmtt-10">&#x00A0;add+first</span><span 
class="ec-lmtt-10">&#x00A0;item+x+y.</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;&#8217;</span><span 
class="ec-lmtk-10">root</span><span 
class="ec-lmtt-10">&#8217;+.</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">pragmat</span><span 
class="ec-lmtt-10">&#8217;endif=compile.</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;end</span><span 
class="ec-lmtt-10">&#x00A0;of</span><span 
class="ec-lmtt-10">&#x00A0;module</span><span 
class="ec-lmtt-10">&#x00A0;body</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">end</span><span 
class="ec-lmtt-10">&#8217;</span></div>
<!--l. 1651--><p class="noindent" >When the module is compiled, the source file is read with the initial implicit
instruction <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">pragmat</span><span 
class="ec-lmtt-10">&#8217;compile=on.</span> The <span 
class="ec-lmtt-10">module=sample</span> pragmat in the first line
                                                                  

                                                                  
defines both the name and the namespace of this module to be <span 
class="ec-lmtt-10">sample</span>, and it also
sets the <span 
class="ec-lmtt-10">prototype</span> pragmat to <span 
class="ec-lmtt-10">public</span>. Next, the module head is parsed where the
compiler marks all prototyped tags to be exported (as instructed so by the
current setting of <span 
class="ec-lmtt-10">prototype</span>, see <a 
href="#x1-330004.22">Section 4.22<!--tex4ht:ref: subsec:prototype --></a>), which also means that the
prototyped tags must have a definition somewhere in the body of the module.
The condition in the <span 
class="ec-lmtt-10">if=compile</span> pragmat holds, thus the material in the
module body is processed: the <span 
class="cmss-10">stack</span> and <span 
class="cmss-10">rule</span> <span 
class="cmss-10">declaration</span>s are parsed and
executed. The empty root rule (<a 
href="#x1-230004.12">Section 4.12<!--tex4ht:ref: subsec:root-rule --></a>) indicates that the module does not
require any initialization. At the end of the module items to be exported are
checked against the prototypes and are prepared for export using the module
namespace.
<!--l. 1668--><p class="indent" >   When the main program or another module wants to use any of the resources
provided by this module, it <span 
class="cmti-10">requires </span>it by issuing
  <!--l. 1670--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">pragmat</span><span 
class="ec-lmtt-10">&#8217;require="fsample".</span>
</div>
<!--l. 1673--><p class="noindent" >specifying the file name (between quotation marks) of the module source. Before
reading the <span 
class="ec-lmtt-10">"fsample"</span> file, an initial implicit <span 
class="ec-lmtt-10">compile=off</span> pragmat is executed. The
first line in the module text sets again the name and the namespace for
the duration of processing <span 
class="ec-lmtt-10">fsample</span>, but sets the <span 
class="ec-lmtt-10">prototype</span> differently, to
<span 
class="ec-lmtt-10">import</span>. Subsequent prototypes are scanned and marked as &#8220;to be imported&#8221;.
The compiler will use this information to check that these items are used
properly in the rest of the invoking program. Reaching <span 
class="ec-lmtt-10">if=compile</span> the
condition fails, therefore the remaining part of the module, the body, is
skipped.
<!--l. 1687--><p class="indent" >   A module body can require public items from other modules. It may happen,
without any problem, that the body of module <span 
class="ec-lmtt-10">A</span> requires module <span 
class="ec-lmtt-10">B</span>, while the body
of module <span 
class="ec-lmtt-10">B</span> requires module <span 
class="ec-lmtt-10">A</span>.
<!--l. 1691--><p class="indent" >   Next to prototypes the public part of a module may also contain additional
<span 
class="cmss10">ALEPH </span>constructs. A <span 
class="ec-lmtt-10">require</span> pragmat in the head automatically re-exports the
imported items (using their original namespace), while declarations in the
head are compiled into the invoking program locally, using the module&#8217;s
namespace.
<!--l. 1699--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">5.1   </span> <a 
 id="x1-400005.1"></a>The module hierarchy</h4>
<!--l. 1701--><p class="noindent" >An <span 
class="cmss10">ALEPH </span>compilation unit (the main program or a module) may require several
modules. Any module may also require other modules in its head, which modules
may also require additional modules, and so on. The &#8220;<span 
class="ec-lmtt-10">X</span> required module <span 
class="ec-lmtt-10">Y</span>&#8221; relation
defines a hierarchy among the involved units. In this hierarchy <span 
class="ec-lmtt-10">A</span> is <span 
class="cmti-10">below </span><span 
class="ec-lmtt-10">B</span> if
there is a &#8220;require&#8221; chain from <span 
class="ec-lmtt-10">A</span> to <span 
class="ec-lmtt-10">B</span>, see also the discussion in
<a 
href="#x1-90003.2">Section 3.2<!--tex4ht:ref: subsec:general-modules --></a>. Resources provided by module <span 
class="ec-lmtt-10">B</span> are automatically available for every
unit below <span 
class="ec-lmtt-10">B</span> in this hierarchy, that is, for those units <span 
class="ec-lmtt-10">A</span> which are below
<span 
class="ec-lmtt-10">B</span>.
<!--l. 1711--><p class="indent" >   When <span 
class="ec-lmtt-10">A</span> needs a resource, that resource might be provided by several modules
                                                                  

                                                                  
above it. In the basic case among the potential offers that module is chosen which is
equal to or above <span 
class="ec-lmtt-10">A</span>, and has the <span 
class="cmti-10">smallest rank</span>, that is, which requires the smallest
number of &#8220;require&#8221; hops to reach from <span 
class="ec-lmtt-10">A</span>. By default, <span 
class="ec-lmtt-10">A</span> has rank zero above
itself.
<!--l. 1717--><p class="indent" >   The same module can be required by different modules many times, in which case
this module appears in the hierarchy at several places. Nevertheless, it is still
processed only once. Modules added as <span 
class="cmti-10">user library </span>(<a 
href="#x1-100003.3">Section 3.3<!--tex4ht:ref: subsec:user-library --></a>) using either the
command-line argument <span 
class="ec-lmtt-10">-y</span> or the <span 
class="ec-lmtt-10">library</span> pragmat, and modules required
recursively by these library modules, form a second hierarchy. Elements of this
hierarchy are <span 
class="cmti-10">above </span>the elements of the first one by a very high hop number. Using
this arrangement, resources defined by a library module are available to every plain
module, but only as a last resort: if no other definition can be found, then consult the
offers in library modules. On the top of the user library hierarchy there is still
another hierarchy: the standard <span 
class="cmss10">ALEPH </span>library providing the realization of <span 
class="cmss10">ALEPH</span>
primitives.
<!--l. 1732--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">5.2   </span> <a 
 id="x1-410005.2"></a>Finding tag definitions</h4>
<!--l. 1734--><p class="noindent" >Each <span 
class="cmss-10">tag</span> denoting an <span 
class="cmss10">ALEPH </span>construct can have a <span 
class="cmti-10">qualifier </span>specifying the namespace
this tag belongs to, such as <span 
class="ec-lmtt-10">q::x</span>, where <span 
class="ec-lmtt-10">q</span> is the qualifier. Without providing an
explicit qualifier, tags in definitions (declarations and import prototypes)
inherit the actual namespace. This namespace is empty in the main program;
otherwise it is the same as the module name defined by the <span 
class="ec-lmtt-10">module</span> pragmat.
The explicit qualifier, if present, cannot be empty. A <span 
class="cmss-10">tag</span> with a qualifier
identifies only those definitions where the same implicit or explicit qualifier is
used.
<!--l. 1744--><p class="indent" >   The process of finding the defining occurrence of a <span 
class="cmss-10">tag</span> in the module hierarchy
goes as follows. Suppose the <span 
class="cmss-10">tag</span> <span 
class="ec-lmtt-10">x</span> occurs in <span 
class="ec-lmtt-10">A</span>, where <span 
class="ec-lmtt-10">A</span> is either a module or the main
program, and <span 
class="ec-lmtt-10">x</span> has qualifier <span 
class="ec-lmtt-10">q</span> which is either explicit or implicit. (In case <span 
class="ec-lmtt-10">A</span> is the
main program, the implicit qualifier is empty.) First check modules which are <span 
class="cmti-10">strictly</span>
<span 
class="cmti-10">below </span><span 
class="ec-lmtt-10">A</span>. If some of them defines <span 
class="ec-lmtt-10">q::x</span> (where the qualifier in the definition can be
either explicit or implicit), then the one with the <span 
class="cmti-10">smallest absolute rank </span>(which has
the minimal number of &#8220;require&#8221; hops from the main program, see <a 
href="#x1-400005.1">Section 5.1<!--tex4ht:ref: subsec:hierarchy --></a>) is
chosen.
<!--l. 1755--><p class="indent" >   If this step does not give result, then consider <span 
class="ec-lmtt-10">A</span> and the modules <span 
class="cmti-10">above </span><span 
class="ec-lmtt-10">A</span>. If <span 
class="ec-lmtt-10">x</span> has
no explicit qualifier, then it matches any definition of <span 
class="ec-lmtt-10">x</span> in those modules; if <span 
class="ec-lmtt-10">x</span> has an
explicit qualifier <span 
class="ec-lmtt-10">q::x</span>, then it matches only those definitions where the qualifier is
(explicitly or implicitly set to) <span 
class="ec-lmtt-10">q</span>. Among the candidate modules that one is chosen
which has the smallest rank above <span 
class="ec-lmtt-10">A</span>. Naturally, this search must yield a unique
definition.
<!--l. 1763--><p class="indent" >   This procedure is illustrated in the picture below. Modules in files <span 
class="ec-lmtt-10">"f1"</span> and <span 
class="ec-lmtt-10">"f2"</span>
set their name to <span 
class="ec-lmtt-10">t</span>, <span 
class="ec-lmtt-10">"f2"</span> is required by the module in <span 
class="ec-lmtt-10">"f1"</span>, and <span 
class="ec-lmtt-10">"f1"</span> is required by
the main program. Tags (with the indicated explicit qualifier) in the &#8220;define&#8221; column
are defined in the module head. Hoveriong over a tag in the &#8220;use&#8221; column
shows its identified definition.

<div class="center" 
>
<!--l. 1770--><p class="noindent" >
<div class="tabular"> <table id="TBL-2" class="tabular" 
 
><colgroup id="TBL-2-1g"><col 
id="TBL-2-1"><col 
id="TBL-2-2"><col 
id="TBL-2-3"><col 
id="TBL-2-4"><col 
id="TBL-2-5"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-1-1"  
class="td11"> file </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-1-2"  
class="td11">require</td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-1-3"  
class="td11">module</td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-1-4"  
class="td11">define    </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-1-5"  
class="td11">use                 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-2-1"  
class="td11"><span 
class="ec-lmtt-10">"f2"</span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-2-2"  
class="td11">      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-2-3"  
class="td11">   <span 
class="ec-lmtt-10">t   </span></td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-2-4"  
class="td11"><span 
class="ec-lmtt-10">b v     </span></td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-2-5"  
class="td11"><span 
class="ec-lmtt-10"><span class="f1a">a</span> <span class="f1v">v</span>
<span class="maintx">x</span>         </span></td>
</tr><tr 
class="vspace" style="font-size:3.0pt"><td 
>&nbsp;</td><td 
>&nbsp;</td><td 
>&nbsp;</td><td 
>&nbsp;</td><td 
>&nbsp;</td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-3-1"  
class="td11"><span 
class="ec-lmtt-10">"f1"</span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-3-2"  
class="td11"> <span 
class="ec-lmtt-10">"f2" </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-3-3"  
class="td11">   <span 
class="ec-lmtt-10">t   </span></td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-3-4"  
class="td11"><span 
class="ec-lmtt-10">a v     </span></td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-3-5"  
class="td11"><span 
class="ec-lmtt-10"><span class="f1a">a</span> <span class="maintx">x</span>
   </span></td>
</tr><tr 
class="vspace" style="font-size:3.0pt"><td 
>&nbsp;</td><td 
>&nbsp;</td><td 
>&nbsp;</td><td 
>&nbsp;</td><td 
>&nbsp;</td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-4-1"  
class="td11">main</td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-4-2"  
class="td11"> <span 
class="ec-lmtt-10">"f1" </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-4-3"  
class="td11">      </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-4-4"  
class="td11"><span 
class="ec-lmtt-10">a t::x x</span></td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-4-5"  
class="td11"><span 
class="ec-lmtt-10"><span class="maina">a</span> <span class="f2b">b</span>
<span class="f2b">t::b</span> <span class="f1v">v</span> <span
class="mainx">x</span></span></td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-5-1"  
class="td11">    </td></tr></table></div></div>
<!--l. 1800--><p class="noindent" >The <span 
class="cmss-10">tag</span> <span 
class="ec-lmtt-10">a</span> both in the module from file <span 
class="ec-lmtt-10">"f1"</span> and from file <span 
class="ec-lmtt-10">"f2"</span> has the implicit
qualifier <span 
class="ec-lmtt-10">t</span>, therefore it does not match the definition of <span 
class="ec-lmtt-10">a</span> in the main program. The
<span 
class="cmss-10">tag</span> <span 
class="ec-lmtt-10">x</span> in these modules matches the definition of <span 
class="ec-lmtt-10">t::x</span> in the main program, but
not the definition of <span 
class="ec-lmtt-10">x</span> (without qualifier) there. Both <span 
class="ec-lmtt-10">b</span> and <span 
class="ec-lmtt-10">t::b</span> in the
main program identifies the single definition of <span 
class="ec-lmtt-10">b</span> in <span 
class="ec-lmtt-10">"f2"</span>. Observe that the
definition of <span 
class="ec-lmtt-10">v</span> in <span 
class="ec-lmtt-10">"f2"</span> is not used at all; <span 
class="ec-lmtt-10">v</span> in <span 
class="ec-lmtt-10">"f2"</span> uses the definition in
<span 
class="ec-lmtt-10">"f1"</span>.
<!--l. 1812--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">5.3   </span> <a 
 id="x1-420005.3"></a>Requiring and including source files</h4>
<!--l. 1814--><p class="noindent" >Source files are handled one file at a time. They are read, processed and
closed before opening the next source. Source files can be specified on the
command line, required by a <span 
class="ec-lmtt-10">require</span> or <span 
class="ec-lmtt-10">library</span> pragmat (or by the equivalent
command-line options, see <a 
href="#x1-340004.23">Section 4.23<!--tex4ht:ref: subsec:pragmats --></a>), finally can be included by an <span 
class="ec-lmtt-10">include</span>
pragmat.
<!--l. 1820--><p class="indent" >   The pragmat <span 
class="ec-lmtt-10">require="file"</span> places the source <span 
class="ec-lmtt-10">file</span> into the module
hierarchy (<a 
href="#x1-400005.1">Section 5.1<!--tex4ht:ref: subsec:hierarchy --></a>), and then queues the file to the end of files to be
processed as a <span 
class="cmti-10">module</span>. This second step is ignored if the same filename is
already in the queue, causing each source file to be processed once. Library
modules (including the standard library) are handled similarly, but their
processing starts only after all non-library sources have been completed. A
source file added by a <span 
class="ec-lmtt-10">require</span> pragmat in a library module is treated as a
library.
<!--l. 1829--><p class="indent" >   Using the pragmat <span 
class="ec-lmtt-10">include="file"</span>, this <span 
class="ec-lmtt-10">file</span> is <span 
class="cmti-10">always </span>appended to the end of
the source list, together with the <span 
class="ec-lmtt-10">prototype</span> and <span 
class="ec-lmtt-10">compile</span> pragmat values and the
module status (is it a module, and if yes, which one) of the invoking source. In
contrast to modules and libraries, included sources are processed as many times as
they are specified.
<!--l. 1836--><p class="indent" >   As discussed at the beginning of <a 
href="#x1-390005">Section 5<!--tex4ht:ref: section:module --></a>, when a source is processed as a
required module, an implicit <span 
class="ec-lmtt-10">compile=off</span> pragmat is executed before reading its
first character. When the source is to be compiled (the file name is specified in the
command line), an implicit <span 
class="ec-lmtt-10">compile=on</span> pragmat is executed before processing. The
effect of a <span 
class="ec-lmtt-10">module=XXX</span> pragmat depends on whether <span 
class="ec-lmtt-10">compile</span> is on or off. If
<span 
class="ec-lmtt-10">compile=on</span>, then the <span 
class="ec-lmtt-10">module</span> pragmat switches to module compilation and sets
<span 
class="ec-lmtt-10">prototype=public</span>. If <span 
class="ec-lmtt-10">compile=off</span>, then it sets <span 
class="ec-lmtt-10">prototype=import</span> as it reads a
                                                                  

                                                                  
module head.
<!--l. 1848--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">5.4   </span> <a 
 id="x1-430005.4"></a>Using the namespace</h4>
<!--l. 1850--><p class="noindent" >A module can have &#8220;call-back&#8221; rules whose definition must be provided by the
invoking program. An example could be a module which provides a sorting algorithm
without defining the rule which compares the elements to be sorted. The skeleton of
this module can be
  <!--l. 1855--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">pragmat</span><span 
class="ec-lmtt-10">&#8217;module=sort.</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;module</span><span 
class="ec-lmtt-10">&#x00A0;name</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">action</span><span 
class="ec-lmtt-10">&#8217;qsort+[]st[].</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">pragmat</span><span 
class="ec-lmtt-10">&#8217;prototype=reverse.</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;reverse</span><span 
class="ec-lmtt-10">&#x00A0;the</span><span 
class="ec-lmtt-10">&#x00A0;meaning</span><span 
class="ec-lmtt-10">&#x00A0;</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">question</span><span 
class="ec-lmtt-10">&#8217;qless+&#x003E;x+&#x003E;y.</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">pragmat</span><span 
class="ec-lmtt-10">&#8217;prototype=reverse.</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;redo</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">pragmat</span><span 
class="ec-lmtt-10">&#8217;if=compile.</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;module</span><span 
class="ec-lmtt-10">&#x00A0;body</span><span 
class="ec-lmtt-10">&#x00A0;starts</span><span 
class="ec-lmtt-10">&#x00A0;here</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">action</span><span 
class="ec-lmtt-10">&#8217;qsort+[]st[]:</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;...</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;use</span><span 
class="ec-lmtt-10">&#x00A0;qless+x+y</span><span 
class="ec-lmtt-10">&#x00A0;for</span><span 
class="ec-lmtt-10">&#x00A0;comparison</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">root</span><span 
class="ec-lmtt-10">&#8217;+.</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">pragmat</span><span 
class="ec-lmtt-10">&#8217;endif=compile.</span>
</div>
<!--l. 1867--><p class="noindent" >The rule call <span 
class="ec-lmtt-10">qsort+st</span> will sort the elements of the stack <span 
class="ec-lmtt-10">st</span> so that for comparing
two stack elements it uses the rule <span 
class="ec-lmtt-10">qless+x+y</span>, with the assumption that this
comparison rule returns true just in case <span 
class="ec-lmtt-10">x</span> is &#8220;smaller than&#8221; <span 
class="ec-lmtt-10">y</span>, whatever &#8220;smaller&#8221;
means. In the module skeleton the first
  <!--l. 1874--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">pragmat</span><span 
class="ec-lmtt-10">&#8217;prototype=reverse.</span>
</div>
<!--l. 1878--><p class="noindent" >pragmat ensures that the <span 
class="ec-lmtt-10">qless</span> prototype is handled correctly. When the module is
compiled then <span 
class="ec-lmtt-10">qless</span> is marked to be imported (since now the <span 
class="ec-lmtt-10">prototype</span> pragmat is
reversed to <span 
class="ec-lmtt-10">import</span>). Similarly, when the module is required, then <span 
class="ec-lmtt-10">qless</span> is to be
exported (instead of the default <span 
class="ec-lmtt-10">import</span>). The second <span 
class="ec-lmtt-10">prototype</span> pragmat restores its
original value; it can be omitted if there are no additional prototypes in the
module.
<!--l. 1886--><p class="indent" >   When requiring the <span 
class="ec-lmtt-10">qsort</span> module the rule <span 
class="ec-lmtt-10">qless</span> must be specified by the
invoking program. Since declarations there use a different namespace, <span 
class="ec-lmtt-10">qless</span> must be
declared with an explicit qualifier:
  <!--l. 1890--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">pragmat</span><span 
class="ec-lmtt-10">&#8217;require="sort".</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;require</span><span 
class="ec-lmtt-10">&#x00A0;the</span><span 
class="ec-lmtt-10">&#x00A0;sorting</span><span 
class="ec-lmtt-10">&#x00A0;module</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">stack</span><span 
class="ec-lmtt-10">&#8217;[]A[]=(3,4,7,1,0).</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">question</span><span 
class="ec-lmtt-10">&#8217;sort::qless+&#x003E;x+&#x003E;y:</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;use</span><span 
class="ec-lmtt-10">&#x00A0;the</span><span 
class="ec-lmtt-10">&#x00A0;module</span><span 
class="ec-lmtt-10">&#x00A0;namespace</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;x&#x003E;y.</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;sort</span><span 
class="ec-lmtt-10">&#x00A0;in</span><span 
class="ec-lmtt-10">&#x00A0;reverse</span><span 
class="ec-lmtt-10">&#x00A0;order</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">root</span><span 
class="ec-lmtt-10">&#8217;qsort+A.</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;and</span><span 
class="ec-lmtt-10">&#x00A0;use</span><span 
class="ec-lmtt-10">&#x00A0;it</span>
</div>
<!--l. 1898--><p class="noindent" >When compiling the <span 
class="ec-lmtt-10">sort</span> module the rule <span 
class="ec-lmtt-10">qless</span> is left unspecified, and it is the
linker&#8217;s responsibility to replace it by the rule declared in the main program. Since
there is a single compiled instance of <span 
class="ec-lmtt-10">qsort</span> (in which calls to <span 
class="ec-lmtt-10">qless</span> become
hard-coded after linking) in the whole program, only a single instance of <span 
class="ec-lmtt-10">qsort</span> can
exist. This means that one cannot use such a sorting procedure with more than one
definition of the comparison rule.
                                                                  

                                                                  
<!--l. 1907--><p class="indent" >   To overcome this problem, the invoking module could have a <span 
class="cmti-10">local copy </span>of the
sorting rule, which then can call the locally defined comparison rule. This would
result in different sorting routines in different modules. To achieve this simply move
the definition of the rule <span 
class="ec-lmtt-10">qsort</span> from the module body into the head, and delete both
prototypes. After this the module body becomes empty and can be omitted
completely (consequently the module need not be compiled). The result is the <span 
class="ec-lmtt-10">isort</span>
module
  <!--l. 1915--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">pragmat</span><span 
class="ec-lmtt-10">&#8217;module=isort.</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;inline</span><span 
class="ec-lmtt-10">&#x00A0;sorting</span><span 
class="ec-lmtt-10">&#x00A0;module</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">action</span><span 
class="ec-lmtt-10">&#8217;qsort+[]st[]:</span><span 
class="ec-lmtt-10">&#x00A0;...</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;the</span><span 
class="ec-lmtt-10">&#x00A0;complete</span><span 
class="ec-lmtt-10">&#x00A0;sorting</span><span 
class="ec-lmtt-10">&#x00A0;routine</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;using</span><span 
class="ec-lmtt-10">&#x00A0;qless+x+y</span><span 
class="ec-lmtt-10">&#x00A0;for</span><span 
class="ec-lmtt-10">&#x00A0;comparison</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">end</span><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;end</span><span 
class="ec-lmtt-10">&#x00A0;of</span><span 
class="ec-lmtt-10">&#x00A0;source</span></div>
<!--l. 1922--><p class="noindent" >When the module <span 
class="ec-lmtt-10">isort</span> is required, its head is compiled into the invoking unit
locally, but keeping the module status and namespace. Thus the comparison rule
<span 
class="ec-lmtt-10">qless</span> still must be defined with a qualifier:
  <!--l. 1927--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">pragmat</span><span 
class="ec-lmtt-10">&#8217;require="isort".</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;require</span><span 
class="ec-lmtt-10">&#x00A0;the</span><span 
class="ec-lmtt-10">&#x00A0;module</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">question</span><span 
class="ec-lmtt-10">&#8217;isort::qless+&#x003E;x+&#x003E;y:</span><span 
class="ec-lmtt-10">&#x00A0;x&#x003E;y.</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">stack</span><span 
class="ec-lmtt-10">&#8217;[]A[]=(3,4,7,1,0).</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;...</span><span 
class="ec-lmtt-10">&#x00A0;qsort+A</span><span 
class="ec-lmtt-10">&#x00A0;...</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;this</span><span 
class="ec-lmtt-10">&#x00A0;is</span><span 
class="ec-lmtt-10">&#x00A0;a</span><span 
class="ec-lmtt-10">&#x00A0;reverse</span><span 
class="ec-lmtt-10">&#x00A0;sort</span><span 
class="ec-lmtt-10">&#x00A0;A</span>
</div>
<!--l. 1934--><p class="noindent" >Since everything is local to the invoking unit, different modules can require this inline
sorting module and tailor the comparison rule <span 
class="ec-lmtt-10">qless</span> according to their different
needs.
<!--l. 1939--><p class="indent" >   As a final twist, this arrangement allows the <span 
class="ec-lmtt-10">isort</span> module to have a <span 
class="cmti-10">default</span>
comparison rule, which should be redefined only when another sorting order is
required. Simply add the default rule to the module head:
  <!--l. 1944--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">pragmat</span><span 
class="ec-lmtt-10">&#8217;module=isort.</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;inline</span><span 
class="ec-lmtt-10">&#x00A0;sorting</span><span 
class="ec-lmtt-10">&#x00A0;module</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">action</span><span 
class="ec-lmtt-10">&#8217;qsort+[]st[]:</span><span 
class="ec-lmtt-10">&#x00A0;...</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;the</span><span 
class="ec-lmtt-10">&#x00A0;complete</span><span 
class="ec-lmtt-10">&#x00A0;sorting</span><span 
class="ec-lmtt-10">&#x00A0;routine</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;using</span><span 
class="ec-lmtt-10">&#x00A0;qless+x+y</span><span 
class="ec-lmtt-10">&#x00A0;for</span><span 
class="ec-lmtt-10">&#x00A0;comparison</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">question</span><span 
class="ec-lmtt-10">&#8217;qless+&#x003E;x+&#x003E;y:x&#x003C;y.</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;default</span><span 
class="ec-lmtt-10">&#x00A0;comparison</span><span 
class="ec-lmtt-10">&#x00A0;rule</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">end</span><span 
class="ec-lmtt-10">&#8217;</span></div>
<!--l. 1952--><p class="noindent" >This comparison rule will be used when the invoking unit does not supply its own
<span 
class="ec-lmtt-10">qless</span> rule. It is so as during the compilation of the rule <span 
class="ec-lmtt-10">qsort</span>, the defining instance
of <span 
class="ec-lmtt-10">qless</span> inside <span 
class="ec-lmtt-10">qsort</span> is determined so that
   <ul class="itemize0">
   <li class="itemize">
   <!--l. 1958--><p class="noindent" >if  there  is  a  definition  of  <span 
class="ec-lmtt-10">isort::qless</span> in  the  invoking  unit,  then  that
   definition is used;
   </li>
   <li class="itemize">
   <!--l. 1960--><p class="noindent" >if there is no such a definition, then the one in the module head is used,</li></ul>
<!--l. 1963--><p class="noindent" >see the discussion and the Figure in  <a 
href="#x1-410005.2">Section 5.2<!--tex4ht:ref: subsec:qualifier --></a>. If the invoking unit supplies its own
comparison rule, then the default one is not used at all, and is not included in the
final binary.
                                                                  

                                                                  
<!--l. 1969--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">5.5   </span> <a 
 id="x1-440005.5"></a>Redefining a module resource</h4>
<!--l. 1971--><p class="noindent" >The mechanism identifying definitions can be used to redefine transparently resources
exported by a module. For an example, suppose that the module <span 
class="ec-lmtt-10">MOD</span> in file <span 
class="ec-lmtt-10">"MOD"</span>
exports the rule <span 
class="ec-lmtt-10">proc+&#x003E;x+y&#x003E;</span>. We would like to add tracing information before and
after the call to this rule, but keep other resources supplied by <span 
class="ec-lmtt-10">MOD</span> intact. This can
be achieved by creating another module, say <span 
class="ec-lmtt-10">MODtr</span>, which requests <span 
class="ec-lmtt-10">MOD</span> and
redefines <span 
class="ec-lmtt-10">proc</span> in its head, and provides the alternate rule definition in its
body.
  <!--l. 1979--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">pragmat</span><span 
class="ec-lmtt-10">&#8217;module=MODtr.</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">pragmat</span><span 
class="ec-lmtt-10">&#8217;require="MOD".</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;read</span><span 
class="ec-lmtt-10">&#x00A0;and</span><span 
class="ec-lmtt-10">&#x00A0;export</span><span 
class="ec-lmtt-10">&#x00A0;module</span><span 
class="ec-lmtt-10">&#x00A0;MOD</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">action</span><span 
class="ec-lmtt-10">&#8217;proc+&#x003E;x+y&#x003E;.</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;prototype,</span><span 
class="ec-lmtt-10">&#x00A0;redefine</span><span 
class="ec-lmtt-10">&#x00A0;this</span><span 
class="ec-lmtt-10">&#x00A0;rule</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">pragmat</span><span 
class="ec-lmtt-10">&#8217;if=compile.</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;module</span><span 
class="ec-lmtt-10">&#x00A0;body</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">a</span><span 
class="ec-lmtt-10">&#8217;proc+&#x003E;x+y&#x003E;:</span><span 
class="ec-lmtt-10">&#x00A0;before+x,</span><span 
class="ec-lmtt-10">&#x00A0;MOD::proc+x+y,</span><span 
class="ec-lmtt-10">&#x00A0;after+y.</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">a</span><span 
class="ec-lmtt-10">&#8217;before+&#x003E;x:</span><span 
class="ec-lmtt-10">&#x00A0;....</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;print</span><span 
class="ec-lmtt-10">&#x00A0;some</span><span 
class="ec-lmtt-10">&#x00A0;tracing</span><span 
class="ec-lmtt-10">&#x00A0;information</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">a</span><span 
class="ec-lmtt-10">&#8217;after+&#x003E;y:</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;....</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;print</span><span 
class="ec-lmtt-10">&#x00A0;some</span><span 
class="ec-lmtt-10">&#x00A0;tracing</span><span 
class="ec-lmtt-10">&#x00A0;information</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">root</span><span 
class="ec-lmtt-10">&#8217;+.</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">pragmat</span><span 
class="ec-lmtt-10">&#8217;endif=compile.</span>
</div>
<!--l. 1990--><p class="noindent" >In the module body <span 
class="ec-lmtt-10">MOD::proc</span> calls the original rule as defined in (exported by) the
module <span 
class="ec-lmtt-10">MOD</span>. Omitting the qualifier here would cause this rule to call itself making an
infinite recursion.
<!--l. 1995--><p class="indent" >   Replacing <span 
class="ec-lmtt-10">"MOD"</span> by <span 
class="ec-lmtt-10">"MODtr"</span> in the pragmat requiring the module does all
the tricks. All other resources provided by <span 
class="ec-lmtt-10">MOD</span> are still available (without
qualifiers), while calls to <span 
class="ec-lmtt-10">proc</span> are now handled by the new definition in
<span 
class="ec-lmtt-10">MODtr</span>. Observe that internal calls to <span 
class="ec-lmtt-10">proc</span> in the original <span 
class="ec-lmtt-10">MOD</span> module are not
affected.
<!--l. 2003--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">5.6   </span> <a 
 id="x1-450005.6"></a>Redefining library items</h4>
<!--l. 2005--><p class="noindent" >Assignments (<span 
class="cmss-10">transport</span>s in <span 
class="cmss10">ALEPH </span>parlance) and relations (of which <span 
class="cmss-10">identity</span> is an
example, see  <a 
href="#x1-140004.3">Section 4.3<!--tex4ht:ref: subsec:relations --></a>) are handled as a syntactically different way of writing a rule
call. Internally, the assignment <span 
class="ec-lmtt-10">a-&#x003E;b[c]-&#x003E;c</span> is transformed into the rule call
<span 
class="ec-lmtt-10">@make+a+b[c]+c</span> (recall that the character <span 
class="ec-lmtt-10">@</span> is a letter in library mode,
<a 
href="#x1-360004.25">Section 4.25<!--tex4ht:ref: subsec:library --></a>). The rule <span 
class="ec-lmtt-10">@make</span> is exported by the standard library and has the
prototype
  <!--l. 2012--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">function</span><span 
class="ec-lmtt-10">&#8217;@make+&#x003E;from+@+to&#x003E;.</span></div>
<!--l. 2015--><p class="noindent" >Similarly, relations are transformed to calls of rules <span 
class="ec-lmtt-10">@equal</span>, <span 
class="ec-lmtt-10">@noteq</span>, <span 
class="ec-lmtt-10">@more</span>, <span 
class="ec-lmtt-10">@less</span>,
<span 
class="ec-lmtt-10">@mreq</span>, and <span 
class="ec-lmtt-10">@lseq</span>, respectively; all of them are <span 
class="cmti-10">question</span>s with two input affixes. They
are also exported by the standard library. Any of these rules can be redefined (after
switching to library mode) to do something different. As an example, suppose the list
<span 
class="ec-lmtt-10">STR</span> contains strings, and two pointers to <span 
class="ec-lmtt-10">STR</span> should be considered equal if the
strings they point to are the same, not only if they, as pointers, are equal.
So
                                                                  

                                                                  
  <!--l. 2024--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#x00A0;(ptr1=ptr2,print+"strings</span><span 
class="ec-lmtt-10">&#x00A0;are</span><span 
class="ec-lmtt-10">&#x00A0;equal";</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;print+"strings</span><span 
class="ec-lmtt-10">&#x00A0;are</span><span 
class="ec-lmtt-10">&#x00A0;not</span><span 
class="ec-lmtt-10">&#x00A0;equal")</span>
</div>
<!--l. 2028--><p class="noindent" >would print <span 
class="ec-lmtt-10">strings are equal</span> if the strings pointed by <span 
class="ec-lmtt-10">ptr1</span> and <span 
class="ec-lmtt-10">ptr2</span> are, as
strings, equal. This can be achieved by redefining <span 
class="ec-lmtt-10">@equal</span> to handle this case as
follows:
  <!--l. 2032--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">pragmat</span><span 
class="ec-lmtt-10">&#8217;library</span><span 
class="ec-lmtt-10">&#x00A0;mode=on.</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">question</span><span 
class="ec-lmtt-10">&#8217;@equal+&#x003E;x+&#x003E;y-eq:</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;(was+STR+x,was+STR+y),compare</span><span 
class="ec-lmtt-10">&#x00A0;string+STR+x+STR+y+eq,eq=0;</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;stdlib::@equal+x+y.</span>
  <br /><span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">pragmat</span><span 
class="ec-lmtt-10">&#8217;library</span><span 
class="ec-lmtt-10">&#x00A0;mode=off.</span>
</div>
<!--l. 2039--><p class="noindent" >When <span 
class="ec-lmtt-10">x</span> and <span 
class="ec-lmtt-10">y</span> are not string pointers the rule calls the original <span 
class="ec-lmtt-10">@equal</span> from the
standard library. Actually, the test <span 
class="ec-lmtt-10">eq=0</span> should rather be <span 
class="ec-lmtt-10">stdlib::@equal+eq+0</span>, as
now this <span 
class="ec-lmtt-10">@equal</span> calls itself. (Fortunately <span 
class="ec-lmtt-10">eq</span> is not an <span 
class="ec-lmtt-10">STR</span> pointer thus it won&#8217;t fall
into an infinite recursion.) In the module where this definition appears all equality
tests will use this rule. To improve efficiency one might consider declaring this
<span 
class="ec-lmtt-10">@equal</span> to be a macro, <a 
href="#x1-370004.26">Section 4.26<!--tex4ht:ref: sec:macro --></a>.
                                                                  

                                                                  
<!--l. 2050--><p class="indent" >
                                                                  

                                                                  
<!--l. 2050--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">6   </span> <a 
 id="x1-460006"></a>Standard library</h3>
<!--l. 2052--><p class="noindent" >Elements of the standard <span 
class="cmss10">ALEPH </span>library can be used without further notice, and can
be redeclared in a user library (<a 
href="#x1-100003.3">Section 3.3<!--tex4ht:ref: subsec:user-library --></a>) or in the main text; see an example in
<a 
href="#x1-450005.6">Section 5.6<!--tex4ht:ref: subsec:redef-library --></a>. The <span 
class="cmss10">ALEPH </span>Manual <span class="cite">[<a 
href="#XA-manual">2</a>]</span> specifies many standard items, called <span 
class="cmti-10">standard</span>
<span 
class="cmti-10">externals</span>, which should be available for the programmer. In this implementation most
of them, but not all, are defined in the standard library module, called <span 
class="ec-lmtt-10">stdlib</span>. The
main omission is double precision arithmetic, while there are many additions. The
complete list can be found in the <span 
class="cmss10">ALEPH </span>standard library source of the
implementation with extensive comments. A few of the standard library items are
discussed below.
<!--l. 2063--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">6.1   </span> <a 
 id="x1-470006.1"></a>Stacks</h4>
<!--l. 2065--><p class="noindent" >Calling <span 
class="ec-lmtt-10">unstack+st</span> discards the rightmost block of the stack <span 
class="ec-lmtt-10">st</span> by decreasing the
actual upper bound of the stack by its <span 
class="cmti-10">calibre</span>. The calibre of the declared stack is
used even if <span 
class="ec-lmtt-10">st</span> is a formal affix with or without an explicit selector block. The rule
<span 
class="ec-lmtt-10">scratch+st</span> discards all elements of the stack <span 
class="ec-lmtt-10">st</span> but keeps the allocated
memory. It is implemented by moving the upper bound of <span 
class="ec-lmtt-10">st</span> to its minimal
value. The rule <span 
class="ec-lmtt-10">release+st</span> additionally releases the memory allocated to the
stack <span 
class="ec-lmtt-10">st</span>; physical memory will be reallocated again when <span 
class="ec-lmtt-10">st</span> is expanded.
This rule replaces <span 
class="ec-lmtt-10">delete+st</span> from the Manual using the more standard
terminology. Additional memory can be requested in bulk by calling <span 
class="ec-lmtt-10">request</span>
<span 
class="ec-lmtt-10">space+st+n</span>. After a successful return the actual bounds of the stact <span 
class="ec-lmtt-10">st</span> do
not change, but there are at least <span 
class="ec-lmtt-10">n</span> additional words of allocated memory
above the top of <span 
class="ec-lmtt-10">st</span>. This rule fails if the requested additional memory is not
available.
<!--l. 2081--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">6.2   </span> <a 
 id="x1-480006.2"></a>Strings</h4>
<!--l. 2083--><p class="noindent" >To copy a string to the top of the stack <span 
class="ec-lmtt-10">st</span> use <span 
class="ec-lmtt-10">copy string+t[]+&#x003E;p+[]st[]</span>; it is
more efficient than unpacking and packing the string. The rule <span 
class="ec-lmtt-10">compare string</span>
compares two strings, returning a positive, zero or negative value depending on the
relation of the strings. The rule
  <!--l. 2087--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;&#8217;</span><span 
class="ec-lmtk-10">q</span><span 
class="ec-lmtt-10">&#8217;compare</span><span 
class="ec-lmtt-10">&#x00A0;string</span><span 
class="ec-lmtt-10">&#x00A0;n+t1[]+&#x003E;p1+t2[]+&#x003E;p2+&#x003E;n+res&#x003E;.</span>
</div>
<!--l. 2090--><p class="noindent" >compares the strings up to <span 
class="ec-lmtt-10">n</span> UTF-8 characters. It is the counterpart of the <span 
class="cmss10">C</span>
function <span 
class="ec-lmtt-10">strncmp</span>.
<!--l. 2094--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">6.3   </span> <a 
 id="x1-490006.3"></a>File operations</h4>
                                                                  

                                                                  
<!--l. 2096--><p class="noindent" >Each <span 
class="cmss10">ALEPH </span>file has an associated error variable, and each file operation sets it. If
the operation succeeds, the stored code is zero, otherwise it indicates the reason of
the error. The function
<!--l. 2100--><p class="indent" ><div class="obeylines-v">   <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">f</span><span 
class="ec-lmtt-10">&#8217;get file error+""f+err&#x003E;</span></div>
<!--l. 2102--><p class="noindent" >recovers the error code from file <span 
class="ec-lmtt-10">f</span>. It is zero if the last file operation preformed by <span 
class="ec-lmtt-10">f</span>
succeeded. Otherwise it is either the <span 
class="ec-lmtt-10">errno</span> value set by the underlying <span 
class="cmss10">C </span>system
file operation, or is a value above 10000 when it was set by the <span 
class="cmss10">ALEPH </span>file
interface.
<!--l. 2108--><p class="indent" ><div class="obeylines-v">   <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">p</span><span 
class="ec-lmtt-10">&#8217;open file+""f+&#x003E;mode+t[]+&#x003E;p</span></div>
<!--l. 2110--><p class="noindent" >opens a file and associates it with the <span 
class="cmss10">ALEPH </span>file <span 
class="ec-lmtt-10">f</span>. The string given by
the last two affixes specify the file name with possible path information.
The <span 
class="ec-lmtt-10">mode</span> specifies how the file is opened; it is <span 
class="ec-lmtt-10">/r/</span>, <span 
class="ec-lmtt-10">/w/</span> or <span 
class="ec-lmtt-10">/a/</span> for reading,
writing, and appending. Only character files can be opened for appending, for
details see <a 
href="#x1-310004.20">Section 4.20<!--tex4ht:ref: subsec:datafiles --></a>. Character files can use the strings <span 
class="ec-lmtt-10">"&#x003C;&#x003C;stdin&#x003E;&#x003E;"</span>,
<span 
class="ec-lmtt-10">"&#x003C;&#x003C;stdout&#x003E;&#x003E;"</span> and <span 
class="ec-lmtt-10">"&#x003C;&#x003C;stderr&#x003E;&#x003E;"</span> as filenames for the corresponding standard
streams.
<!--l. 2120--><p class="indent" ><div class="obeylines-v">   <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">p</span><span 
class="ec-lmtt-10">&#8217;open temp file+""f+[]st[]+&#x003E;p</span></div>
<!--l. 2122--><p class="noindent" >creates a temporary file (either character or data) and opens it for writing. The
supplied string must end with six <span 
class="ec-lmtt-10">X</span> characters, and must be on a <span 
class="cmss-10">stack</span> as
the rule replaces these characters by other ones which make the file name
unique.
<!--l. 2128--><p class="indent" ><div class="obeylines-v">   <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">a</span><span 
class="ec-lmtt-10">&#8217;put data+""f+&#x003E;x+&#x003E;type</span></div>
<!--l. 2130--><p class="noindent" >writes <span 
class="ec-lmtt-10">x</span> either as a word or as a pointer (depending on <span 
class="ec-lmtt-10">type</span>) to the data file <span 
class="ec-lmtt-10">f</span>,
aborting the program in case of an error (for example when a non-zero pointer data
doesn&#8217;t point into one of the lists specified in the declaration of <span 
class="ec-lmtt-10">f</span>). To handle errors
use the predicate <span 
class="ec-lmtt-10">put datap+f+x+type</span> which fails in case of an error. The error code
can be retrieved by <span 
class="ec-lmtt-10">get file error</span>.
<!--l. 2138--><p class="indent" ><div class="obeylines-v">   <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">a</span><span 
class="ec-lmtt-10">&#8217;close file+""f</span></div>
<!--l. 2140--><p class="noindent" >closes the file <span 
class="ec-lmtt-10">f</span>. In case of an error the program is aborted.
<!--l. 2143--><p class="indent" ><div class="obeylines-v">   <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">a</span><span 
class="ec-lmtt-10">&#8217;unlink file+t[]+&#x003E;p</span></div>
<!--l. 2145--><p class="noindent" >deletes the file specified by the string; this rule silently ignores errors.
<!--l. 2148--><p class="indent" ><div class="obeylines-v">   <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">a</span><span 
class="ec-lmtt-10">&#8217;put string+""f+t[]+&#x003E;p</span></div>
<!--l. 2150--><p class="noindent" >writes the specified string to the character file <span 
class="ec-lmtt-10">f</span>, while <span 
class="ec-lmtt-10">put as string+f+t+p</span> writes
the same string between quotation marks and doubles the quotation marks inside the
string, producing a proper <span 
class="cmss-10">string denotation</span>.
<!--l. 2156--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">6.4   </span> <a 
 id="x1-500006.4"></a>Character output</h4>
<!--l. 2158--><p class="noindent" >The <span 
class="cmss10">ALEPH </span>character files <span 
class="ec-lmtt-10">STDIN</span> and <span 
class="ec-lmtt-10">STDOUT</span> are associated with the standard
input and standard output streams. These <span 
class="cmss10">ALEPH </span>files can be used, without
opening, to read from and write to the terminal, see <a 
href="#x1-310004.20">Section 4.20<!--tex4ht:ref: subsec:datafiles --></a>. Next to the
general character input and output rules the following ones write directly to
<span 
class="ec-lmtt-10">STDOUT</span>:
<div class="obeylines-v" style="color:black">
<!--l. 2166--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">putc+&#x003E;c</span>               write the character <span 
class="ec-lmtt-10">c</span> to <span 
class="ec-lmtt-10">STDOUT</span>
<!--l. 2168--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">print char+&#x003E;c</span>        same as <span 
class="ec-lmtt-10">putc+c</span>
<!--l. 2168--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">print int+&#x003E;n</span>        same as <span 
class="ec-lmtt-10">put int+STDOUT+n</span>
<!--l. 2170--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">print string+t[]+&#x003E;p</span>  write the given string to <span 
class="ec-lmtt-10">STDOUT</span>
<!--l. 2172--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">printf+"format"+...</span>  formatted printing</div>
<!--l. 2174--><p class="noindent" >The first two arguments of the formatted printing defines the format string,
additional affixes are words. Format characters determine how the next affix is
printed: <span 
class="ec-lmtt-10">%c</span> for printing as a character; <span 
class="ec-lmtt-10">%d</span> as a decimal number; <span 
class="ec-lmtt-10">%x</span> as a hexadecimal
number; finally <span 
class="ec-lmtt-10">%n</span> prints a newline character without consuming an affix.
Thus
<!--l. 2181--><p class="indent" ><div class="obeylines-v">   <span 
class="ec-lmtt-10">/$/-&#x003E;n, printf+"Char:%c, code:%d, hex:#%x%n"+n+n+n,</span></div>
<!--l. 2183--><p class="noindent" >prints the text

<p class="noindent" ><div class="obeylines-v"> <span 
class="ec-lmtt-10">Char:$, code:36, hex:#24</span></div>

<p class="noindent" >followed by a newline character.
Corresponding rules starting with the letter <span 
class="ec-lmtt-10">f</span> have a character file first argument
specifying where the result should go. To read a character from <span 
class="ec-lmtt-10">STDIN</span> one can use
the rule <span 
class="ec-lmtt-10">getc+c&#x003E;</span>.
<!--l. 2190--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">6.5   </span> <a 
 id="x1-510006.5"></a>Miscellaneous</h4>
<!--l. 2192--><p class="noindent" >Command-line arguments can be retrieved from the external table <span 
class="ec-lmtt-10">STDARG</span>. This table
contains these arguments as strings in <span 
class="cmti-10">reverse order </span>ending with the first argument
at <span 
class="ec-lmtt-10">&#x003E;&#x003E;STDARG</span>. The following rule prints all command-line arguments to the console in
their original order:
  <!--l. 2196--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">a</span><span 
class="ec-lmtt-10">&#8217;print</span><span 
class="ec-lmtt-10">&#x00A0;arguments-ptr:</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;&#x003E;&#x003E;STDARG-&#x003E;ptr,(nxt:</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;ptr&#x003C;</span><span 
class="ec-lmtt-10">&#x00A0;&#x003C;&#x003C;STDARG;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;$</span><span 
class="ec-lmtt-10">&#x00A0;no</span><span 
class="ec-lmtt-10">&#x00A0;more</span><span 
class="ec-lmtt-10">&#x00A0;argument</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;print</span><span 
class="ec-lmtt-10">&#x00A0;string+STDARG+ptr,</span><span 
class="ec-lmtt-10">&#x00A0;print</span><span 
class="ec-lmtt-10">&#x00A0;char+newline,</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;previous</span><span 
class="ec-lmtt-10">&#x00A0;string+STDARG+ptr,:nxt).</span>
</div>
<!--l. 2206--><p class="indent" >   The rule <span 
class="ec-lmtt-10">exit+n</span> terminates the program with exit code <span 
class="ec-lmtt-10">n</span>, see <a 
href="#x1-300004.19">Section 4.19<!--tex4ht:ref: subsec:exit --></a>. It can
be written equivalently as the <span 
class="cmss-10">terminator</span> <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">exit</span><span 
class="ec-lmtt-10">&#8217;n</span>.
The action <span 
class="ec-lmtt-10">msleep+n</span> suspends program execution (sleeps) for 
<span class="ec-lmtk">n</span> milliseconds.
<!--l. 2212--><p class="indent" >   The <span 
class="ec-lmtt-10">wait for+"xxx"</span> rule can be used to synchronize module initializations. The
root of each module is executed before the root of the main program is called. The
<span 
class="ec-lmtt-10">wait for+"xxx"</span> call checks whether all modules with name <span 
class="ec-lmtt-10">xxx</span> has finished
executing their roots. If yes, it returns immediately. If not, calls those roots and waits
until they return. For details see <a 
href="#x1-230004.12">Section 4.12<!--tex4ht:ref: subsec:root-rule --></a>.
<!--l. 2221--><p class="indent" >   If the <span 
class="cmss10">ALEPH </span>program is linked with the <span 
class="ec-lmtt-10">-g</span> switch, the rule <span 
class="ec-lmtt-10">backtrack</span> prints out
the complete call stack starting with the rule containing this call and ending with the
program root. Consult <a 
href="#x1-380004.27">Section 4.27<!--tex4ht:ref: subsec:debug --></a> from more details.
<!--l. 2237--><p class="indent" >   A lightweight, single word hash of a block of list elements is computed by the
library rules
  <!--l. 2240--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;&#8217;</span><span 
class="ec-lmtk-10">f</span><span 
class="ec-lmtt-10">&#8217;string</span><span 
class="ec-lmtt-10">&#x00A0;hash+t[]+&#x003E;p+hash&#x003E;.</span>
  <br /><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;&#8217;</span><span 
class="ec-lmtk-10">f</span><span 
class="ec-lmtt-10">&#8217;block</span><span 
class="ec-lmtt-10">&#x00A0;hash+t[]+&#x003E;p+hash&#x003E;.</span>
</div>
                                                                  

                                                                  
<!--l. 2244--><p class="noindent" >The first rule returns the hash of the string specified; the second rule computes the
hash of a block of words starting at the list element pointed by <span 
class="ec-lmtt-10">p</span> and ending at <span 
class="ec-lmtt-10">&#x003E;&#x003E;t</span>
(the last element of the list <span 
class="ec-lmtt-10">t</span>). This hash serves only as a tool to speed up
checking whether two strings or two blocks are the same when many such
comparisons should be made: they are definitely not equal if their hash is
different.
                                                                  

                                                                  
<!--l. 2256--><p class="indent" >
                                                                  

                                                                  
<!--l. 2256--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">7   </span> <a 
 id="x1-520007"></a>Intermediate code: Alice</h3>
<!--l. 2258--><p class="noindent" >The <span 
class="cmss10">ALEPH </span>compiler produces an intermediate code for each module while typically
reading several source files: the module source, the headers of required modules,
headers of user libraries and that of the standard library. These intermediate
codes are read, merged and linked by the linker which generates the final
target code.
<!--l. 2264--><p class="indent" >   The intermediate code is called <span 
class="cmss10">ALICE </span>in reminiscence of the machine
independent code designed for the first <span 
class="cmss10">ALEPH </span>compilers <span class="cite">[<a 
href="#Xgrune">3</a>]</span>. An <span 
class="cmss10">ALICE </span>file is a plain
text file. Lines starting with the dollar sign <span 
class="ec-lmtt-10">$</span> are comments and are skipped.
The file has four sections: a header, a list defining all items used in this
file, a data section, and finally a rule section. A tentative description of the
details is given below by a grammar-like description with many comments.
Grammar elements starting with <span 
class="cmss-10">D</span> refer either to a single character, like <span 
class="cmss-10">Dpoint</span>,
<span 
class="cmss-10">Dcolon</span>, <span 
class="cmss-10">Dstar</span> with their obvious interpretation, or to a keyword written with
apostrophe characters, like <span 
class="cmss-10">Dmain</span> or <span 
class="cmss-10">Drule</span> written as <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">main</span><span 
class="ec-lmtt-10">&#8217;</span> or <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">rule</span><span 
class="ec-lmtt-10">&#8217;</span>,
respectively.
<!--l. 2276--><div class="grammar" >
       <dl class="list1"><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2277--><p class="indent" >      <span 
class="cmss-10">alice file : header, item section, data section, rule section.</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2278--><p class="indent" >      <span 
class="cmss-10">header:</span>
   <!--l. 2280--><p class="indent2" >      <span 
class="cmss-10">(Dmain; Dmodule, module string), title string, target word size,</span>
   <!--l. 2282--><p class="indent2" >      <span 
class="cmss-10">(from line, end line, source string)</span><span 
class="cmss-10">*</span><span 
class="cmss-10">,</span>
   <!--l. 2284--><p class="indent2" >      <span 
class="cmss-10">Dpoint.</span></dd></dl>
</div>
<!--l. 2287--><p class="noindent" >The first non-comment line of the <span 
class="cmss10">ALICE </span>file starts with either <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">main</span><span 
class="ec-lmtt-10">&#8217;</span> or <span 
class="ec-lmtt-10">&#8217;</span><span 
class="ec-lmtk-10">module</span><span 
class="ec-lmtt-10">&#8217;</span>,
where the latter one is followed by the <span 
class="cmss-10">module string</span> which is the module name (as
specified by the <span 
class="ec-lmtt-10">module</span> pragmat) in quotation marks. It is followed by the title as
given by the <span 
class="ec-lmtt-10">title</span> pragmat, or <span 
class="ec-lmtt-10">"aleph"</span> if no title was specified. The target word
size is the number of bits in an <span 
class="cmss10">ALEPH </span>word, which is <span 
class="ec-lmtt-10">32</span> for this implementation.
The next block of three items each assigns file names to line numbers for determining
the location in an error or an warning message. Source lines are numbered
consecutively starting from one, not resetting when opening a new source. This list
contains, for each source file, the first and last number associated with that file.
This way the relative line number and corresponding file name appearing
in error and warning messages can be determined from the line number
only.
<!--l. 2303--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">7.1   </span> <a 
 id="x1-530007.1"></a>Alice item section</h4>
<!--l. 2305--><p class="noindent" >The <span 
class="cmss-10">item section</span> defines all identifiers appearing in this module, including imported,
exported, and the local ones. This section has the following structure:
                                                                  

<div class="grammar">                                                                  
       <dl class="list1"><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2309--><p class="indent" >      <span 
class="cmss-10">item section:</span>
   <!--l. 2311--><p class="indent2" >      <span 
class="cmss-10">(typer, item id, flags, lineno, type specific info, qualifier, tag)</span><span 
class="cmss-10">*</span><span 
class="cmss-10">, Dpoint .</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2312--><p class="indent" >      <span 
class="cmss-10">typer: </span>the type of the identifier (see below)<span 
class="cmss-10">.</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2313--><p class="indent" >      <span 
class="cmss-10">item id: </span>letter <span 
class="ec-lmtt-10">I </span>followed by a decimal number<span 
class="cmss-10">.</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2314--><p class="indent" >      <span 
class="cmss-10">flags: </span>an integer containing type specific flags<span 
class="cmss-10">.</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2315--><p class="indent" >      <span 
class="cmss-10">lineno: </span>the source line of the definition<span 
class="cmss-10">.</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2316--><p class="indent" >      <span 
class="cmss-10">type specific info: </span>see below, can be empty<span 
class="cmss-10">.</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2317--><p class="indent" >      <span 
class="cmss-10">qualifier: </span>qualifier in quotation marks, can be <span 
class="ec-lmtt-10">"" </span>(empty qualifier)<span 
class="cmss-10">.</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2319--><p class="indent" >      <span 
class="cmss-10">tag: </span>the identifier enclosed in quotation marks<span 
class="cmss-10">.</span></dd></dl></div>
<!--l. 2322--><p class="noindent" >The <span 
class="cmss-10">typer</span> is one of the non-formal types defined in the <span 
class="ec-lmtt-10">types.ale</span> module, written
between sharp brackets such as <span 
class="ec-lmtt-10">&#x003C;charfile&#x003E;</span>. <span 
class="cmss-10">Item id</span> specifies how this entry is
referred to in this <span 
class="cmss10">ALICE </span>file: it is the letter <span 
class="ec-lmtt-10">I</span> followed by an integer. The integer
starts at <span 
class="ec-lmtt-10">1</span> and <span 
class="cmti-10">must </span>increase by one for each item line in this section. The <span 
class="cmss-10">flags</span>
entry is a decimal number which gives the following flags (defined in module
<span 
class="ec-lmtt-10">tags.ale</span>:
<div class="grammar" 
>
<!--l. 2331--><p class="noindent" >
<div class="tabular"> <table id="TBL-3" class="tabular" 
 
><colgroup id="TBL-3-1g"><col 
id="TBL-3-1"><col 
id="TBL-3-2"></colgroup><tr  
 style="vertical-align:baseline;" id="TBL-3-1-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-1-1"  
class="td11"><span 
class="cmss-10">public</span>   </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-1-2"  
class="td11">set if the item is to be exported                          </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-2-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-2-1"  
class="td11"><span 
class="cmss-10">imported</span></td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-2-2"  
class="td11">set if the item is to be imported from other module</td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-3-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-3-1"  
class="td11"><span 
class="cmss-10">external</span> </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-3-2"  
class="td11">set if it is an external item                                 </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-4-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-4-1"  
class="td11"><span 
class="cmss-10">ruleflags</span> </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-4-2"  
class="td11">eight bits specifying rule type and special handling.</td></tr></table>
</div></div>
<!--l. 2338--><p class="indent" >   <span 
class="cmss-10">Lineno</span> is an integer which defines the source line of the item for error reporting.
<span 
class="cmss-10">Type specific info</span> gives additional information for lists (<span 
class="cmss-10">table</span>, <span 
class="cmss-10">stack</span>, and their static
versions) and <span 
class="cmss-10">rule</span>s. For lists this part consists of two integers: calibre (block size),
and the index of the standard selector (<span 
class="ec-lmtt-10">-1</span> if none, otherwise this number is
at least 1). For rules the <span 
class="cmss-10">type specific into</span> specifies the number of affixes
followed by the list of types of the formal affixes in the same syntax as the item
                                                                  

                                                                  
<span 
class="cmss-10">typer</span>s. For formal lists the typer is followed by two integers: the calibre (<span 
class="ec-lmtt-10">-1</span>
if no block was specified), and the standard selector (<span 
class="ec-lmtt-10">-1</span> for no standard
selector).
<!--l. 2349--><p class="indent" >   Finally both <span 
class="cmss-10">qualifier</span> and <span 
class="cmss-10">tag</span> are strings enclosed in quotation marks.
Exported and imported items are matched by their qualifier&#8211;tag pairs. For
each imported item there must be exactly one exported item in the other
modules.
<!--l. 2354--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">7.2   </span> <a 
 id="x1-540007.2"></a>Alice data section</h4>
<!--l. 2356--><p class="noindent" >The <span 
class="cmss-10">data section</span> of the <span 
class="cmss10">ALICE </span>file contains additional information for list and file
declarations, fillings, and contains the initial values for <span 
class="cmss-10">constant</span> and <span 
class="cmss-10">variable</span>
declarations.
<div class="grammar">
       <dl class="list1"><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2360--><p class="indent" >      <span 
class="cmss-10">data section: (data description)</span><span 
class="cmss-10">*</span><span 
class="cmss-10">.</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2361--><p class="indent" >      <span 
class="cmss-10">data description:</span>
   <!--l. 2363--><p class="indent2" >      <span 
class="cmss-10">Dlist, list definition, Dpoint;</span>
   <!--l. 2365--><p class="indent2" >      <span 
class="cmss-10">Dfile, file definition, Dpoint;</span>
   <!--l. 2367--><p class="indent2" >      <span 
class="cmss-10">Dexpression, expression, Dpoint;</span>
   <!--l. 2369--><p class="indent2" >      <span 
class="cmss-10">Dfill, filling, Dpoint;</span>
   <!--l. 2371--><p class="indent2" >      <span 
class="cmss-10">Dfront, string, Dpoint;</span>
   <!--l. 2373--><p class="indent2" >      <span 
class="cmss-10">Dback, string, Dpoint;</span>
   <!--l. 2375--><p class="indent2" >      <span 
class="cmss-10">Dexternal, item, string, Dpoint.</span></dd></dl></div>
<!--l. 2377--><p class="noindent" >A <span 
class="cmss-10">list definition</span> contains the size information for a stack or for a static stack in the
following format:
<div class="grammar">       <dl class="list1"><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2380--><p class="indent" >      <span 
class="cmss-10">list definition: item, est type, est size.</span></dd></dl></div>
<!--l. 2382--><p class="noindent" >The integer <span 
class="cmss-10">est type</span> is one of <span 
class="ec-lmtt-10">0</span>, <span 
class="ec-lmtt-10">1</span>, <span 
class="ec-lmtt-10">2</span>, <span 
class="ec-lmtt-10">3</span>, <span 
class="ec-lmtt-10">4</span> indicating that the size estimate for the list is
<span 
class="ec-lmtt-10">[]</span> (empty), <span 
class="ec-lmtt-10">[cons]</span>, <span 
class="ec-lmtt-10">[=cons=]</span>, <span 
class="ec-lmtt-10">[tag]</span>, or <span 
class="ec-lmtt-10">[=tag=]</span>, respectively. The <span 
class="cmss-10">est size</span> is either
a constant when <span 
class="cmss-10">etype</span> is <span 
class="ec-lmtt-10">0</span>, <span 
class="ec-lmtt-10">1</span> or <span 
class="ec-lmtt-10">2</span>, or is an <span 
class="cmss-10">item</span> otherwise.
<!--l. 2388--><p class="indent" >   A <span 
class="cmss-10">file definition</span> describes the lists in the file area (if present), the string after the <span 
class="ec-lmtt-10">=</span>
sign in the file declaration, and the direction of the file:
<div class="grammar">       <dl class="list1"><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2392--><p class="indent" >      <span 
class="cmss-10">file definition: item, direction, table item, pointer item, [file area].</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2395--><p class="indent" >      <span 
class="cmss-10">file area: Dsub, (list item)</span><span 
class="cmss-10">*</span><span 
class="cmss-10">, Dbus.</span></dd></dl></div>
                                                                  

                                                                  
<!--l. 2397--><p class="noindent" >The <span 
class="cmss-10">file area</span> part is optional, and is present only if it is a data file declaration specifying
lists. <span 
class="cmss-10">Direction</span> is one of <span 
class="ec-lmtt-10">0</span>, <span 
class="ec-lmtt-10">1</span>, <span 
class="ec-lmtt-10">2</span>, or <span 
class="ec-lmtt-10">3</span> describing whether the file is for input (<span 
class="ec-lmtt-10">1</span>),
output (<span 
class="ec-lmtt-10">2</span>), or both. The <span 
class="cmss-10">table item</span> is the item identifying the standard string table,
while the <span 
class="cmss-10">pointer item</span> is a pointer constant pointing to the corresponding string in
the standard string table. The optional <span 
class="cmss-10">file area</span> contains the list items in the order
they were given in the file declaration.
<!--l. 2408--><p class="indent" >   An <span 
class="cmss-10">expression</span> describes the defining expression of a <span 
class="cmss-10">constant</span> or a <span 
class="cmss-10">variable</span>
declaration.
<div class="grammar">       <dl class="list1"><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2411--><p class="indent" >      <span 
class="cmss-10">expression: item, expr.</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2412--><p class="indent" >      <span 
class="cmss-10">expr: target integer; item; expr, operator, expr; Dopen, expr, Dclose.</span></dd></dl></div>
<!--l. 2414--><p class="noindent" >An <span 
class="cmss-10">expression</span> typically consists of a single target integer, but it can be an arbitrary
expression, including parentheses, unary and binary operators (including virtual
lower and upper bound, calibre, arithmetic and boolean operations). A <span 
class="cmss-10">target integer</span>
starts with the letter <span 
class="ec-lmtt-10">X</span> followed by a signed decimal number in the range of the
target word size.
<!--l. 2422--><p class="indent" >   A <span 
class="cmss-10">filling</span> specifies the list fillings as specified in the module text. It follows
the complicated structure of fillings, and includes definitions of constant
pointers.
<div class="grammar">       <dl class="list1"><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2426--><p class="indent" >      <span 
class="cmss-10">filling: item, source line, (fill item, [repeater], initializer</span><span 
class="cmss-10">*</span><span 
class="cmss-10">)</span><span 
class="cmss-10">*</span><span 
class="cmss-10">, Dpoint.</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2428--><p class="indent" >      <span 
class="cmss-10">fill item: target integer; target string; item; compound fill.</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2429--><p class="indent" >      <span 
class="cmss-10">compound fill: Dopen, (target integer; item)</span><span 
class="cmss-10">*</span><span 
class="cmss-10">, Dclose.</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2430--><p class="indent" >      <span 
class="cmss-10">repeater: Dstar, (integer; item).</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2431--><p class="indent" >      <span 
class="cmss-10">initializer: Dcolon, item.</span></dd></dl></div>
<!--l. 2433--><p class="noindent" >All <span 
class="cmss-10">item</span>s in an <span 
class="cmss-10">initializer</span> are pointer constants, and they get their values after
all virtual addresses have been calculated. Consequently repeater values
cannot depend on pointer constants, and there is a strict limit on how large a
repeater can be. A <span 
class="cmss-10">target string</span> is a letter <span 
class="ec-lmtt-10">T</span> followed by a string denotation
between quotation marks, to be packed into an <span 
class="cmss10">ALEPH </span>string in the target
architecture.
                                                                  

                                                                  
<!--l. 2442--><p class="indent" >   The <span 
class="cmss-10">Dfront</span> and <span 
class="cmss-10">Dback</span> lines repeat the strings from the <span 
class="ec-lmtt-10">front matter</span> and <span 
class="ec-lmtt-10">back</span>
<span 
class="ec-lmtt-10">matter</span> pragmats. Finally, <span 
class="cmss-10">Dexternal</span> lines associate an external item with the string
specified in the external declaration of that item.
<!--l. 2447--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">7.3   </span> <a 
 id="x1-550007.3"></a>Alice rule section</h4>
<!--l. 2449--><p class="noindent" >The <span 
class="cmss-10">rule section</span> of the <span 
class="cmss10">ALEPH </span>file contains the compiled form of the rules defined in
the module. This section is a sequence of <span 
class="cmss-10">rule definition</span>s, and each such
definition consists of a head, followed by a sequence of <span 
class="cmss-10">node</span>s describing which
other rules are to be called, and at which node should the computation
continue.
<div class="grammar">       <dl class="list1"><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2455--><p class="indent" >      <span 
class="cmss-10">rule section: (rule definition, Dpoint)</span><span 
class="cmss-10">*</span><span 
class="cmss-10">.</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2456--><p class="indent" >      <span 
class="cmss-10">rule definition: rule head, (node definition, Dcomma)</span><span 
class="cmss-10">*</span><span 
class="cmss-10">.</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2457--><p class="indent" >      <span 
class="cmss-10">rule head: item, min local, max local, node count.</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2458--><p class="indent" >      <span 
class="cmss-10">node definition: call node; extension; classification.</span></dd></dl></div>
<!--l. 2460--><p class="noindent" >The <span 
class="cmss-10">item</span> in the <span 
class="cmss-10">rule head</span> is the rule name, it is followed by three integers. If the rule has
no local variables, then both <span 
class="cmss-10">min local</span> and <span 
class="cmss-10">max local</span> are zero. Otherwise local
variables of the rule are numbered from <span 
class="cmss-10">min local</span> to <span 
class="cmss-10">max local</span>, including bounds.
(Actually, if <span 
class="cmss-10">min local</span> is not zero, then it is one more than the total number of in,
out, and inout affixes of the rule.) Finally, <span 
class="cmss-10">node count</span> is the number of nodes
following the rule head.
<!--l. 2469--><p class="indent" >   In the rule body nodes are denoted as <span 
class="ec-lmtt-10">N1</span>, <span 
class="ec-lmtt-10">N2</span>, etc, where the number after <span 
class="ec-lmtt-10">N</span> goes
from <span 
class="ec-lmtt-10">1</span> until the node count inclusive. Local variables are denoted as <span 
class="ec-lmtt-10">Ld</span> where <span 
class="ec-lmtt-10">d</span> goes
from <span 
class="cmss-10">min local</span> to <span 
class="cmss-10">max local</span>. Finally, the formal variables are denoted as <span 
class="ec-lmtt-10">Fd</span> where <span 
class="ec-lmtt-10">F1</span>
is the first formal affix, and the number goes ahead until the number of the last
formal affix. Formal affixes are in a one-to-one correspondence of the rule type
description in the <span 
class="cmss-10">item section</span>.
<!--l. 2477--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">7.3.1   </span> <a 
 id="x1-560007.3.1"></a>Call nodes</h5>
<!--l. 2478--><p class="noindent" >A call node corresponds to a rule call and has the following format.
<div class="grammar">       <dl class="list1"><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2480--><p class="indent" >      <span 
class="cmss-10">call node: Dnode, node, item, C1, C2, C3, (affix)</span><span 
class="cmss-10">*</span><span 
class="cmss-10">, false node, true node.</span>
                                                                  

                                                                  
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2482--><p class="indent" >      <span 
class="cmss-10">false node: Dout, node label.</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2483--><p class="indent" >      <span 
class="cmss-10">true node: Dout, node label.</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2484--><p class="indent" >      <span 
class="cmss-10">node label: 0; -1; -2; node.</span></dd></dl></div>
<!--l. 2486--><p class="noindent" >The <span 
class="cmss-10">node</span> after the <span 
class="cmss-10">Dnode</span> symbol and in the <span 
class="cmss-10">node label</span> is a node identifier starting with
<span 
class="ec-lmtt-10">N</span>, followed by an integer. The <span 
class="cmss-10">item</span>, starting with <span 
class="ec-lmtt-10">I</span>, identifies the rule to be called. It
is followed by three integers <span 
class="cmss-10">C1</span>, <span 
class="cmss-10">C2</span>, and <span 
class="cmss-10">C3</span> giving information on the required
stack size when calling the rule; these numbers are discussed later. After the
description of the actual affixes the continuation is specified: <span 
class="cmss-10">false node</span> and
<span 
class="cmss-10">true node</span> identifies the nodes where the execution should continue when
the call returns false and true (fail and success), respectively. <span 
class="cmss-10">False node</span>
can be the number zero when the call cannot fail; it can be <span 
class="ec-lmtt-10">-1</span> denoting
true exit, and <span 
class="ec-lmtt-10">-2</span> for false exit from this rule. In other cases these are node
identifiers starting with <span 
class="ec-lmtt-10">N</span> followed by the node number. The <span 
class="cmss-10">true node</span> is never
zero.
<!--l. 2501--><p class="indent" >   The <span 
class="cmss-10">affix</span> part describes the actual affixes of the call.
<div class="grammar">       <dl class="list1"><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2503--><p class="indent" >      <span 
class="cmss-10">affix: target integer; item; formal; local; limit type, item;</span>
   <!--l. 2505--><p class="indent2" >      <span 
class="cmss-10">Ddummy; indexed affix; anchor; Danchor.</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2506--><p class="indent" >      <span 
class="cmss-10">limit type: Dupb; Dvup; Dlwb; Dvlwb; Dcalibre.</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2507--><p class="indent" >      <span 
class="cmss-10">indexed affix: Dsub, item, affix, Dbus, selector.</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2508--><p class="indent" >      <span 
class="cmss-10">anchor: Danchor, integer.</span></dd></dl></div>
<!--l. 2510--><p class="noindent" >A <span 
class="cmss-10">target integer</span> is a (signed) decimal integer starting with an <span 
class="ec-lmtt-10">X</span>. An <span 
class="cmss-10">item</span>, a <span 
class="cmss-10">formal</span> or a
<span 
class="cmss-10">local</span> start with the letter <span 
class="ec-lmtt-10">I</span>, <span 
class="ec-lmtt-10">F</span>, and <span 
class="ec-lmtt-10">L</span>, respectively, followed by an integer as discussed
above. When the actual affix is a limit, the <span 
class="cmss-10">item</span> following the <span 
class="cmss-10">limit type</span> is either a
global <span 
class="cmss-10">item</span>, or a <span 
class="cmss-10">formal</span> affix. Upper and lower bounds can be either dynamic or
static, see  <a 
href="#x1-240004.13">Section 4.13<!--tex4ht:ref: subsec:actual-virtual --></a>, as indicated by the different names. The <span 
class="cmss-10">Ddummy</span> symbol
indicates the <span 
class="cmss-10">dummy</span> actual affix meaning that the result in the corresponding
out affix can be discarded, see  <a 
href="#x1-160004.5">Section 4.5<!--tex4ht:ref: subsec:dummy --></a>. An <span 
class="cmss-10">indexed affix</span> describes an
indexing. The <span 
class="cmss-10">item</span> after the <span 
class="cmss-10">Dsub</span> symbol is either a global or formal list
which is to be indexed. The <span 
class="cmss-10">affix</span> gives the actual index (which can also be an
                                                                  

                                                                  
indexed affix), and <span 
class="cmss-10">selector</span> is an integer giving the offset within the indexed
block: for the rightmost element of the block it is 1, and it increases by
one.
<!--l. 2526--><p class="indent" >   A <span 
class="cmss-10">formal</span> or <span 
class="cmss-10">local</span> in the affix list might be preceded by a <span 
class="cmss-10">Dcolon</span> symbol. It signals
that in that affix the called rule returns a value which is not used later, thus the
caller can safely skip retrieving and storing that value.
<!--l. 2533--><p class="indent" >   If the called rule has a variable number of affixes, then an <span 
class="cmss-10">anchor</span> appears at the <span 
class="ec-lmtt-10">@</span>
affix position. The <span 
class="cmss-10">integer</span> after <span 
class="cmss-10">Danchor</span> specifies the number of the following <span 
class="cmti-10">affix</span>
<span 
class="cmti-10">blocks </span>(not the number of the affixes in those blocks) as provided by this rule call.
This number is strictly positive if the last actual affix in this call is <span 
class="cmti-10">not </span><span 
class="ec-lmtt-10">@</span>. If the last
actual affix is <span 
class="ec-lmtt-10">@</span>, then this number is the negative of the provided blocks (which, in
this case, can be zero); and only in this case is the last actual affix before the <span 
class="cmss-10">false</span>
<span 
class="cmss-10">node</span> a single <span 
class="cmss-10">Danchor</span>.
<!--l. 2545--><p class="indent" >   The constants <span 
class="cmss-10">C1</span>, <span 
class="cmss-10">C2</span>, and <span 
class="cmss-10">C3</span> for the called rule are computed as follows. If
the last actual affix of this call is <span 
class="cmti-10">not </span><span 
class="ec-lmtt-10">@</span>, then <span 
class="cmss-10">C3</span> is zero, <span 
class="cmss-10">C1</span> is the total
number of the actual affixes, and <span 
class="cmss-10">C2</span> is the number of those affixes which either
have type out or inout (they contain output values), or are in some repeat
block (independently of their types). If the last actual affix is <span 
class="ec-lmtt-10">@</span>, then <span 
class="cmss-10">C1</span> and
<span 
class="cmss-10">C2</span> are computed as before for affixes <span 
class="cmti-10">before </span>the anchor affix position (for
affixes which are not in the repeat blocks). The value of <span 
class="cmss-10">C3</span> is the actaul
number of affixes in the repeat blocks, except for the last actual affix <span 
class="ec-lmtt-10">@</span>.
Thus in this case <span 
class="ec-lmtt-10">C3</span> is zero exactly when the the only actual variable affix is
<span 
class="ec-lmtt-10">@</span>.
<!--l. 2557--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">7.3.2   </span> <a 
 id="x1-570007.3.2"></a>Extension nodes</h5>
<!--l. 2559--><p class="noindent" >An extension node tells that a (global or formal) stack should be extended by a
block, and specifies the content of the block.
<div class="grammar">       <dl class="list1"><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2562--><p class="indent" >      <span 
class="cmss-10">extension: Dextension, node, item, width, (field data)</span><span 
class="cmss-10">*</span><span 
class="cmss-10">, Dout, node.</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2563--><p class="indent" >      <span 
class="cmss-10">field data: affix, (Dto, offset)</span><span 
class="cmss-10">*</span><span 
class="cmss-10">.</span></dd></dl></div>
<!--l. 2565--><p class="noindent" >The <span 
class="cmss-10">node</span> after the <span 
class="cmss-10">Dextension</span> symbol is the node identifier; it starts with the letter <span 
class="ec-lmtt-10">N</span>
followed by an integer. The closing <span 
class="cmss-10">node</span> after the <span 
class="cmss-10">Dout</span> symbol is the next node,
which can be either <span 
class="ec-lmtt-10">-1</span> or another node identifier (since an extension cannot
fail). The <span 
class="cmss-10">item</span> is the (global or formal) stack to be extended, <span 
class="cmss-10">width</span> is an
integer giving the number of words in the extension block. The <span 
class="cmss-10">field data</span>
defines the content of the block: <span 
class="cmss-10">offset</span> is an integer between 1 and <span 
class="cmss-10">width</span>, and
each offset occurs exactly once. The same value, described by the <span 
class="cmss-10">affix</span> can
be stored at several offsets. The block content (the values of the <span 
class="cmss-10">affix</span>es in
the <span 
class="cmss-10">field data</span>) should be computed <span 
class="cmti-10">before </span>the upper limit of the stack is
                                                                  

                                                                  
adjusted.
<!--l. 2577--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">7.3.3   </span> <a 
 id="x1-580007.3.3"></a>Classification nodes</h5>
<!--l. 2579--><p class="noindent" >A classification node contains the affix in the classifier box together with all areas
and their destination nodes. While in an <span 
class="cmss10">ALEPH </span>program the classifier cannot be a
constant, due to macro substitution, the linker should be prepared for this case as
well.
<div class="grammar">       <dl class="list1"><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2584--><p class="indent" >      <span 
class="cmss-10">classification: Dbox, node, affix, (area description)</span><span 
class="cmss-10">*</span><span 
class="cmss-10">.</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2585--><p class="indent" >      <span 
class="cmss-10">area description: Darea, source line, zones, Dout, node.</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2586--><p class="indent" >      <span 
class="cmss-10">zones: zone, (Dsemicolon, zone)</span><span 
class="cmss-10">*</span><span 
class="cmss-10">.</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2587--><p class="indent" >      <span 
class="cmss-10">zone: list item; interval; value.</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2588--><p class="indent" >      <span 
class="cmss-10">interval: (value; ), Dcolon, (value; ).</span>
       </dd><dt class="list">
   </dt><dd 
class="list">
   <!--l. 2589--><p class="indent" >      <span 
class="cmss-10">value: constant item; target integer.</span></dd></dl></div>
<!--l. 2591--><p class="noindent" >The <span 
class="cmss-10">node</span> after the <span 
class="cmss-10">Dbox</span> symbol identifies the classification node. It is followed by the
affix specifying the classifier&#8217;s value. Each area starts with <span 
class="cmss-10">Darea</span> followed by the
source number of that area. This is specified for the potential messages when the area
cannot be selected. The area ends with the success destination node. The area is a
semicolon separated list of <span 
class="cmss-10">zone</span>s; the area succeeds if any of the zones succeeds. Each
<span 
class="cmss-10">zone</span> is either a (global) list item standing for its complete virtual address space, a
constant item, a target integer, or an <span 
class="cmss-10">interval</span> where both the lower and upper bound
may be missing.
<!--l. 2601--><p class="indent" >   After determining the constant values and the virtual limits of lists,
the linker checks that each area can be reached by some value of the <span 
class="cmss-10">affix</span>;
gives an error message if this is not the case. There is no &#8220;otherwise&#8221; part
of a classification. If none of the areas succeeds, then the program run is
aborted with an error message. The linker gives a warning if this might
happen.
                                                                  

                                                                  
<!--l. 2613--><p class="indent" >
                                                                  

                                                                  
<!--l. 2613--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">8   </span> <a 
 id="x1-590008"></a>Target code</h3>
<!--l. 2615--><p class="noindent" >The target code is produced exclusively by the <span 
class="cmss10">ALEPH </span>linker from the intermediate
<span 
class="cmss10">ALICE </span>code of the main program, modules, and standard library. In this
implementation the target code is standard <span 
class="cmss10">C</span>. It has been chosen as a <span 
class="cmss10">C </span>program can
be easily compiled into an executable binary, and <span 
class="cmss10">C </span>also provides the basic tools for
creating the running environment, memory management and minimal file transput
routines.
<!--l. 2622--><p class="indent" >   Code generation assumes that the basic <span 
class="cmss10">ALEPH </span>data type, the <span 
class="cmti-10">word </span>has 32
bits; it is translated to <span 
class="ec-lmtt-10">int</span> in <span 
class="cmss10">C</span>. Some efforts have been made to allow code
generation for a different word size architecture. In this respect two more issues
should also be addressed: what character encoding is used, and how strings
are represented in the target words. The details given here assume that
the target word size is 32 bit, and strings are packed into UTF-8 encoded
bytes. The present implementation makes no assumption on the size of <span 
class="cmss10">C</span>
pointers.
<!--l. 2631--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">8.1   </span> <a 
 id="x1-600008.1"></a>Tables, stacks</h4>
<!--l. 2633--><p class="noindent" >An <span 
class="cmss10">ALEPH </span><span 
class="cmss-10">table</span>, <span 
class="cmss-10">stack</span>, <span 
class="cmss-10">datafile</span> and <span 
class="cmss-10">charfile</span> is represented as an <span 
class="cmti-10">index </span>to a
global array called <span 
class="ec-lmtt-10">a</span><span 
class="ec-lmtt-10">_DATABLOCK</span>. This array is split into structures specific to
the required data type. Given the index <span 
class="ec-lmtt-10">idx</span> of this array, the <span 
class="cmss10">C </span>macros
<span 
class="ec-lmtt-10">to</span><span 
class="ec-lmtt-10">_LIST(idx)</span>, <span 
class="ec-lmtt-10">to</span><span 
class="ec-lmtt-10">_CHFILE(idx)</span> and <span 
class="ec-lmtt-10">to</span><span 
class="ec-lmtt-10">_DFILE(idx)</span> cast the pointer to
<span 
class="ec-lmtt-10">a</span><span 
class="ec-lmtt-10">_DATABLOCK[idx]</span> to a pointer to the corresponding list, character, or datafile
structure, respectively.
<!--l. 2641--><p class="indent" >   The <span 
class="cmss-10">table</span> and <span 
class="cmss-10">stack</span> structures have the following fields.
<!--l. 2646--><p class="noindent" >&#x00A0;&#x00A0;<span 
class="ec-lmtt-10 medsize">int *offset</span>   the zero address virtual element of the list
<!--l. 2648--><p class="noindent" >&#x00A0;&#x00A0;<span 
class="ec-lmtt-10 medsize">int *p</span>        pointer to the beginning of the allocated memory block
<!--l. 2650--><p class="noindent" >&#x00A0;&#x00A0;<span 
class="ec-lmtt-10 medsize">int length</span>    number of words in the allocated block
<!--l. 2652--><p class="noindent" >&#x00A0;&#x00A0;<span 
class="ec-lmtt-10 medsize">int alwb,aupb</span> actual lower and upper bounds
<!--l. 2654--><p class="noindent" >&#x00A0;&#x00A0;<span 
class="ec-lmtt-10 medsize">int vlwb,vupb</span> virtual lower and upper bounds
<!--l. 2656--><p class="noindent" >&#x00A0;&#x00A0;<span 
class="ec-lmtt-10 medsize">int calibre</span>   calibre of the list
<!--l. 2660--><p class="noindent" >The <span 
class="cmss10">ALEPH </span>list element <span 
class="ec-lmtt-10">L[idx]</span> using the virtual address <span 
class="ec-lmtt-10">idx</span> (which points to the
<span 
class="cmti-10">virtual </span>address space of <span 
class="ec-lmtt-10">L</span>) is translated to the <span 
class="cmss10">C </span>construct <span 
class="ec-lmtt-10">to</span><span 
class="ec-lmtt-10">_LIST(L)-&#x003E;</span>
<span 
class="ec-lmtt-10">offset[idx]</span>. List limits (actual and virtual limits and calibre) are retrieved from
this structure. There are no direct pointers to list elements in the program, thus a list
can be moved freely in the memory as long as the pointers <span 
class="ec-lmtt-10">offset</span> and <span 
class="ec-lmtt-10">p</span> are adjusted
properly.
<!--l. 2669--><p class="indent" >   The <span 
class="ec-lmtt-10">unstack</span> and <span 
class="ec-lmtt-10">unstack to</span> externals adjust the actual upper bound only. The
<span 
class="ec-lmtt-10">release</span> external actually frees the complete allocated memory, while <span 
class="ec-lmtt-10">scratch</span>
only sets the actual upper bound to its lowest possible value but keeps the
allocated memory. The <span 
class="ec-lmtt-10">request space+L+n</span> external checks that there are at
least <span 
class="ec-lmtt-10">n</span> additional allocated words above the actual upper bound of <span 
class="ec-lmtt-10">L</span>, and if
not, then it allocates additional memory. This may result in moving the
                                                                  

                                                                  
whole list to somewhere else in the actual memory, when <span 
class="ec-lmtt-10">offset</span> is adjusted
accordingly.
<!--l. 2678--><p class="indent" >   When a stack is to be extended by a block of <span 
class="ec-lmtt-10">n</span> words in an <span 
class="cmss-10">extension</span>, the <span 
class="cmss10">C</span>
routine <span 
class="ec-lmtt-10">a</span><span 
class="ec-lmtt-10">_extend(L,n)</span> is called first. This routine makes sure that <span 
class="ec-lmtt-10">L</span> has an
additional <span 
class="ec-lmtt-10">n</span> words of free space at the top (by calling <span 
class="ec-lmtt-10">request space</span>), and,
additionally, returns the address of the first free slot at the top of <span 
class="ec-lmtt-10">L</span>. Subsequently the
free block is filled by assigning values to <span 
class="ec-lmtt-10">B[0]</span> to <span 
class="ec-lmtt-10">B[n-1]</span> where <span 
class="ec-lmtt-10">B</span> is the address
returned by <span 
class="ec-lmtt-10">a</span><span 
class="ec-lmtt-10">_extend</span>. Finally, the actual upper bound of <span 
class="ec-lmtt-10">L</span> is increased by
<span 
class="ec-lmtt-10">n</span>.
<!--l. 2688--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">8.2   </span> <a 
 id="x1-610008.2"></a>Data file</h4>
<!--l. 2690--><p class="noindent" >As discussed in <a 
href="#x1-310004.20">Section 4.20<!--tex4ht:ref: subsec:datafiles --></a>, an <span 
class="cmss10">ALEPH </span>datafile stores integers (words), and pointers
to lists. Such a datafile is realized as a sequence of blocks of size <span 
class="ec-lmtt-10">1024*sizeof(int)</span>,
and each block <span 
class="ec-lmtt-10">B[0..1023]</span> is arranged as follows.
<!--l. 2700--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">B[0]</span>           magic number, identifying the <span 
class="cmss10">ALEPH </span>datafile,
<!--l. 2702--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">B[1..31]</span>       bitmap for the rest of this block,
<!--l. 2704--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">B[32..1023]</span>    actual data.
<!--l. 2708--><p class="noindent" >In the bitmap part there is a single indicator bit for each word of the block at index
32 <span 
class="cmsy-10">&#x2264;</span> <span 
class="ec-lmtt-10">i</span> <span 
class="cmsy-10">&#x2264; </span>1023. This bit is at word <span 
class="ec-lmtt-10">B[int(i/32)]</span> and bit position <span 
class="ec-lmtt-10">(i&amp;31)</span> where zero
is the most significant bit and 31 is the least significant bit. The <span 
class="ec-lmtt-10">nil</span> pointer is a
pointer with relative value zero; the <span 
class="ec-lmtt-10">eof</span> (end of file) indicator is a pointer with
relative value <span 
class="cmsy-10">-</span>1; all other pointer values must be positive and belong to one of the
datafile zones.
<!--l. 2718--><p class="indent" >   The first few data values in the first block of the datafile contain the
<span 
class="cmti-10">zone list</span>. Each zone occupies three words: virtual lower and upper bounds,
and the numerical position of the list. The size of the list is in <span 
class="ec-lmtt-10">B[32]</span>, data
for the first zone is in <span 
class="ec-lmtt-10">B[33]</span>, <span 
class="ec-lmtt-10">B[34]</span>, <span 
class="ec-lmtt-10">B[35]</span>, followed by data for the other
zones. The list must fit into the first data block. The lower and upper bounds
(inclusive) are strictly increasing (thus these ranges are disjoint and positive),
therefore all pointer values, with the exception of <span 
class="ec-lmtt-10">nil</span> and <span 
class="ec-lmtt-10">eof</span>, must be
positive.
<!--l. 2728--><p class="indent" >   Items in a datafile have positional data. The last 10 bits in this file position
identify the index within the block; this value must be between 32 and 1023. Other
bits of the position identify the block in which the actual value can be found. This
file position is stored internally, thus there is no overhead in determining it. The file
position can be retrieved for both input and output datafiles, but one can only set
the position for an opened input datafile. No check is made to make sure that the
position is valid (so it can be set after the <span 
class="ec-lmtt-10">eof</span> indicator). Since a word contains 4
bytes and this address must be positive, an <span 
class="cmss10">ALEPH </span>datafile cannot be larger than
about 8 Gbytes.
<!--l. 2739--><p class="indent" >   When opening a datafile for output, the first block is created with the specified
zones sorted according to their virtual address ranges; the file pointer is set just
before the very first empty space.
                                                                  

                                                                  
<!--l. 2743--><p class="indent" >   Appending to an existing <span 
class="cmss10">ALEPH </span>datafile is not implemented as it raises
several problems. The first block should be read and checked if it has the
same metainformation as the current file declaration requires, position it to
the last block, find the <span 
class="ec-lmtt-10">eof</span> mark, then set the file position just at the <span 
class="ec-lmtt-10">eof</span>
mark.
<!--l. 2749--><p class="indent" >   Opening a datafile for input requires the following operations: read the first
block, compare the zones in the input file to the ones supplied by the file
declaration. Comparison is made by the order of the lists in the corresponding
declarations. When the next input is requested, it is checked whether it is a pointer
or not. If it is numerical, pass as it is. If it is a pointer, check which list
it is in, add the correction difference and pass it as a pointer. Handle <span 
class="ec-lmtt-10">nil</span>
and <span 
class="ec-lmtt-10">eof</span> separately. If the zone is not found (the corresponding list was not
supplied when opening the datafile), then fail and skip this input. This error
condition can be retrieved from the <span 
class="ec-lmtt-10">file error</span> associated with the <span 
class="cmss10">ALEPH</span>
<span 
class="cmss-10">file</span>.
<!--l. 2760--><p class="indent" >   The datafile structure stored in <span 
class="ec-lmtt-10">a</span><span 
class="ec-lmtt-10">_DATABLOCK</span> has the following fields:
<!--l. 2766--><p class="noindent" >  &#x00A0;<span 
class="ec-lmtt-10 medsize">unsigned fflag</span>          different flag bits
<!--l. 2768--><p class="noindent" >  &#x00A0;<span 
class="ec-lmtt-10 medsize">int      fileError</span>      last file error
<!--l. 2770--><p class="noindent" >  &#x00A0;<span 
class="ec-lmtt-10 medsize">int      st1,st2</span>        string pointers
<!--l. 2772--><p class="noindent" >  &#x00A0;<span 
class="ec-lmtt-10 medsize">int      fhandle</span>        handle, zero if not opened
<!--l. 2774--><p class="noindent" >  &#x00A0;<span 
class="ec-lmtt-10 medsize">int      fpos</span>           file position
<!--l. 2776--><p class="noindent" >  &#x00A0;<span 
class="ec-lmtt-10 medsize">unsigned iflag</span>          pointer/numerical flag for 32 words
<!--l. 2778--><p class="noindent" >  &#x00A0;<span 
class="ec-lmtt-10 medsize">int inarea,outarea</span>      number of areas
<!--l. 2780--><p class="noindent" >  &#x00A0;<span 
class="ec-lmtt-10">a</span><span 
class="ec-lmtt-10">_AREA  in[MAXIMAL</span><span 
class="ec-lmtt-10">_AREA]</span> &nbsp; input list areas
<!--l. 2782--><p class="noindent" >  &#x00A0;<span 
class="ec-lmtt-10">a</span><span 
class="ec-lmtt-10">_AREA out[MAXIMAL</span><span 
class="ec-lmtt-10">_AREA]</span> &nbsp; output list areas
<!--l. 2784--><p class="noindent" >  &#x00A0;<span 
class="ec-lmtt-10 medsize">int      buffer[1024]</span>   the buffer
<!--l. 2788--><p class="noindent" >The string pointers <span 
class="ec-lmtt-10">st1</span> and <span 
class="ec-lmtt-10">st2</span> identify the string supplied by the file declaration.
This string is used as a file name when the file is used without explicitly
opening.
<!--l. 2793--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">8.3   </span> <a 
 id="x1-620008.3"></a>Character file</h4>
<!--l. 2795--><p class="noindent" >While datafiles use direct file input and output, character files use streams, namely
the <span 
class="ec-lmtt-10">fgetc()</span> and <span 
class="ec-lmtt-10">fputc()</span> <span 
class="cmss10">C</span> library procedures without the <span 
class="ec-lmtt-10">ungetc()</span> facility. The
input is assumed to be proper UTF-8 encoded file, incorrect codes are silently
ignored. The <span 
class="cmss10">ALEPH </span>rule <span 
class="ec-lmtt-10">get char</span> may consume up to four bytes from the input
stream. There is no <span 
class="ec-lmtt-10">newpage</span> character, and writing <span 
class="ec-lmtt-10">newline</span> sends the newline
character (code 10) to the stream.
<!--l. 2803--><p class="indent" >   Input character files can be positioned as well, but they use <span 
class="ec-lmtt-10">ftell()</span> to retrieve
the current file position and <span 
class="ec-lmtt-10">fseek()</span> to set the file position.
<!--l. 2807--><p class="indent" >   The charfile structure in <span 
class="ec-lmtt-10">a</span><span 
class="ec-lmtt-10">_DATABLOCK</span> has the following fields:
<!--l. 2810--><p class="noindent" >  &#x00A0;<span 
class="ec-lmtt-10 medsize">unsigned fflag</span>          different flag bits
<!--l. 2812--><p class="noindent" >  &#x00A0;<span 
class="ec-lmtt-10 medsize">int      fileError</span>      last file error
                                                                  

                                                                  
<!--l. 2814--><p class="noindent" >  &#x00A0;<span 
class="ec-lmtt-10 medsize">int      st1,st2</span>        string pointers
<!--l. 2816--><p class="noindent" >  &#x00A0;<span 
class="ec-lmtt-10 medsize">FILE     *f</span>             stream handle, <span 
class="ec-lmtt-10">NULL</span> if not opened
<!--l. 2818--><p class="noindent" >  &#x00A0;<span 
class="ec-lmtt-10 medsize">int      aheadchar</span>      look ahead character
<!--l. 2822--><p class="noindent" >The <span 
class="ec-lmtt-10">aheadchar</span> stores the next (unread) UTF-8 character when a look-ahead was
made. This happens, for example, when an integer is read from the file by the
standard rule <span 
class="ec-lmtt-10">get int</span>. This rule should stop at the first non-digit character, but not
consume that character.
<!--l. 2828--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">8.4   </span> <a 
 id="x1-630008.4"></a>Strings</h4>
<!--l. 2830--><p class="noindent" ><span 
class="cmss10">ALEPH </span>strings use Unicode characters, and they are stored using UTF-8 encoding as
<span 
class="cmss10">C </span>strings with <span 
class="ec-lmtt-10">\0</span> as the last byte. If the string is in list <span 
class="ec-lmtt-10">L</span> pointed by the (virtual)
index <span 
class="ec-lmtt-10">idx</span>, then the content of the list block is
<!--l. 2839--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">L[idx]</span>         width (calibre) of this block in words
<!--l. 2841--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">L[idx-1]</span>       number of UTF-8 encoded characters in the string
<!--l. 2843--><p class="noindent" >  <span 
class="ec-lmtt-10 medsize">L[idx+1-width]</span> start of the <span 
class="cmss10">C </span>string
<!--l. 2846--><p class="noindent" >The empty string is stored as a block of <span 
class="ec-lmtt-10">(0,0,3)</span>.
<!--l. 2849--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">8.5   </span> <a 
 id="x1-640008.5"></a>Rules in <span 
class="cmss10">C</span></h4>
<!--l. 2851--><p class="noindent" >Each rule declaration is translated to a <span 
class="cmss10">C </span>procedure declaration. If the rule is of type
<span 
class="cmti-10">function</span>, <span 
class="cmti-10">action</span>, or <span 
class="cmti-10">exit</span>, then the procedure is <span 
class="ec-lmtt-10">void</span>; if it is a <span 
class="cmti-10">question </span>or <span 
class="cmti-10">predicate</span>,
then it is <span 
class="ec-lmtt-10">int</span>. The compiled <span 
class="cmss10">C </span>routine returns <span 
class="ec-lmtt-10">0</span> for failure and <span 
class="ec-lmtt-10">1</span> for success, but
when checking the returned value, any non-zero return value is taken for
success.
<!--l. 2858--><p class="indent" >   In <span 
class="cmss10">ALEPH </span>it is the caller&#8217;s responsibility to store the output value in its
destination, and do it only if the called routine reports success. According to this
requirement, <span 
class="cmss-10">formal affix</span>es are transformed into <span 
class="cmss10">C </span>parameters as follows. First,
assume that the called rule has no variable affix block. Affixes which are neither
<span 
class="cmss-10">out</span> nor <span 
class="cmss-10">inout</span> ones (that is, <span 
class="cmss-10">file</span>, <span 
class="cmss-10">stack</span>, <span 
class="cmss-10">table</span>, or <span 
class="cmss-10">in</span>) are passed as integers in
their original order. A local integer array is declared for the <span 
class="cmss-10">out</span> and <span 
class="cmss-10">inout</span>
affixes, and this array, containing the value of these affixes in their original
order, is passed as the last parameter. Before returning, the called routine
supplies the output values in this array, which values are then stored by the
caller.
<!--l. 2870--><p class="indent" >   Rules with a variable affix block have two additional parameters: an integer
containing the number of blocks (with a value of at least one), and an integer array
containing all affixes in the variable block regardless of their types. The
<span 
class="ec-lmtt-10">shift affix block</span> rule is implemented by decreasing the block counter
by one, and adding the block length to the last parameter. The following
table shows some <span 
class="cmss-10">formal affix sequence</span>s and the corresponding <span 
class="cmss10">C </span>parameter
declarations:
                                                                  

                                                                  
   <div class="tabular"> <table id="TBL-4" class="tabular" 
 
><colgroup id="TBL-4-1g"><col 
id="TBL-4-1"><col 
id="TBL-4-2"></colgroup><tr  
 style="vertical-align:baseline;" id="TBL-4-1-"><td  style="white-space:nowrap; text-align:left;" id="TBL-4-1-1"  
class="td11"><span 
class="ec-lmtt-10">+t[]+&#x003E;i</span>  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-1-2"  
class="td11"><span 
class="ec-lmtt-10">(int t,int i)</span>            </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-4-2-"><td  style="white-space:nowrap; text-align:left;" id="TBL-4-2-1"  
class="td11"><span 
class="ec-lmtt-10">+""f+o&#x003E;</span>   </td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-2-2"  
class="td11"><span 
class="ec-lmtt-10">(int f,int A[1])</span>         </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-4-3-"><td  style="white-space:nowrap; text-align:left;" id="TBL-4-3-1"  
class="td11"><span 
class="ec-lmtt-10">+&#x003E;io&#x003E;+o&#x003E;</span>  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-3-2"  
class="td11"><span 
class="ec-lmtt-10">(int A[2])</span>               </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-4-4-"><td  style="white-space:nowrap; text-align:left;" id="TBL-4-4-1"  
class="td11"><span 
class="ec-lmtt-10">+&#x003E;io&#x003E;+@+&#x003E;i</span></td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-4-2"  
class="td11"><span 
class="ec-lmtt-10">(int A[1],int Cnt,int *V)</span></td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-4-5-"><td  style="white-space:nowrap; text-align:left;" id="TBL-4-5-1"  
class="td11">          </td> </tr></table></div>
<!--l. 2888--><p class="noindent" >The called routine must set all out affixes in the output parameter <span 
class="ec-lmtt-10">A[]</span>, otherwise it
is free to change (and use) these values if the routine fails. In the variable block <span 
class="ec-lmtt-10">V[]</span>,
however, values corresponding to not out or inout affixes cannot be changed, and
the value of an inout affix should change only if the routine returns with
success.
<!--l. 2896--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">8.6   </span> <a 
 id="x1-650008.6"></a>Externals</h4>
<!--l. 2898--><p class="noindent" >External declarations are allowed in library mode only (see  <a 
href="#x1-360004.25">Section 4.25<!--tex4ht:ref: subsec:library --></a>). The
interpretation of the <span 
class="cmss-10">string denotation</span> in the external declaration depends on the type
of the defined tag.
<!--l. 2902--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">8.6.1   </span> <a 
 id="x1-660008.6.1"></a>External constant and variable</h5>
<!--l. 2904--><p class="noindent" >External constants cannot be used in expressions or other places where a
constant tag is required. External variables and constants can appear as rule
parameters; in the <span 
class="cmss10">C </span>code they are replaced by the string specified in the <span 
class="cmss-10">external</span>
<span 
class="cmss-10">declaration</span>.
<!--l. 2909--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">8.6.2   </span> <a 
 id="x1-670008.6.2"></a>External table and stack</h5>
<!--l. 2911--><p class="noindent" >A list structure is reserved in the global integer array <span 
class="ec-lmtt-10">a</span><span 
class="ec-lmtt-10">_DATABLOCK</span> as explained in
 <a 
href="#x1-600008.1">Section 8.1<!--tex4ht:ref: subsec:tables-stacks --></a>. The string in the external declaration is used as the name of a <span 
class="cmss10">C</span>
procedure which is responsible for initializing this structure. The routine is called
with three arguments: the index of the associated structure, a constant string with
the name of the list, and the calibre. The routine must fill in this structure
the actual and virtual limits as well as the calibre. There is a (relatively
small) virtual address space set aside for external lists. The first free virtual
address is in <span 
class="ec-lmtt-10">a</span><span 
class="ec-lmtt-10">_extlist</span><span 
class="ec-lmtt-10">_virtual</span>; the address can go up to <span 
class="ec-lmtt-10">max int</span>. The
routine should update this value to reflect its reservation. The routine is also
responsible for allocating memory and initializing the content of external
tables.
<!--l. 2924--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">8.6.3   </span> <a 
 id="x1-680008.6.3"></a>External files</h5>
<!--l. 2926--><p class="noindent" >The corresponding charfile or datafile structure is reserved in the global array
<span 
class="ec-lmtt-10">a</span><span 
class="ec-lmtt-10">_DATABLOCK</span>. For the description see <a 
href="#x1-610008.2">Section 8.2<!--tex4ht:ref: subsec:datafile-implement --></a> and <a 
href="#x1-620008.3">Section 8.3<!--tex4ht:ref: subsec:charfile --></a>. The string in the external
                                                                  

                                                                  
declaration is used as the name of a <span 
class="cmss10">C </span>procedure which is responsible for initializing
the structure. The procedure is called with two arguments: the index of the structure
and the name as a character string.
<!--l. 2934--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">8.7   </span> <a 
 id="x1-690008.7"></a>Assignment</h4>
<!--l. 2936--><p class="noindent" >An <span 
class="cmss10">ALEPH </span><span 
class="cmss-10">transput</span> has strict semantics: it is evaluated from left to right using the
newly assigned values when necessary. The <span 
class="cmss-10">transput</span>
  <!--l. 2938--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#x003E;&#x003E;ST</span><span 
class="ec-lmtt-10">&#x00A0;-&#x003E;</span><span 
class="ec-lmtt-10">&#x00A0;n</span><span 
class="ec-lmtt-10">&#x00A0;-&#x003E;</span><span 
class="ec-lmtt-10">&#x00A0;ST[n]</span></div>
<!--l. 2942--><p class="noindent" >sets first <span 
class="ec-lmtt-10">n</span> to the address of the top of the stack <span 
class="ec-lmtt-10">ST</span>, and then stores this value at the
top element of <span 
class="ec-lmtt-10">ST</span>, using the newly assigned value of <span 
class="ec-lmtt-10">n</span>. The semantics of the
corresponding <span 
class="cmss10">C </span>construct <span 
class="ec-lmtt-10">ST-&#x003E;offs[n]=(n=ST-&#x003E;upb)</span> is <span 
class="cmti-10">undefined </span>as the <span 
class="cmss10">C </span>compiler
is free to choose the order in which the two sides of the assigment are evaluated. It
can compute first the address of <span 
class="ec-lmtt-10">ST[n]</span>, and then execute the assignment to <span 
class="ec-lmtt-10">n</span>, or the
other way around. To avoid the ambiguity, the <span 
class="cmss10">ALEPH </span>compiler generates
successive <span 
class="cmss10">C </span>assignments, storing the source in a temporary place when any of
the destinations is indexed. The genereted <span 
class="cmss10">C </span>code for the above example
is
  <!--l. 2954--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">{int</span><span 
class="ec-lmtt-10">&#x00A0;tmp=ST-&#x003E;upb;</span><span 
class="ec-lmtt-10">&#x00A0;n=tmp;</span><span 
class="ec-lmtt-10">&#x00A0;ST-&#x003E;offs[n]=tmp;}</span>
</div>
<!--l. 2959--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">8.7.1   </span> <a 
 id="x1-700008.7.1"></a>External rules</h5>
<!--l. 2961--><p class="noindent" >How an external rule is handled depends on the <span 
class="cmss-10">string denotation</span>. If it starts with a
(lower or upper case) letter, then the external rule is assumed to be a <span 
class="cmss10">C </span>procedure
with exactly the same parameter passing mechanism as the compiled rules,
see  <a 
href="#x1-640008.5">Section 8.5<!--tex4ht:ref: subsec:c-rules --></a>. There must be a header file providing the prototypes of
these external procedures, it can be added to the generated code using a
<span 
class="ec-lmtt-10">front matter</span> pragmat. Several standard library rules are implemented this
way.
<!--l. 2969--><p class="indent" >   If the first character in the <span 
class="cmss-10">string denotation</span> of the external rule is an underscore
<span 
class="ec-lmtt-10">_</span>, then another calling mechanism is used: all affixes, independently of their types,
are passed as parameters. Such external rules are typically defined as <span 
class="cmss10">C </span>macros; an
example is the <span 
class="ec-lmtt-10">incr+&#x003E;x&#x003E;</span> external rule whose <span 
class="cmss-10">string denotation</span> is <span 
class="ec-lmtt-10">_a</span><span 
class="ec-lmtt-10">_incr</span>. The
<span 
class="cmss10">ALEPH </span>rule call <span 
class="ec-lmtt-10">incr+ptr</span> translates to <span 
class="ec-lmtt-10">a</span><span 
class="ec-lmtt-10">_incr(ptr)</span>. The standard library header
file contains the <span 
class="cmss10">C </span>macro definition
  <!--l. 2978--><p class="noindent" ><div class="obeylines-v">
  <span 
class="ec-lmtt-10">&#x00A0;#define</span><span 
class="ec-lmtt-10">&#x00A0;a</span><span 
class="ec-lmtt-10">_incr(x)</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;</span><span 
class="ec-lmtt-10">&#x00A0;x++</span></div>
<!--l. 2981--><p class="noindent" >which makes the final translation.
<!--l. 2984--><p class="indent" >   The <span 
class="cmss-10">dummy affix</span> <span 
class="ec-lmtt-10">#</span> translates to nothing, thus it leaves an empty parameter
location. Using some <span 
class="cmss10">C </span>preprocessor tricks these empty arguments can be
transformed to different <span 
class="cmss10">C </span>procedure calls. To ease this work, the <span 
class="cmss10">ALEPH </span>compiler
                                                                  

                                                                  
does some additional work. If the <span 
class="cmss-10">string denotation</span> of the external rule starts with a
<span 
class="ec-lmtt-10">@</span>, then this character is discarded. For each out argument, depending on whether it
is the <span 
class="cmss-10">dummy symbol</span> or not, a <span 
class="ec-lmtt-10">0</span> or a <span 
class="ec-lmtt-10">1</span> character is appended to the remaining string.
Finally, <span 
class="cmss-10">dummy symbol</span>s are discarded from the argument list. In the standard library
the external rule <span 
class="ec-lmtt-10">divrem</span> has two out affixes, and its <span 
class="cmss-10">string denotation</span> is
<span 
class="ec-lmtt-10">@a</span>_<span 
class="ec-lmtt-10">divrem</span>. Accordingly, four <span 
class="cmss10">C </span>calls could be generated: <span 
class="ec-lmtt-10">a</span><span 
class="ec-lmtt-10">_divrem11</span> with
four parameters when both the quotient and remainder is used, the three
parameter <span 
class="ec-lmtt-10">a</span><span 
class="ec-lmtt-10">_divrem01</span> and <span 
class="ec-lmtt-10">a</span><span 
class="ec-lmtt-10">_divrem10</span> when the quotient or remainder is
discarded; and the two parameter <span 
class="ec-lmtt-10">a</span><span 
class="ec-lmtt-10">_divrem00</span> when no result is requested at
all.
<!--l. 2999--><p class="indent" >   The external rule strings <span 
class="ec-lmtt-10">@@make</span> and <span 
class="ec-lmtt-10">@@waitfor</span> are exceptions; these rules are
handled internally by the linker when generating code for transput (<a 
href="#x1-690008.7">Section 8.7<!--tex4ht:ref: subsec:assignment --></a>) and
for the <span 
class="ec-lmtt-10">wait for</span> rule.
<!--l. 3003--><p class="indent" >   If all out arguments of a function are discarded, then the rule is not called at all.
Similarly, if the returned value of a question is not used, then the question is not
called. It might cause problems when the function or the question performs some
conditional tasks before calling an <span 
class="cmss-10">exit</span> rule (<a 
href="#x1-300004.19">Section 4.19<!--tex4ht:ref: subsec:exit --></a>), as those checks will not be
carried over.
                                                                  

                                                                  
<!--l. 3013--><p class="indent" >
                                                                  

                                                                  
<!--l. 3013--><p class="noindent" >
   <h3 class="likesectionHead"><a 
 id="x1-710008.7.1"></a>References</h3>
<!--l. 3013--><p class="noindent" >
    <div class="thebibliography">
    <p class="bibitem" ><span class="biblabel">
  [1]<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span><a 
 id="Xaho-ullman"></a>A.V.  Aho,  J.D.  Ullman,  <span 
class="cmti-10">Principles  of  Compiler  Design  </span>Sseries  in
    computer science and information processing, Addison-Wesley, 1977
    </p>
    <p class="bibitem" ><span class="biblabel">
  [2]<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span><a 
 id="XA-manual"></a>D.Grune,   R.   Bosch,   L.G.L.T.Meertens,   <span 
class="cmti-10">ALEPH   Manual   </span>CWI,
    IW17/74, Stichting Mathematisch Centrum, Amsterdam, Fourth printing,
    1982
    </p>
    <p class="bibitem" ><span class="biblabel">
  [3]<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span><a 
 id="Xgrune"></a>D.Grune,  <span 
class="cmti-10">On  the  design  of  ALEPH</span>,  CWI  Tract  13,  Centre  for
    Mathematics and Computer Science, Amsterdam, 1982
    </p>
    <p class="bibitem" ><span class="biblabel">
  [4]<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span><a 
 id="Xkoster1"></a>C.H.A.Koster,   <span 
class="cmti-10">A   Compiler   Compiler</span>,   CWI   Report   MR127/71,
    Mathematical Centre, Amsterdam, 1971
    </p>
    <p class="bibitem" ><span class="biblabel">
  [5]<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span><a 
 id="Xkoster2"></a>C.H.A.Koster,  <span 
class="cmti-10">Affix  Grammars</span>,  in:  J.E.L.Peck  (Ed.),  <span 
class="cmti-10">ALGOL  68</span>
    <span 
class="cmti-10">Implementation</span>, North Holland, Amsterdam, 1971
    </p>
    <p class="bibitem" ><span class="biblabel">
  [6]<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span><a 
 id="Xkoster3"></a>C.H.A.Koster,  <span 
class="cmti-10">Using  the  CDL  compiler</span>,  in  F.L.Bauer  and  J.Eickel
    (Eds.) <span 
class="cmti-10">Compiler Constructions </span>LNCS 21, Springer, 1974
    </p>
    <p class="bibitem" ><span class="biblabel">
  [7]<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span>
    <a 
 id="Xcdl3"></a>C.H.A.Koster, J.G.Beney, P.A.Jones, M.Seutter, <span 
class="cmti-10">CDL3 manual</span>, available
    as     <a 
href="https://ftp.science.ru.nl/cdl3/cdl3-manual-1.2.7.pdf" class="url" ><span 
class="cmtt-10">https://ftp.science.ru.nl/cdl3/cdl3-manual-1.2.7.pdf</span></a>
    </p>
    <p class="bibitem" ><span class="biblabel">
  [8]<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span><a 
 id="Xwijn"></a>A.van  Wijngaardeen,  <span 
class="cmti-10">The  generative  power  of  two-level  grammars</span>,
    in  J.Loecks  (Rd.),  <span 
class="cmti-10">Automata,  Languages  and  Programming</span>,  LNCS  14,
    Springer, 1974
                                                                  

                                                                  
    </p>
    <p class="bibitem" ><span class="biblabel">
  [9]<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span><a 
 id="Xa68"></a>A.van  Wijngaarden,  B.J.  Mailloux,  J.E.L.  Peck,  C.H.A.  Koster,  M.
    Sintzoff, C.H. Lindsey, L.G.L.T. Meertens, R.G. Fisker, <span 
class="cmti-10">Revised Report on</span>
    <span 
class="cmti-10">the Algorithmic Language ALGOL 68</span>, Springer Science &amp; Business Media,
    2012
</p>
    </div>
    
</body></html> 

                                                                  

                                                                  
                                                                  


