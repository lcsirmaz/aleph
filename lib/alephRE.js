"use strict";let a_StdargArray=[],Jobno=-1,exval=0;const MaxListSize=1e6,MaxFileSize=1e6,CharBufExt=4096;function toss(...e){let t=e.pop();throw Error(e.join(" "),{cause:t})}class a_Array{constructor(e,t,n,r,f,i){this.type=e,this.name=t,this.calibre=n,this.vlwb=r,this.vupb=f,this.alwb=r,this.aupb=r-n,this.offs=n-r-1,this.buffer=new ArrayBuffer(0,{maxByteLength:1e6}),this.data=new Int32Array(this.buffer),this.size=0,this.extension(i)}extension(e){let t=this.aupb+this.calibre-this.alwb+e;return t>this.size&&(this.aupb+e>this.vupb&&toss("extending",this.name,"by",e,"from",this.aupb,"would go beyond",this.vupb,"extension"),4*(t=Math.min(t+1023&-1024,this.vupb+this.calibre-this.alwb))>1e6&&toss("stack",this.name,"size",t,"exceeds max memory","extension"),this.size=t,this.buffer.resize(4*this.size)),this.aupb+this.offs+1}get(e){return this.data[e+this.offs]}checkidx(e,t){return(e+this.offs<0||e>this.aupb)&&toss("index error",this.name,"[",e,"]","in rule",a_RuleNames[t],"indexing"),e+this.offs}put(e,t){this.data[e+this.offs]=t}free(){this.aupb=this.vlwb,this.alwb=this.aupb+this.calibre,this.size=0,this.buffer.resize(0)}chomp(){return this.vupb=this.aupb,this.size=this.vupb+this.calibre-this.alwb,this.buffer.resize(4*this.size),this.vupb}}function a_RequestSpace(e,t){if(e.aupb+t>e.vupb)return 0;let n=e.size;try{e.extension(t)}catch{return e.size=n,0}return 1}function a_FillLists(e){for(let t=0;"object"==typeof e[t];t++){let n=e[t++],r=n.offs+n.aupb+1;for(let f=0;0!=e[t];){let i=e[t++];if(0<i)for(f=i,n.aupb+=f;0<i;i--)n.data[r++]=e[t++];else for(;-1>i;i++){n.aupb+=f;for(let o=0;o<f;o++)n.data[r]=n.data[r-f],r++}}}}function a_CompareString(e,t,n,r){let f=e.offs+t,i=n.offs+r,o=e.data[f]-1,a=n.data[i]-1;(o<2||f<o||a<2||i<a)&&toss(e.name,"[",t,"] or ",n.name,"[",r,"] not a string","compare string");let s=new Uint8Array(e.buffer,4*(f-o),4*o),$=new Uint8Array(n.buffer,4*(i-a),4*a),u=0;for(;s[u]==$[u]&&0!=s[u];)u++;return s[u]-$[u]}function a_CompareStringN(e,t,n,r,f){let i=e.offs+t,o=n.offs+r,a=e.data[i]-1,s=n.data[o]-1;(a<2||i<a||s<2||o<s)&&toss(e.name,"[",t,"] or ",n.name,"[",r,"] not a string","compare stringN");let $=new Uint8Array(e.buffer,4*(i-a),4*a),u=new Uint8Array(n.buffer,4*(o-s),4*s),l=0;for(;f>0&&$[l]==u[l]&&0!=$[l];)(192&$[l])!=128&&f--,l++;return f?$[l]-u[l]:0}function a_StringElem(e,t,n,r){let f=e.offs+t,i=e.data[f]-1;if((i<2||f<i||i>32e3)&&toss(e.name,"[",t,"] not a string","string elem"),n<0||n>=e.data[f-1])return 0;let o=new Uint8Array(e.buffer,4*(f-i),4*i);for(let a=0;a<4*i;n--){let s=o[a++],$=(s>191)+(s>223)+(s>239);if(n<=0)return s&=[255,31,15,15][$],3>$||(s=s<<6|63&o[a++]),2>$||(s=s<<6|63&o[a++]),1>$||(s=s<<6|63&o[a]),r[0]=s,1;a+=$}toss(e.name,"[",t,"] not a string, cnt=",n,"string elem")}function a_PackString(e,t,n){(t<0||t>32e3)&&toss("pack string+",e.name,"+",t,"+",n.name,"wrong length","pack string");let r=e.offs+e.aupb-t+1;a_PushString(n,t,t=>e.data[r+t])}function a_UnpackString(e,t,n){let r=e.data[e.offs+t-1];if(0==r)return;(r<0||r>32e3)&&toss("unpack string+",e.name,"+",t,"+",n.name,"not a string","unpack string");let f=n.extension(r);n.aupb+=r,strIter(e,t,e=>{n.data[f++]=e})}function a_CopyString(e,t,n){let r=e.offs+t,f=e.data[r];((r-=f-1)<0||f<2||f>1e4)&&toss("copy string+",e.name,"+",t,"+",n.name,"not a string","copy string");let i=n.extension(f);for(n.aupb+=f;f>0;f--)n.data[i++]=e.data[r++]}function strIter(e,t,n){let r=e.offs+t,f=e.data[r]-1,i=e.data[r-1];(f<2||r<f||f>1e4||i<0||i>32e3)&&toss(e.name,"[",t,"] not a string","iterate ALEPH string");let o=new Uint8Array(e.buffer,4*(r-f),4*f);for(let a=0;i>0;i--){a>4*f-4&&toss(e.name,"[",t,"] is not a string","iterate ALEPH string");let s=o[a++],$=(s>191)+(s>223)+(s>239);s&=[255,31,15,15][$],3>$||(s=s<<6|63&o[a++]),2>$||(s=s<<6|63&o[a++]),1>$||(s=s<<6|63&o[a++]),0==s&&toss(e.name,"[",t,"] is not a string","iterate ALEPH string"),n(s)}}function a_PushString(e,t,n){let r=12;for(let f=0;f<t;f++){let i=n(f);(i<1||i>1114111)&&toss("invalid charcode",i,"to string at",e.name,"pack string"),r+=1+(i>=128)+(i>=2048)+(i>=65536)}r>>=2;let o=e.extension(r);e.aupb+=r,e.data[o+r-3]=0;let a=new Uint8Array(e.buffer,4*o,4*r),s=0,$=e=>{a[s++]=e};for(let u=0;u<t;u++){let l=n(u);switch((l>=128)+(l>=2048)+(l>=65536)){default:$(l);break;case 1:$(192|l>>6),$(128|63&l);break;case 2:$(224|l>>12),$(128|l>>6&63),$(128|63&l);break;case 3:$(240|l>>18),$(128|l>>12&63),$(128|l>>6&63),$(128|63&l)}}$(0),e.data[o+r-2]=t,e.data[o+r-1]=r}function a_cmpToStr(e,t,n){return n==a2str(e,t)}function a2str(e,t){let n="";return strIter(e,t,e=>{n+=String.fromCodePoint(e)}),n}function a_msleep(e){toss("sleep(",e,"), use -async for linking","sleep")}async function a_async_a_msleep(e){await new Promise(t=>{setTimeout(t,e)})}const FD=[{path:"<<stdin>>",openw:-1,openr:0,type:1,changed:0,channel:"stdin"},{path:"<<stdout>>",openw:0,openr:-1,type:2,changed:0,channel:"stdout",ff:null},{path:"<<stderr>>",openw:0,openr:-1,type:2,changed:0,channel:"stderr",ff:null}],IOERR_EOPENED=1,IOERR_ENOTFOUND=2,IOERR_EBUSY=3,IOERR_EREADONLY=4,IOERR_EDIRECTION=5,IOERR_EWRONGNAME=6,IOERR_EFILETYPE=7,IOERR_ENOTOPENED=8,IOERR_EWRONGPTR=9,IOERR_EDATATRUNC=10,IOERR_EEOF=11,IOERR_EWRONGVALUE=12,IOERR_ENOTALEPH=13,IOERR_ENOSEEK=14,IOERR_ESEEK=15,IOERR_ETEMP=16,readArg=114,writeArg=119,tempArg=88,codeA=65;class a_CharFile{constructor(e,t,n,r){this.name=e,this.type=1,this.errno=0,this.direction=0,this.fpos=-1,this.arg={d:t,T:n,idx:r}}init(){}}class a_DataFile{constructor(e,t,n,r,f){this.name=e,this.type=0,this.errno=0,this.fpos=-1,this.direction=0,this.arg={d:t,T:n,idx:r},this.inareas=[],f>=32&&toss("datafile",e,"maximal number of areas exceeded","datafile init")}setarea(e){for(let t of(this.areas=[],e))this.areas.push({lwb:t.vlwb,upb:t.vupb})}}function waitForNextline(e){return new Promise(t=>{let n=r=>{let f=r.data;"stdin"==f.cmd&&f.file==e&&(self.removeEventListener("message",n),t(f))};self.addEventListener("message",n),self.postMessage({cmd:"read",job:Jobno,file:e})})}function aChPos(e,t){if(t.fpos=t.nextpos,t.fpos>=e.bufflen){t.fpos=e.bufflen,t.eof=1;return}let n=t.buffer,r=t.fpos,f=n[r++],i=(f>191)+(f>223)+(f>239);if(t.nextpos=t.fpos+1+i,t.nextpos>e.bufflen){t.pos=e.bufflen,t.eof=1;return}f&=[255,31,15,15][i],3>i||(f=f<<6|63&n[r++]),2>i||(f=f<<6|63&n[r++]),1>i||(f=f<<6|63&n[r]),t.nextch=f}function aChkIn(e){if(1!=e.type)return e.errno=7,1;if(0==e.direction){if(!tryOpen(e,114))return 1}else if(1!=e.direction)return e.errno=5,1;return e.eof?(e.errno=11,1):0}function flushStdout(){for(let e of FD)2==e.type&&"stdout"==e.channel&&e.openw>0&&e.ff.CollectLine&&(sendLineBuffer(e.channel,e.ff.CollectLine),e.ff.CollectLine="")}async function asChar(e,t,n){if(e.linePtr>=e.lineBuf.length){if(e.lineEOF)return e.eof=1,e.errno=11,0;flushStdout();let r=await waitForNextline(t.channel);for(let f of(e.lineEOF=r.eof,e.lineBuf.length=0,r.data))e.lineBuf.push(f.codePointAt(0));if(e.lineEOF||e.lineBuf.push(10),e.linePtr=0,0==e.lineBuf.length)return e.eof=1,e.errno=11,0}return e.errno=0,n[0]=e.lineBuf[e.linePtr],1}async function a_async_a_aheadchar(e,t){if(aChkIn(e))return 0;let n=FD[e.fidx];return 0==n.type?(e.errno=0,t[0]=e.nextch,1):await asChar(e,n,t)}function a_aheadchar(e,t){return aChkIn(e)?0:0==FD[e.fidx].type?(e.errno=0,t[0]=e.nextch,1):(toss(e.name,"attached to <<stdin>>, use -async for linking","ahead char"),0)}async function a_async_a_getchar(e,t){if(aChkIn(e))return 0;let n=FD[e.fidx];return 0==n.type?(e.errno=0,t[0]=e.nextch,aChPos(n,e),1):await asChar(e,n,t)?(e.linePtr++,1):0}function a_getchar(e,t){if(aChkIn(e))return 0;let n=FD[e.fidx];return 0==n.type?(e.errno=0,t[0]=e.nextch,aChPos(n,e),1):(toss(e.name,"attached to <<stdin>>, use --async for linking","get char"),0)}function sendLineBuffer(e,t){self.postMessage({cmd:"write",job:Jobno,file:e,data:t})}function a_putchar(e,t){if(1!=e.type){e.errno=7;return}if(0==e.direction){if(!tryOpen(e,119))return}else if(1==e.direction){e.errno=5;return}e.errno=0,((t|=0)<1||t>1114111)&&toss("invalid charcode",t,"for charfile",e.name,"putchar");let n=FD[e.fidx];if(n.changed=1,2==n.type){10==t?(sendLineBuffer(n.channel,e.CollectLine),e.CollectLine=""):e.CollectLine+=String.fromCodePoint(t);return}let r=1+(t>=128)+(t>=2048)+(t>=65536);e.fpos+r>=n.bufflen&&(n.bufflen+=4096,n.buff.resize(n.bufflen));let f=e.fpos;e.fpos+=r;let i=t=>{e.buffer[f++]=t};switch(r){default:i(t);break;case 2:i(192|t>>6),i(128|63&t);break;case 3:i(224|t>>12),i(128|t>>6&63),i(128|63&t);break;case 4:i(240|t>>18),i(128|t>>12&63),i(128|t>>6&63),i(128|63&t)}}function a_putdatap(e,t,n){if(0!=e.type)return e.errno=7,0;if(0==e.direction){if(!tryOpen(e,119))return 0}else if(2!=e.direction)return e.errno=5,0;if(0!=n&&0!=t&&-1!=t){let r=0;for(;r<e.areas.length&&(t<e.areas[r].lwb||t>e.areas[r].upb);r++);if(r>=e.areas.length)return e.errno=9,0}if(e.errno=0,1023==(1023&e.fpos)){e.buffer[31]=e.iflag,e.fpos++;let f=FD[e.fidx];f.changed=1,f.bufflen=(e.fpos+1024)*4,f.buff.resize(f.bufflen),e.buffer=new Int32Array(f.buff,4*e.fpos,1024),e.fpos+=32,e.iflag=0}else(31&e.fpos)==31?(e.buffer[31&e.fpos>>5]=e.iflag,e.iflag=0,e.fpos++):(e.iflag<<=1,e.fpos++);return e.buffer[1023&e.fpos]=t,n&&(e.iflag|=1),1}function a_putdata(e,t,n){a_putdatap(e,t,n)||toss("put data+",e.name,"+",t,"+",n,"error code",e.errno,"put data")}function a_getdata(e,t){if(0!=e.type)return e.errno=7,0;if(0==e.direction){if(!tryOpen(e,114))return 0}else if(1!=e.direction)return e.errno=5,0;if(e.eof)return e.errno=11,0;let n=FD[e.fidx];if((1023&e.fpos)==1023){if(n.bufflen<4*e.fpos+4096)return e.errno=10,0;e.fpos++,e.buffer=new Int32Array(n.buff,4*e.fpos,1024),e.fpos+=32,e.iflag=e.buffer[1]}else(31&e.fpos)==31?(e.fpos++,e.iflag=e.buffer[e.fpos>>5&31]):(e.fpos++,e.iflag<<=1);if(e.errno=0,t[0]=e.buffer[1023&e.fpos],t[1]=0,2147483648&e.iflag){if(t[1]=1,-1==t[0])return e.errno=11,0;if(0==t[0])return 1;let r=1;if(e.inareas.forEach(e=>{r&&e.lwb<=t[0]&&t[0]<=e.upb&&(r=0,t[0]+=e.diff)}),r)return e.errno=12,0}return 1}function tryOpen(e,t){let n=119==t;switch(e.arg.d){case 2:if(n)break;case 0:return e.errno=5,0;case 1:if(n)return e.errno=5,0}return a_openfile(e,t,e.arg.T,e.arg.idx)}function a_openfile(e,t,n,r,f=0){if(e.direction)return e.errno=1,0;e.errno=0;let i=119==t,o=a2str(n,r);if(!o||o.length>96||/[\x00-\x1f]/.test(o))return e.errno=6,0;let a=0;for(;a<FD.length&&FD[a].path!=o;)a++;if(a==FD.length){if(!i)return e.errno=2,0;FD.push({path:o,idx:-2,openw:0,openr:0,changed:0,type:0,buff:null,bufflen:0,ff:null})}let s=FD[a];if(i){if(s.openw<0)return e.errno=4,0;if(0!=s.openw||s.openr>0)return e.errno=3,0;if(s.buff=null,1==e.type)2==s.type?(e.CollectLine="",e.fpos=-1):(s.buff=new ArrayBuffer(4096,{maxByteLength:1e6}),s.bufflen=4096,e.buffer=new Uint8Array(s.buff)),e.fpos=0;else{if(2==s.type)return e.errno=3,0;s.buff=new ArrayBuffer(4096,{maxByteLength:1e6}),s.bufflen=4096,e.buffer=new Int32Array(s.buff,0,1024),e.iflag=0,e.fpos=32;let $=e.areas.length;e.buffer[e.fpos++]=$;for(let u=0;u<$;u++)e.buffer[e.fpos++]=u,e.buffer[e.fpos++]=e.areas[u].lwb,e.buffer[e.fpos++]=e.areas[u].upb;e.startpos=e.fpos}s.ff=e,s.openw++,e.direction=2,e.fidx=a,f&&(s.tmpfile=1)}else{if(s.openw>0||s.openr<0)return e.errno=3,0;if(1==e.type){if(1==s.type){if(0!=s.openr)return e.errno=3,0;e.lineEOF=0,e.lineBuf=[],e.linePtr=1,e.eof=0,e.fpos=-1}else e.fpos=0,e.eof=0,e.buffer=new Uint8Array(s.buff),e.nextpos=0,aChPos(s,e);e.direction=1,e.fidx=a,s.openr++}else{if(e.eof=0,s.bufflen<4096)return e.errno=13,0;e.buffer=new Int32Array(s.buff,0,1024),e.fpos=32;let l=e.buffer[e.fpos++];if(l<0||l>=32)return e.errno=13,0;let p=e.areas;e.inareas=[];for(let c=0;c<l;c++){if(c!=e.buffer[e.fpos++])return e.errno=13,0;let _=e.buffer[e.fpos++],d=e.buffer[e.fpos++];c<p.length&&e.inareas.push({lwb:_,upb:d,diff:p[c].lwb-_})}e.startpos=e.fpos,e.iflag=e.buffer[e.fpos>>5&31]<<(31&e.fpos),e.direction=1,e.fidx=a,s.openr++}}return 1}function a_opentmp(e,t,n){let r=t.offs+n,f=t.data[r]-1;(f<2||r<f||t.data[r-1]<6)&&toss(t.name,"[",n,"] not a string","open temp file");let i=new Uint8Array(t.buffer,4*(r-f),4*f),o=0;for(;o<4*f-4&&0!=i[o];)o++;if(0!=i[o]||o<6||88!=i[o-1]||88!=i[o-2]||88!=i[o-5]||88!=i[o-6])return e.errno=16,0;for(let a=o-6;a<o;a++)i[a]=65+(26*Math.random()|0);return a_openfile(e,119,t,n,1)}function a_closefile(e){if(0==e.direction){e.errno=8;return}let t=FD[e.fidx];if(e.errno=0,1==e.type){if(1==e.direction){t.openr--,e.direction=0,e.buffer=null,e.eof=0;return}2==t.type?(""!=e.CollectLine&&sendLineBuffer(t.channel,e.CollectLine),e.CollectLine=""):(e.buffer=null,t.bufflen=e.fpos,t.buff=t.buff.transferToFixedLength(t.bufflen)),t.openw--,e.direction=0,t.ff=null;return}if(1==e.direction){t.openr--,e.direction=0,e.buffer=null,e.eof=0;return}{let n=a_putdatap(e,-1,1);for(;n&&(31&e.fpos)!=31;)n=a_putdatap(e,-1,1);e.buffer[e.fpos>>5&31]=e.iflag,e.buffer=null,t.buff=t.buff.transferToFixedLength(),t.changed=1,t.openw--,e.direction=0,t.ff=null;return}}function a_setfilepos(e,t){if(0==e.direction){e.errno=8;return}let n=FD[e.fidx];if(1!=e.direction||0!=n.type){e.errno=14;return}if((t|=0)<0){e.errno=15;return}if(1==e.type)e.errno=0,e.eof=0,e.nextpos=t,aChPos(n,e);else{if(0==t&&(t=e.startpos),(1023&t)<32){e.errno=15;return}if(e.errno=0,t==e.fpos)return;if(e.eof=0,(-1024&t)!=(-1024&e.fpos)){let r=(-1024&t)*4;if(n.bufflen<r+4096){e.errno=15;return}if((1023&t)==1023){e.fpos=t;return}e.buffer=new Int32Array(n.buff,r,1024)}e.fpos=t,e.iflag=e.buffer[t>>5&31]<<(31&t)}}function a_unlinkfile(e,t){let n=a2str(e,t);for(let r=0;r<FD.length;r++)if(n==FD[r].path){let f=FD[r];f.openw>=0&&(f.path="/.Trash/"+n,0==f.openw&&0==f.openr&&f.buff&&(f.buff=null,f.bufflen=0));return}}function closeAll(){FD.forEach(e=>{e.openw>0&&e.ff&&a_closefile(e.ff)})}function addFile(e,t,n,r){let f=0,i=r.byteLength;for(;f<FD.length&&e!=FD[f].path;f++);f==FD.length&&FD.push({}),n=n?-1:0,Object.assign(FD[f],{path:e,idx:t,openw:n,openr:0,changed:0,type:0,buff:r,bufflen:i,ff:null})}function returnFiles(){FD.forEach(e=>{0==e.type&&e.idx>=0&&!e.tmpfile&&e.path.startsWith("/.Trash/")&&self.postMessage({cmd:"file",job:Jobno,idx:e.idx,filename:e.path,rm:"yes"})}),FD.forEach(e=>{0!=e.type||-1==e.idx||e.tmpfile||e.path.startsWith("/.Trash/")||self.postMessage({cmd:"file",job:Jobno,idx:e.idx,changed:e.changed?1:0,filename:e.path,data:e.buff},[e.buff])})}let waitingForFiles=0,startRunning=0;function loadFile(e,t){let n=new XMLHttpRequest;n.open("get",t,!0),n.responseType="arraybuffer",waitingForFiles++,n.addEventListener("loadend",()=>{200!=n.status?self.postMessage({cmd:"error loading",url:t,status:n.status}):addFile(e,-1,1,n.response),--waitingForFiles<=0&&startRunning&&runRoot()},!1),n.send()}function runmsg(){waitingForFiles?startRunning=1:runRoot()}function a_PrintStackFrame(){let e=a_Tr(),t=1;if(e)for(self.postMessage({cmd:"stack",job:Jobno,count:0,data:"Rule stack"});e;)e.rule>=0&&(self.postMessage({cmd:"stack",job:Jobno,count:t,data:a_RuleNames[e.rule]}),t++),e=e.next}function a_TraceRule(e,t){let n=a_RuleNames[e];for(let r=0;r<t;r++){let f=arguments[r+2];n+="+"+("object"==typeof f?f.name:f)}self.postMessage({cmd:"trace",job:Jobno,data:n})}function dump_Profile(e){if(!e)return;let t=1,n={next:e};for(;t;){t=0;let r=n,f=n.next,i;for(;f&&(i=f.next);)f.count<i.count?(t=1,r.next=i,f.next=i.next,i.next=f,r=i):(r=f,f=i)}for(e=n.next,self.postMessage({cmd:"profile",job:Jobno,data:"Call counts",count:-1});e;)self.postMessage({cmd:"profile",job:Jobno,data:a_RuleNames[e.rule],count:e.count}),e=e.next}function a_WaitLock(e){toss("Deadlock for module",e,"waitfor")}function a_AreaFailed(e,t){toss("Classification failed in rule",t,"with value",e,"classification")}function a_exit(e){exval=e,toss("exit with value",e,"exit")}async function runRoot(){let e=0;try{await a_ROOT()}catch(t){"exit"==t.cause?e=1:(e=2,exval="Error: "+t.message+", type: "+t.cause)}terminate(e,exval)}function terminate(e,t){closeAll(),self.postMessage({cmd:"exit",job:Jobno,data:e,msg:t}),0!=e&&a_PrintStackFrame(),e<=1&&dump_Profile(a_PROFILE),returnFiles(),self.postMessage({cmd:"terminated",job:Jobno}),self.close()}self.addEventListener("message",e=>{let t=e.data;"init"==t.cmd?(Jobno=t.job,self.postMessage({cmd:"ready",job:Jobno})):"stdarg"==t.cmd?a_StdargArray=t.data:"file"==t.cmd?t.url?loadFile(t.filename,t.url):addFile(t.filename,t.idx,t.ro,t.data):"run"==t.cmd?runmsg():"kill"==t.cmd?terminate(3,"program killed"):"stdin"!=t.cmd&&self.postMessage({cmd:"unknown cmd received",msg:t.cmd})});