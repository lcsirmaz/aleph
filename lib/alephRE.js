"use strict";let a_StdargArray=[],a_Job=-1,a_Exv=0;const a_MaxListSize=1e6,a_MaxFileSize=1e6,a_CharBufExt=4096;function toss(...e){let t=e.pop();throw Error(e.join(" "),{cause:t})}class a_Array{constructor(e,t,n,r,a,f){this.type=e,this.name=t,this.calibre=n,this.vlwb=r,this.vupb=a,this.alwb=r,this.aupb=r-n,this.offs=n-r-1,this.buffer=new ArrayBuffer(0,{maxByteLength:1e6}),this.data=new Int32Array(this.buffer),this.size=0,this.extension(f)}extension(e){let t=this.aupb+this.calibre-this.alwb+e;return t>this.size&&(this.aupb+e>this.vupb&&toss("extending",this.name,"by",e,"from",this.aupb,"would go beyond",this.vupb,"extension"),4*(t=Math.min(t+1023&-1024,this.vupb+this.calibre-this.alwb))>1e6&&toss("stack",this.name,"size",t,"exceeds max memory","extension"),this.size=t,this.buffer.resize(4*this.size)),this.aupb+this.offs+1}get(e){return this.data[e+this.offs]}checkidx(e,t){return(e+this.offs<0||e>this.aupb)&&toss("index error",this.name,"[",e,"]","in rule",a_RuleNames[t],"indexing"),e+this.offs}put(e,t){this.data[e+this.offs]=t}free(){this.aupb=this.vlwb,this.alwb=this.aupb+this.calibre,this.size=0,this.buffer.resize(0)}chomp(){return this.vupb=this.aupb,this.size=this.vupb+this.calibre-this.alwb,this.buffer.resize(4*this.size),this.vupb}}function a_RequestSpace(e,t){if(e.aupb+t>e.vupb)return 0;let n=e.size;try{e.extension(t)}catch{return e.size=n,0}return 1}function a_FillLists(e){for(let t=0;"object"==typeof e[t];t++){let n=e[t++],r=n.offs+n.aupb+1;for(let a=0;0!=e[t];){let f=e[t++];if(0<f)for(a=f,n.aupb+=a;0<f;f--)n.data[r++]=e[t++];else for(;-1>f;f++){n.aupb+=a;for(let i=0;i<a;i++)n.data[r]=n.data[r-a],r++}}}}function a_CompareString(e,t,n,r){let a=e.offs+t,f=n.offs+r,i=e.data[a]-1,o=n.data[f]-1;(i<2||a<i||o<2||f<o)&&toss(e.name,"[",t,"] or ",n.name,"[",r,"] not a string","compare string");let s=new Uint8Array(e.buffer,4*(a-i),4*i),u=new Uint8Array(n.buffer,4*(f-o),4*o),$=0;for(;s[$]==u[$]&&0!=s[$];)$++;return s[$]-u[$]}function a_CompareStringN(e,t,n,r,a){let f=e.offs+t,i=n.offs+r,o=e.data[f]-1,s=n.data[i]-1;(o<2||f<o||s<2||i<s)&&toss(e.name,"[",t,"] or ",n.name,"[",r,"] not a string","compare stringN");let u=new Uint8Array(e.buffer,4*(f-o),4*o),$=new Uint8Array(n.buffer,4*(i-s),4*s),l=0;for(;a>0&&u[l]==$[l]&&0!=u[l];)(192&u[l])!=128&&a--,l++;return a?u[l]-$[l]:0}function a_StringElem(e,t,n,r){let a=e.offs+t,f=e.data[a]-1;if((f<2||a<f||f>32e3)&&toss(e.name,"[",t,"] not a string","string elem"),n<0||n>=e.data[a-1])return 0;let i=new Uint8Array(e.buffer,4*(a-f),4*f);for(let o=0;o<4*f;n--){let s=i[o++],u=(s>191)+(s>223)+(s>239);if(n<=0)return s&=[255,31,15,15][u],3>u||(s=s<<6|63&i[o++]),2>u||(s=s<<6|63&i[o++]),1>u||(s=s<<6|63&i[o]),r[0]=s,1;o+=u}toss(e.name,"[",t,"] not a string, cnt=",n,"string elem")}function a_PackString(e,t,n){(t<0||t>32e3)&&toss("pack string+",e.name,"+",t,"+",n.name,"wrong length","pack string");let r=e.offs+e.aupb-t+1;a_PushString(n,t,t=>e.data[r+t])}function a_UnpackString(e,t,n){let r=e.data[e.offs+t-1];if(0==r)return;(r<0||r>32e3)&&toss("unpack string+",e.name,"+",t,"+",n.name,"not a string","unpack string");let a=n.extension(r);n.aupb+=r,a_Ite(e,t,e=>{n.data[a++]=e})}function a_CopyString(e,t,n){let r=e.offs+t,a=e.data[r];((r-=a-1)<0||a<2||a>1e4)&&toss("copy string+",e.name,"+",t,"+",n.name,"not a string","copy string");let f=n.extension(a);for(n.aupb+=a;a>0;a--)n.data[f++]=e.data[r++]}function a_Ite(e,t,n){let r=e.offs+t,a=e.data[r]-1,f=e.data[r-1];(a<2||r<a||a>1e4||f<0||f>32e3)&&toss(e.name,"[",t,"] not a string","iterate ALEPH string");let i=new Uint8Array(e.buffer,4*(r-a),4*a);for(let o=0;f>0;f--){o>4*a-4&&toss(e.name,"[",t,"] not a string","iterate ALEPH string");let s=i[o++],u=(s>191)+(s>223)+(s>239);s&=[255,31,15,15][u],3>u||(s=s<<6|63&i[o++]),2>u||(s=s<<6|63&i[o++]),1>u||(s=s<<6|63&i[o++]),0==s&&toss(e.name,"[",t,"] not a string","iterate ALEPH string"),n(s)}}function a_PushString(e,t,n){let r=12;for(let a=0;a<t;a++){let f=n(a);(f<1||f>1114111)&&toss("invalid charcode",f,"to string at",e.name,"pack string"),r+=1+(f>=128)+(f>=2048)+(f>=65536)}r>>=2;let i=e.extension(r);e.aupb+=r,e.data[i+r-3]=0;let o=new Uint8Array(e.buffer,4*i,4*r),s=0,u=e=>{o[s++]=e};for(let $=0;$<t;$++){let l=n($);switch((l>=128)+(l>=2048)+(l>=65536)){default:u(l);break;case 1:u(192|l>>6),u(128|63&l);break;case 2:u(224|l>>12),u(128|l>>6&63),u(128|63&l);break;case 3:u(240|l>>18),u(128|l>>12&63),u(128|l>>6&63),u(128|63&l)}}u(0),e.data[i+r-2]=t,e.data[i+r-1]=r}function a_cmpToStr(e,t,n){return n==a_Str(e,t)}function a_Str(e,t){let n="";return a_Ite(e,t,e=>{n+=String.fromCodePoint(e)}),n}function a_msleep(e){toss("sleep(",e,"), use -async for linking","sleep")}async function a_async_a_msleep(e){await new Promise(t=>{setTimeout(t,e)})}const a_FD=[{path:"<<stdin>>",openw:-1,openr:0,type:1,changed:0,channel:"stdin"},{path:"<<stdout>>",openw:0,openr:-1,type:2,changed:0,channel:"stdout",ff:null},{path:"<<stderr>>",openw:0,openr:-1,type:2,changed:0,channel:"stderr",ff:null}],IOERR={EOPENED:1,ENOTFOUND:2,EBUSY:3,EREADONLY:4,EDIRECTION:5,EFILETYPE:6,ENOTOPENED:7,EWRONGPTR:8,EDATATRUNC:9,EEOF:10,ENOTALEPH:11,ENOSEEK:12,ESEEK:13,ETEMP:14},readArg=114,writeArg=119,tempArg=88,codeA=65;class a_CharFile{constructor(e,t,n,r){this.name=e,this.type=1,this.errno=0,this.direction=0,this.fpos=-1,this.arg={d:t,T:n,idx:r}}init(){}}class a_DataFile{constructor(e,t,n,r,a){this.name=e,this.type=0,this.errno=0,this.fpos=-1,this.direction=0,this.arg={d:t,T:n,idx:r},this.inareas=[],a>=32&&toss("datafile",e,"maximal number of areas exceeded","datafile init")}setarea(e){for(let t of(this.areas=[],e))this.areas.push({lwb:t.vlwb,upb:t.vupb})}}function a_WaitForNextLine(e){return new Promise(t=>{let n=r=>{let a=r.data;"stdin"==a.cmd&&a.file==e&&(self.removeEventListener("message",n),t(a))};self.addEventListener("message",n),self.postMessage({cmd:"read",job:a_Job,file:e})})}function aChPos(e,t){if(t.fpos=t.nextpos,t.fpos>=e.bufflen){t.fpos=e.bufflen,t.eof=1;return}let n=t.buffer,r=t.fpos,a=n[r++],f=(a>191)+(a>223)+(a>239);if(t.nextpos=t.fpos+1+f,t.nextpos>e.bufflen){t.pos=e.bufflen,t.eof=1;return}a&=[255,31,15,15][f],3>f||(a=a<<6|63&n[r++]),2>f||(a=a<<6|63&n[r++]),1>f||(a=a<<6|63&n[r]),t.nextch=a}function aChkIn(e){if(1!=e.type)return e.errno=IOERR.EFILETYPE,1;if(0==e.direction){if(!a_tryopen(e,114))return 1}else if(1!=e.direction)return e.errno=IOERR.EDIRECTION,1;return e.eof?(e.errno=IOERR.EEOF,1):0}function flushStdout(){for(let e of a_FD)2==e.type&&"stdout"==e.channel&&e.openw>0&&e.ff.CollectLine&&(a_SendLineBuffer(e.channel,e.ff.CollectLine),e.ff.CollectLine="")}async function asChar(e,t,n){if(e.linePtr>=e.lineBuf.length){if(e.lineEOF)return e.eof=1,e.errno=IOERR.EEOF,0;flushStdout();let r=await a_WaitForNextLine(t.channel);for(let a of(e.lineEOF=r.eof,e.lineBuf.length=0,r.data))e.lineBuf.push(a.codePointAt(0));if(e.lineEOF||e.lineBuf.push(10),e.linePtr=0,0==e.lineBuf.length)return e.eof=1,e.errno=IOERR.EEOF,0}return e.errno=0,n[0]=e.lineBuf[e.linePtr],1}async function a_async_a_aheadchar(e,t){if(aChkIn(e))return 0;let n=a_FD[e.fidx];return 0==n.type?(e.errno=0,t[0]=e.nextch,1):await asChar(e,n,t)}function a_aheadchar(e,t){return aChkIn(e)?0:0==a_FD[e.fidx].type?(e.errno=0,t[0]=e.nextch,1):(toss(e.name,"attached to <<stdin>>, use -async for linking","ahead char"),0)}async function a_async_a_getchar(e,t){if(aChkIn(e))return 0;let n=a_FD[e.fidx];return 0==n.type?(e.errno=0,t[0]=e.nextch,aChPos(n,e),1):await asChar(e,n,t)?(e.linePtr++,1):0}function a_getchar(e,t){if(aChkIn(e))return 0;let n=a_FD[e.fidx];return 0==n.type?(e.errno=0,t[0]=e.nextch,aChPos(n,e),1):(toss(e.name,"attached to <<stdin>>, use --async for linking","get char"),0)}function a_SendLineBuffer(e,t){self.postMessage({cmd:"write",job:a_Job,file:e,data:t})}function a_putchar(e,t){if(1!=e.type){e.errno=IOERR.EFILETYPE;return}if(0==e.direction){if(!a_tryopen(e,119))return}else if(1==e.direction){e.errno=IOERR.EDIRECTION;return}e.errno=0,t|=0;let n=a_FD[e.fidx];if(n.changed=1,2==n.type){if(10==t){a_SendLineBuffer(n.channel,e.CollectLine),e.CollectLine="";return}e.CollectLine+=String.fromCodePoint(t);return}let r=1+(t>=128)+(t>=2048)+(t>=65536);e.fpos+r>=n.bufflen&&(n.bufflen+=4096,n.buff.resize(n.bufflen));let a=e.fpos;e.fpos+=r;let f=t=>{e.buffer[a++]=t};switch(r){default:f(t);break;case 2:f(192|t>>6),f(128|63&t);break;case 3:f(224|t>>12),f(128|t>>6&63),f(128|63&t);break;case 4:f(240|t>>18),f(128|t>>12&63),f(128|t>>6&63),f(128|63&t)}}function a_putdatap(e,t,n){if(0!=e.type)return e.errno=IOERR.EFILETYPE,0;if(0==e.direction){if(!a_tryopen(e,119))return 0}else if(2!=e.direction)return e.errno=IOERR.EDIRECTION,0;if(0!=n&&0!=t&&-1!=t){let r=0;for(;r<e.areas.length&&(t<e.areas[r].lwb||t>e.areas[r].upb);r++);if(r>=e.areas.length)return e.errno=IOERR.EWRONGPTR,0}if(e.errno=0,1023==(1023&e.fpos)){e.buffer[31]=e.iflag,e.fpos++;let a=a_FD[e.fidx];a.changed=1,a.bufflen=(e.fpos+1024)*4,a.buff.resize(a.bufflen),e.buffer=new Int32Array(a.buff,4*e.fpos,1024),e.fpos+=32,e.iflag=0}else(31&e.fpos)==31?(e.buffer[31&e.fpos>>5]=e.iflag,e.iflag=0,e.fpos++):(e.iflag<<=1,e.fpos++);return e.buffer[1023&e.fpos]=t,n&&(e.iflag|=1),1}function a_putdata(e,t,n){a_putdatap(e,t,n)||toss("put data+",e.name,"+",t,"+",n,"error code",e.errno,"put data")}function a_getdata(e,t){if(0!=e.type)return e.errno=IOERR.EFILETYPE,0;if(0==e.direction){if(!a_tryopen(e,114))return 0}else if(1!=e.direction)return e.errno=IOERR.EDIRECTION,0;if(e.eof)return e.errno=IOERR.EEOF,0;let n=a_FD[e.fidx];if((1023&e.fpos)==1023){if(n.bufflen<4*e.fpos+4096)return e.errno=IOERR.EDATATRUNC,0;e.fpos++,e.buffer=new Int32Array(n.buff,4*e.fpos,1024),e.fpos+=32,e.iflag=e.buffer[1]}else(31&e.fpos)==31?(e.fpos++,e.iflag=e.buffer[e.fpos>>5&31]):(e.fpos++,e.iflag<<=1);if(e.errno=0,t[0]=e.buffer[1023&e.fpos],t[1]=0,2147483648&e.iflag){if(t[1]=1,-1==t[0])return e.errno=IOERR.EEOF,0;if(0==t[0])return 1;let r=1;if(e.inareas.forEach(e=>{r&&e.lwb<=t[0]&&t[0]<=e.upb&&(r=0,t[0]+=e.diff)}),r)return e.errno=IOERR.WRONGVALUE,0}return 1}function a_tryopen(e,t){let n=119==t;switch(e.arg.d){case 2:if(n)break;case 0:return e.errno=IOERR.EDIRECTION,0;case 1:if(n)return e.errno=IOERR.EDIRECTION,0}return a_openfile(e,t,e.arg.T,e.arg.idx)}function a_openfile(e,t,n,r,a=0){if(e.direction)return e.errno=IOERR.EOPENED,0;e.errno=0;let f=119==t,i=a_Str(n,r),o=0;for(;o<a_FD.length&&a_FD[o].path!=i;)o++;if(o==a_FD.length){if(!f)return e.errno=IOERR.ENOTFOUND,0;a_FD.push({path:i,idx:-2,openw:0,openr:0,changed:0,type:0,buff:null,bufflen:0,ff:null})}let s=a_FD[o];if(f){if(s.openw<0)return e.errno=IOERR.READONLY,0;if(0!=s.openw||s.openr>0)return e.errno=IOERR.EBUSY,0;if(s.buff=null,1==e.type)2==s.type?(e.CollectLine="",e.fpos=-1):(s.buff=new ArrayBuffer(4096,{maxByteLength:1e6}),s.bufflen=4096,e.buffer=new Uint8Array(s.buff)),e.fpos=0;else{if(2==s.type)return e.errno=IOERR.EBUSY,0;s.buff=new ArrayBuffer(4096,{maxByteLength:1e6}),s.bufflen=4096,e.buffer=new Int32Array(s.buff,0,1024),e.iflag=0,e.fpos=32;let u=e.areas.length;e.buffer[e.fpos++]=u;for(let $=0;$<u;$++)e.buffer[e.fpos++]=$,e.buffer[e.fpos++]=e.areas[$].lwb,e.buffer[e.fpos++]=e.areas[$].upb;e.startpos=e.fpos}s.ff=e,s.openw++,e.direction=2,e.fidx=o,a&&(s.tmpfile=1)}else{if(s.openw>0||s.openr<0)return e.errno=IOERR.EBUSY,0;if(1==e.type){if(1==s.type){if(0!=s.openr)return e.errno=IOERR.EBUSY,0;e.lineEOF=0,e.lineBuf=[],e.linePtr=1,e.eof=0,e.fpos=-1}else e.fpos=0,e.eof=0,e.buffer=new Uint8Array(s.buff),e.nextpos=0,aChPos(s,e);e.direction=1,e.fidx=o,s.openr++}else{if(e.eof=0,s.bufflen<4096)return e.errno=IOERR.ENOTALEPH,0;e.buffer=new Int32Array(s.buff,0,1024),e.fpos=32;let l=e.buffer[e.fpos++];if(l<0||l>=32)return e.errno=IOERR.ENOTALEPH,0;let p=e.areas;e.inareas=[];for(let c=0;c<l;c++){if(c!=e.buffer[e.fpos++])return e.errno=IOERR.ENOTALEPH,0;let d=e.buffer[e.fpos++],_=e.buffer[e.fpos++];c<p.length&&e.inareas.push({lwb:d,upb:_,diff:p[c].lwb-d})}e.startpos=e.fpos,e.iflag=e.buffer[e.fpos>>5&31]<<(31&e.fpos),e.direction=1,e.fidx=o,s.openr++}}return 1}function a_opentmp(e,t,n){let r=t.offs+n,a=t.data[r]-1;(a<2||r<a||t.data[r-1]<6)&&toss(t.name,"[",n,"] not a string","open temp file");let f=new Uint8Array(t.buffer,4*(r-a),4*a),i=0;for(;i<4*a-4&&0!=f[i];)i++;if(0!=f[i]||i<6||88!=f[i-1]||88!=f[i-2]||88!=f[i-5]||88!=f[i-6])return e.errno=IOERR.ETEMP,0;for(let o=i-6;o<i;o++)f[o]=65+(26*Math.random()|0);return a_openfile(e,119,t,n,1)}function a_closefile(e){if(0==e.direction){e.errno=IOERR.ENOTOPENED;return}let t=a_FD[e.fidx];if(e.errno=0,1==e.type){if(1==e.direction){t.openr--,e.direction=0,e.buffer=null,e.eof=0;return}2==t.type?(""!=e.CollectLine&&a_SendLineBuffer(t.channel,e.CollectLine),e.CollectLine=""):(e.buffer=null,t.bufflen=e.fpos,t.buff=t.buff.transferToFixedLength(t.bufflen)),t.openw--,e.direction=0,t.ff=null;return}if(1==e.direction){t.openr--,e.direction=0,e.buffer=null,e.eof=0;return}{let n=a_putdatap(e,-1,1);for(;n&&(31&e.fpos)!=31;)n=a_putdatap(e,-1,1);e.buffer[e.fpos>>5&31]=e.iflag,e.buffer=null,t.buff=t.buff.transferToFixedLength(),t.changed=1,t.openw--,e.direction=0,t.ff=null;return}}function a_setfilepos(e,t){if(0==e.direction){e.errno=IOERR.ENOTOPENED;return}let n=a_FD[e.fidx];if(1!=e.direction||0!=n.type||(t|=0)<0){e.errno=IOERR.ESEEK;return}if(1==e.type)e.errno=0,e.eof=0,e.nextpos=t,aChPos(n,e);else{if(0==t&&(t=e.startpos),(1023&t)<32){e.errno=IOERR.ESEEK;return}if(e.errno=0,t==e.fpos)return;if(e.eof=0,(-1024&t)!=(-1024&e.fpos)){let r=(-1024&t)*4;if(n.bufflen<r+4096){e.errno=IOERR.ESEEK;return}if((1023&t)==1023){e.fpos=t;return}e.buffer=new Int32Array(n.buff,r,1024)}e.fpos=t,e.iflag=e.buffer[t>>5&31]<<(31&t)}}function a_unlinkfile(e,t){let n=a_Str(e,t);for(let r=0;r<a_FD.length;r++)if(n==a_FD[r].path){let a=a_FD[r];a.openw>=0&&(a.path="/.Trash/"+n,0==a.openw&&0==a.openr&&a.buff&&(a.buff=null,a.bufflen=0));return}}function a_closeAll(){a_FD.forEach(e=>{e.openw>0&&e.ff&&a_closefile(e.ff)})}function addFile(e,t,n,r){let a=0,f=r.byteLength;for(;a<a_FD.length&&e!=a_FD[a].path;a++);a==a_FD.length&&a_FD.push({}),n=n?-1:0,Object.assign(a_FD[a],{path:e,idx:t,openw:n,openr:0,changed:0,type:0,buff:r,bufflen:f,ff:null})}function returnFiles(){a_FD.forEach(e=>{0==e.type&&-1!=e.idx&&!e.tmpfile&&e.path.startsWith("/.Trash/")&&self.postMessage({cmd:"file",job:a_Job,idx:e.idx,filename:e.path,rm:"yes"})}),a_FD.forEach(e=>{0!=e.type||-1==e.idx||e.tmpfile||e.path.startsWith("/.Trash/")||self.postMessage({cmd:"file",job:a_Job,idx:e.idx,changed:e.changed?1:0,filename:e.path,data:e.buff},[e.buff])})}let waitingForFiles=0,startRunning=0;function loadFile(e,t){let n=new XMLHttpRequest;n.open("get",t,!0),n.responseType="arraybuffer",waitingForFiles++,n.addEventListener("loadend",()=>{200!=n.status?self.postMessage({cmd:"error loading",url:t,status:n.status}):addFile(e,-1,1,n.response),--waitingForFiles<=0&&startRunning&&runRoot()},!1),n.send()}function runmsg(){waitingForFiles?startRunning=1:runRoot()}function a_PrintStackFrame(){let e=a_Tr(),t=1;if(e)for(self.postMessage({cmd:"stack",job:a_Job,count:0,data:"Rule stack"});e;)e.rule>=0&&(self.postMessage({cmd:"stack",job:a_Job,count:t,data:a_RuleNames[e.rule]}),t++),e=e.next}function a_TraceRule(e,t){let n=a_RuleNames[e];for(let r=0;r<t;r++){let a=arguments[r+2];n+="+"+("object"==typeof a?a.name:a)}self.postMessage({cmd:"trace",job:a_Job,data:n})}function dump_Profile(e){if(!e)return;let t=1,n={next:e};for(;t;){t=0;let r=n,a=n.next,f;for(;a&&(f=a.next);)a.count<f.count?(t=1,r.next=f,a.next=f.next,f.next=a,r=f):(r=a,a=f)}for(e=n.next,self.postMessage({cmd:"profile",job:a_Job,data:"Call counts",count:-1});e;)self.postMessage({cmd:"profile",job:a_Job,data:a_RuleNames[e.rule],count:e.count}),e=e.next}function a_WaitLock(e){toss("Deadlock for module",e,"waitfor")}function a_AreaFailed(e,t){toss("Classification failed in rule",t,"with value",e,"classification")}function a_exit(e){a_Exv=e,toss("exit with value",e,"exit")}async function runRoot(){let e=0;try{await a_ROOT()}catch(t){"exit"==t.cause?e=1:(e=2,a_Exv="Error: "+t.message+", type: "+t.cause)}terminate(e,a_Exv)}function terminate(e,t){a_closeAll(),self.postMessage({cmd:"exit",job:a_Job,data:e,msg:t}),0!=e&&a_PrintStackFrame(),e<=1&&dump_Profile(a_PROFILE),returnFiles(),self.postMessage({cmd:"terminated",job:a_Job}),self.close()}self.addEventListener("message",e=>{let t=e.data;"init"==t.cmd?(a_Job=t.job,self.postMessage({cmd:"ready",job:a_Job})):"stdarg"==t.cmd?a_StdargArray=t.data:"file"==t.cmd?t.url?loadFile(t.filename,t.url):addFile(t.filename,t.idx,t.ro,t.data):"run"==t.cmd?runmsg():"kill"==t.cmd?terminate(3,"program killed"):"stdin"!=t.cmd&&self.postMessage({cmd:"unknown cmd received",msg:t.cmd})});